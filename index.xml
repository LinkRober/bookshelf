<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>è‘£äºŒåƒ</title>
    <link>https://LinkRober.github.io/bookshelf/index.xml</link>
    <description>Recent content on è‘£äºŒåƒ</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <lastBuildDate>Sun, 25 Mar 2018 00:00:00 +0000</lastBuildDate>
    <atom:link href="https://LinkRober.github.io/bookshelf/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>å…¥å‘å°ç¨‹åº</title>
      <link>https://linkrober.github.io/bookshelf/2018/03/%E5%85%A5%E5%9D%91%E5%B0%8F%E7%A8%8B%E5%BA%8F/</link>
      <pubDate>Sun, 25 Mar 2018 00:00:00 +0000</pubDate>
      
      <guid>https://linkrober.github.io/bookshelf/2018/03/%E5%85%A5%E5%9D%91%E5%B0%8F%E7%A8%8B%E5%BA%8F/</guid>
      <description>

&lt;h3 id=&#34;æè¿°&#34;&gt;æè¿°&lt;/h3&gt;

&lt;p&gt;å»å¹´å„å¤§å¹³å°çº·çº·å¼€å§‹å é¢†å¾®ä¿¡ä¸Šçš„åˆä¸€æµé‡å…¥å£â€”â€”å°ç¨‹åºã€‚å› ä¸ºå°ç¨‹åºçš„é—¨æ§›ä½ï¼Œè¿™é‡ŒæŒ‡ï¼ŒæŠ€æœ¯ä¸Šå’Œå‰ç«¯å¤§åŒå°å¼‚ï¼Œå®¡æ ¸åˆšå¼€å§‹ä¹Ÿæ¯”è¾ƒæ¾ã€‚é™¤äº†å¤§å‚ï¼Œå¾ˆå¤šä¸ªäººå¼€å‘è¿™éƒ½æŠ•å…¥è¿›å»ã€‚æƒ³åœ¨å°ç¨‹åºä¸Šæ‰“å“è‡ªå·±çš„ä¸ªäººå“ç‰Œã€‚åœ¨ç­¹å¤‡äº†ä¸‰ä¸ªæœˆä¹‹ä¹…ï¼Œæˆ‘çš„ç¬¬ä¸€æ¬¾å°ç¨‹åºï¼Œç»ˆäºå¿«è¦å®Œæˆäº†ã€‚åœ¨è¿™é‡Œæˆ‘ä¼šæ€»ç»“ä¸€ä¸‹æ•´ä½“çš„è¿‡ç¨‹ï¼Œä»ideaåˆ°ä¸€ä¸ªå®Œæ•´çš„å°ç¨‹åºã€æœŸé—´é‡åˆ°çš„å‘ã€å’Œè§‰å¾—æŒºæœ‰æ„æ€çš„åœ°æ–¹ã€‚&lt;/p&gt;

&lt;h3 id=&#34;æµç¨‹&#34;&gt;æµç¨‹&lt;/h3&gt;

&lt;p&gt;&lt;br /&gt;
1. è´­ä¹°æœåŠ¡å™¨
    æœ¬äººè´­ä¹°çš„æœåŠ¡å™¨æ˜¯é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼Œå› ä¸ºç»å†çš„å‡ å®¶å…¬å¸éƒ½æ˜¯ç”¨çš„å®ƒï¼Œæ„Ÿè§‰è¿˜æ˜¯æ¯”è¾ƒé è°±çš„ï¼ˆæˆ‘ä¸€åŒäº‹ä¹Ÿç”¨è¿‡è…¾è®¯çš„æœåŠ¡ï¼Œä¸€ç›´åœ¨åæ§½ä¸ç¨³å®šï¼Œåæ¥ä¹Ÿæ¢åˆ°é˜¿é‡Œäº‘äº†)&lt;/p&gt;

&lt;p&gt;&lt;/br&gt;
2. è´­ä¹°åŸŸå
    å°ç¨‹åºçš„æ˜¯æ— æ³•ç›´æ¥é€šè¿‡IPè®¿é—®ï¼Œå¿…é¡»ç”³è¯·ä¸€ä¸ªåŸŸåï¼ŒåŒæ ·çš„é˜¿é‡Œäº‘ä¸Šä¹°å°±è¡Œäº†ã€‚è¿™é‡Œè¦æé†’å¤§å®¶çš„æ˜¯ï¼Œå› ä¸ºå›½å®¶æ”¿ç­–åŸå› åŸŸåéœ€è¦å¤‡æ¡ˆï¼Œæ•´ä¸ªè¿‡ç¨‹å¤§æ¦‚éœ€è¦ä¸€ä¸ªæœˆæ—¶é—´ã€‚é˜¿é‡Œäº‘è¿˜æ˜¯æ¯”è¾ƒè‰¯å¿ƒçš„ï¼Œå¤‡æ¡ˆæˆåŠŸä¹‹åä¼šå†èµ é€ä½ ä¸€ä¸ªæœˆçš„æœåŠ¡å™¨æ—¶é—´ã€‚å› ä¸ºæ•´ä¸ªå¤‡æ¡ˆæ—¶é—´å¤§æ¦‚æ˜¯ä¸€ä¸ªæœˆã€‚æ‰€æœ‰ç»‘å®šåŸŸåä¸€å®šè¦æå‰ã€‚&lt;/p&gt;

&lt;p&gt;&lt;/br&gt;
3. ç”³è¯·CAè¯ä¹¦ç»‘å®šåˆ°åŸŸåã€‚åœ¨å°ç¨‹åºé‡Œçš„APIéƒ½éœ€è¦HtpsæœåŠ¡ï¼Œå¦‚æœä½ æœ‰CAè¯ä¹¦å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œæˆ‘ä¹Ÿæ˜¯é€šè¿‡é˜¿é‡Œäº‘ç”³è¯·çš„å…è´¹CAè¯ä¹¦ï¼Œæ—¶é—´æ˜¯ä¸€å¹´ï¼Œåˆ°æœŸçœ‹å¯ä»¥ç»­çš„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;/br&gt;
4. æ ¹æ®ideaè®¾è®¡äº§å“&lt;/p&gt;

&lt;p&gt;&lt;/br&gt;
5. å¼€å‘å°ç¨‹åºå’Œserver&lt;/p&gt;

&lt;p&gt;&lt;/br&gt;
6.å‘å¸ƒ&lt;/p&gt;

&lt;h3 id=&#34;å°ç¨‹åº&#34;&gt;å°ç¨‹åº&lt;/h3&gt;

&lt;p&gt;å› ä¸ºæ˜¯æˆ‘çš„ç¬¬ä¸€ä¸ªå°ç¨‹åºï¼Œå…ˆè¯•è¯•æ‰‹ï¼Œæ‰€ä»¥é€‰äº†ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„ä¸œè¥¿ï¼ŒéŸ³ä¹æ¬£èµã€‚æ•°æ®æ˜¯ä»å…¶ä»–ç½‘ç«™çˆ¬è¿‡æ¥æ’åˆ°æ•°æ®åº“çš„ã€‚
æœ¬äººæ˜¯ç§»åŠ¨ç«¯å‡ºç”Ÿï¼Œå¯¹å‰ç«¯å’Œåç«¯çš„ä¸œè¥¿éƒ½ä¸æ˜¯å¾ˆç†Ÿï¼Œä¸è¿‡åˆšå¥½å»å¹´å†™äº†ä¸å°‘RNçš„ä¸œè¥¿ï¼Œå‰ç«¯çš„ä¸œè¥¿ä¹Ÿç®—æ˜¯åŠåªè„šå…¥é—¨äº†ã€‚åœ¨å°ç¨‹åºé‡Œé¢æ–‡ä»¶åˆ†ä¸ºä¸‹é¢å‡ ç§&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;jsæ–‡ä»¶ï¼Œå’Œå‰ç«¯çš„ä¸€æ ·ï¼Œ&lt;/li&gt;
&lt;li&gt;wxmlæ–‡ä»¶ï¼Œç±»ä¼¼äºhtmlæ–‡ä»¶&lt;/li&gt;
&lt;li&gt;wxssæ–‡ä»¶ï¼Œç±»ä¼¼äºcssæ–‡ä»¶&lt;/li&gt;
&lt;li&gt;wxsæ–‡ä»¶ï¼Œè¿™æ˜¯å°ç¨‹åºçš„ä¸€å¥—è„šæœ¬è¯­è¨€ï¼Œè¯­æ³•çœ‹ä¼¼å’ŒJavaScriptè¯­æ³•ä¸€æ ·ï¼Œå…¶å®ä»–ä»¬æ˜¯ä¸åŒçš„è¯­è¨€ï¼Œæœ‰è‡ªå·±çš„è¯­æ³•ï¼Œå¹¶ä¸å’Œ javascript ä¸€è‡´    ã€‚æˆ‘ä»¬å¯ä»¥æŠŠå®ƒå½“åšæ–¹æ³•ç±»åœ¨wxmlä¸­æ¥ä½¿ç”¨ã€‚åœ¨wxmlä¸­æ˜¯æ— æ³•è°ƒç”¨jsä¸­çš„éäº‹ä»¶æ–¹æ³•çš„ï¼Œå¦‚æœä»jsæ–‡ä»¶é‡Œæ‹¿åˆ°çš„æ•°æ®ä½ å¸Œæœ›å†åšä¸€æ­¥å¤„ç†ç„¶åå±•ç¤ºï¼Œè¿™æ ·çš„å¤„ç†éœ€è¦æ”¾åˆ°wxsæ–‡ä»¶é‡Œã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å¼€å‘å‰èŠ±åŠå¤©æµè§ˆä¸‹å¾®ä¿¡å°ç¨‹åºçš„APIå·®ä¸å¤šå°±å¯ä»¥äº†ï¼Œå¥—è·¯éƒ½å·®ä¸å¤šMVCã€‚&lt;/p&gt;

&lt;h3 id=&#34;æ•°æ®åº“&#34;&gt;æ•°æ®åº“&lt;/h3&gt;

&lt;p&gt;æœåŠ¡å™¨æ˜¯ç”¨Node.js+MongoDB+Expressæ­å»ºçš„ï¼Œå…¨å¥—æ­å»ºèµ·æ¥è¿˜æ˜¯å¾ˆå¿«çš„ã€‚Node.jsæ˜¯ä¸€ä¸ªåŸºäºäº‹ä»¶é©±åŠ¨I/Oçš„æœåŠ¡ç«¯JavaScriptç¯å¢ƒï¼Œå®ƒåœ¨é«˜å¹¶å‘çš„æœåŠ¡ä¸Šæœ‰å¾ˆå¥½çš„ä½“éªŒã€‚åŒæ ·æ˜¯jsæ‰€ä»¥è¯­æ³•åŸºæœ¬æ²¡é—¨æ§›äº†ã€‚
MongoDBæ•°æ®åº“å’Œä¸€èˆ¬çš„å…³ç³»å‹æ•°æ®åº“ä¸åŒï¼Œå®ƒæ˜¯éå…³ç³»å‹æ•°æ®åº“ã€‚å…³ç³»å‹æ•°æ®åº“å¯¹æ•°æ®æ“ä½œéƒ½æ˜¯:&lt;code&gt;SELECT&lt;/code&gt;ã€&lt;code&gt;FROM&lt;/code&gt;ã€&lt;code&gt;WHERE&lt;/code&gt;ã€&lt;code&gt;BY&lt;/code&gt;ç­‰ã€‚æ¥æ„Ÿå—ä¸€ä¸‹MongoDBæ€ä¹ˆæ“ä½œæ•°æ®ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;//æ’å…¥ä¸€ä¸ªæ•°æ®
var user = {
    &amp;quot;name&amp;quot;:&amp;quot;å°èŠ³&amp;quot;ï¼Œ
    &amp;quot;age&amp;quot;:18,
    &amp;quot;gender&amp;quot;:1,
    &amp;quot;country&amp;quot;:&amp;quot;ä¸­å›½&amp;quot;
};
db.user.insert(user)
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;//æŸ¥è¯¢å§“åæ˜¯ï¼šå¼ ä¸‰ã€æå››ã€ç‹äº”çš„ä¿¡æ¯
db.user.find({&amp;quot;name&amp;quot;:  {&amp;quot;\$in&amp;quot; : [&amp;quot;å¼ ä¸‰&amp;quot;,&amp;quot;æå››&amp;quot;,&amp;quot;ç‹äº”&amp;quot;] }})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç»™æˆ‘æœ€å¤§çš„æ„Ÿè§‰ï¼Œå®ƒæ˜¯ä¸€ä¸ªé¢å‘å¯¹è±¡é¢å‘é›†åˆçš„å­˜å‚¨è¿‡ç¨‹ï¼Œå¯¹äºç»å¸¸åšé¢å‘å¯¹è±¡å¼€å‘äººæ¥è¯´æ˜¯æ¯”è¾ƒå®¹æ˜“å…¥æ‰‹çš„ã€‚&lt;/p&gt;

&lt;h3 id=&#34;express&#34;&gt;Express&lt;/h3&gt;

&lt;p&gt;åŸºäºNode.jsçš„æå…¶ç®€æ´çµæ´»çš„webåº”ç”¨å¼€å‘æ¡†æ¶ï¼Œå®ƒæœ‰ä¸°å¯Œçš„HTTPå¿«æ·æ–¹æ³•ï¼Œéå¸¸å¿«æ·çš„åˆ›å»ºnodeæœåŠ¡.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;é¦–é¡µæ¨¡å—å…¥å£è®¾ç½®&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;...
...
...
var home = require(&#39;./routes/home&#39;);//é¦–é¡µæ¥å£
...
...
...
app.use(&#39;/home&#39;, home);//å°†homeç»‘å®šåˆ°é¦–é¡µæ¥å£path
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;è¯¦ç»†çš„é¦–é¡µæ¨¡å—&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var express = require(&#39;express&#39;);
var router = express.Router();
var URL = require(&#39;url&#39;);
var MusicModel = require(&#39;./model.js&#39;);
const mongoose = require(&#39;mongoose&#39;);
//è¿æ¥æ•°æ®åº“å¹¶æ‰“å¼€
mongoose.connect(&#39;mongodb://localhost:27017/funmusic&#39;)
var db = mongoose.connection;

db.on(&#39;open&#39;,function(){
	console.log(&#39;MongoDB Connect Successed&#39;);
});
db.on(&#39;error&#39;,function(){
	console.log(&#39;MongoDB Connect Error&#39;);
});
//å®šä¹‰cardæ¨¡å‹
const cardSchema = new mongoose.Schema({
 	vol_id:String,
 	vol_number:String,
 	number:Number,
 	title:String,
 	summary:String,
 	covers:[{
 		origin:String,
 		large:String,
 		large_low:String,
 		small:String,
 	}],
 	create_time:Number,
 	is_free:Number,
 	is_trial:Number,
 	tags:[{
 		tag_id:String,
 		name:String,
 		alias:String,
 		cover:String,
 	}],
 	comments_count:String,
 	favs_count:Number,
 	url:String,
 	detail_desc:String
 }, { collection: &#39;card&#39; });
const cardModel = mongoose.model(&#39;card&#39;,cardSchema);

//listæ¥å£
router.get(&#39;/list&#39;,function(req,res,next){
	var params = URL.parse(req.url,true).query;
	var response = res;
	cardModel.find({},(err,result,res) =&amp;gt; {
		if(err)  return console.log(err);
		console.log(result);
		var content = {status:1,data:result};
		response.send(JSON.stringify(content));
	});
	
})

//å®šä¹‰cardDetailæ¨¡å‹
const cardDetailSchema = new mongoose.Schema({
	covers:[{
		origin:String,
		large:String,
		large_low:String,
		small:String,
	}],
	detail_desc:String,
	title:String,
	number:Number,
	tags:[{
 		tag_id:String,
 		name:String,
 		alias:String,
 		cover:String,
 	}],
},{collection:&#39;card&#39;});

//detailæ¥å£
router.get(&#39;/detail&#39;,function(req,res,next){
	var params = URL.parse(req.url,true).query;
	var response = res;
	var _vol_id = params.vol_id;
	console.log(_vol_id);
	cardModel.aggregate([{ $match : { vol_id : _vol_id}},{ $project : {title : 1,covers : 1,detail_desc : 1,number : 1,tags : 1,&amp;quot;_id&amp;quot; : 0}}],(err,result,res) =&amp;gt; {
		if(err)  return console.log(err);
		console.log(result);
		var restruct = {
			image_large:result[0].covers[0].large,
			detail_desc:result[0].detail_desc,
			title:result[0].title,
			number:result[0].number,
			tags:result[0].tags,
		}
		var content = {status:1,data:restruct};
		response.send(JSON.stringify(content));
	});
});



module.exports = router;

&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;ç«¯å£ç®¡ç†-nginx&#34;&gt;ç«¯å£ç®¡ç† - Nginx&lt;/h3&gt;

&lt;p&gt;Nginxæ˜¯ä¸€ä¸ªåå‘ä»£ç†æœåŠ¡å™¨ï¼Œå¹³æ—¶æˆ‘ä»¬æŠ“åŒ…æ•°æ®ä»serveråˆ°clientæ˜¯æ­£å‘ä»£ç†ï¼Œä»clientåˆ°serverå°±æ˜¯åå‘ä»£ç†ã€‚æœåŠ¡å™¨çš„httpæœåŠ¡åªä¼šå‘å¤–æš´éœ²80ç«¯å£ï¼ˆé»˜è®¤ï¼‰ï¼ŒhttpsæœåŠ¡æš´éœ²443(é»˜è®¤)ç«¯å£ã€‚æˆ‘ä»¬çš„æœåŠ¡åˆ™æ˜¯3000ç«¯å£ï¼ŒNginxä¼šå°†è¯·æ±‚åå‘ä»£ç†åˆ°3000ç«¯å£ï¼Œæ— è®ºä½ æ˜¯httpè¿˜æ˜¯hpptsè¯·æ±‚ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;http {
    log_format  main  &#39;$remote_addr - $remote_user [$time_local] &amp;quot;$request&amp;quot; &#39;
                      &#39;$status $body_bytes_sent &amp;quot;$http_referer&amp;quot; &#39;
                      &#39;&amp;quot;$http_user_agent&amp;quot; &amp;quot;$http_x_forwarded_for&amp;quot;&#39;;

    access_log  /var/log/nginx/access.log  main;

    sendfile            on;
    tcp_nopush          on;
    tcp_nodelay         on;
    keepalive_timeout   65;
    types_hash_max_size 2048;

    include             /etc/nginx/mime.types;
    default_type        application/octet-stream;

    # Load modular configuration files from the /etc/nginx/conf.d directory.
    # See http://nginx.org/en/docs/ngx_core_module.html#include
    # for more information.
    include /etc/nginx/conf.d/*.conf;

    server {
        listen       80 default_server;
        listen       [::]:80 default_server;
        server_name  _;
        root         /usr/share/nginx/html;

        # Load configuration files for the default server block.
        include /etc/nginx/default.d/*.conf;

        location / {
	  proxy_pass http://127.0.0.1:3000;
        }

        error_page 404 /404.html;
            location = /40x.html {
        }

        error_page 500 502 503 504 /50x.html;
            location = /50x.html {
        }
    }

# Settings for a TLS enabled server.
#
    server {
        listen       443;
        server_name  www.lify.online;
	ssl on;
        root         html;
	index index.html index.htm;
        ssl_certificate cert/214534222920959.pem;
        ssl_certificate_key cert/214534222920959.key;
        ssl_session_timeout  5m;
        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_prefer_server_ciphers on;
        location / {
	  #root html;
	  #index index.html index.htm;
	  proxy_pass http://127.0.0.1:3000;
        }

}
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;è¿›ç¨‹ç®¡ç†-pm2&#34;&gt;è¿›ç¨‹ç®¡ç† - PM2&lt;/h3&gt;

&lt;p&gt;ä½¿ç”¨å®ƒå¯ä»¥å¾ˆæ–¹ä¾¿çš„å¯åŠ¨ã€åœæ­¢å’Œç›‘æ§è¿›ç¨‹ã€‚åˆšå¼€å§‹é‡æ–°å‘å¸ƒæ¥å£çš„æ—¶å€™ï¼Œéƒ½éœ€è¦åœæ­¢æœåŠ¡ï¼Œkillè¿›ç¨‹ï¼Œå†æ¬¡å¯åŠ¨æœåŠ¡ï¼Œæœ‰äº†pm2åªè¦&lt;code&gt;pm2 restart è¿›ç¨‹å&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;ä»¥ä¸Šæ˜¯æˆ‘æœ€è¿‘ä¸€æ®µæ—¶é—´å°ç¨‹åºä¹‹æ—…çš„æ€»ç»“ï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>é€’å½’</title>
      <link>https://linkrober.github.io/bookshelf/2018/02/%E9%80%92%E5%BD%92/</link>
      <pubDate>Fri, 02 Feb 2018 00:00:00 +0000</pubDate>
      
      <guid>https://linkrober.github.io/bookshelf/2018/02/%E9%80%92%E5%BD%92/</guid>
      <description>&lt;p&gt;&lt;/b&gt;
&lt;span class=&#34;highlight-text primary&#34;&gt;
åŸºæœ¬æ€æƒ³
&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;é€’å½’æ˜¯ä¸€ç§ç›´æ¥æˆ–è€…é—´æ¥è°ƒç”¨è‡ªèº«å‡½æ•°æˆ–è€…æ–¹æ³•çš„ç®—æ³•ã€‚é€’å½’çš„å®è´¨æ˜¯æŠŠé—®é¢˜åˆ†è§£æˆè§„æ¨¡ç¼©å°çš„åŒç±»é—®é¢˜çš„å­é—®é¢˜ï¼Œç„¶åé€’å½’è°ƒç”¨æ–¹æ³•æ¥è¡¨ç¤ºé—®é¢˜çš„è§£ã€‚é€’å½’ç®—æ³•ï¼Œå…¶å®å°±æ˜¯ç¨‹åºçš„è‡ªèº«è°ƒç”¨ã€‚åœ¨ä¸€æ®µç¨‹åºä¸­å¾€å¾€ä¼šé‡åˆ°è°ƒç”¨è‡ªèº«çš„é‚£æ ·ä¸€ç§codingç­–ç•¥ã€‚é€’å½’å¾€å¾€èƒ½å¸¦æ¥éå¸¸ç®€æ´éå¸¸ç›´è§‚çš„ä»£ç å½¢å¼ï¼Œä»è€Œä½¿æˆ‘ä»¬çš„ç¼–ç å¤§å¤§ç®€åŒ–ï¼Œä½†æ˜¯é€’å½’çš„æ€æƒ³ç¡®å®å’Œæˆ‘ä»¬çš„å¸¸è§„æ€ç»´ç›¸é€†ã€‚æˆ‘ä»¬é€šå¸¸æ˜¯ä»ä¸Šè€Œä¸‹çš„æ€è€ƒé—®é¢˜ï¼Œè€Œé€’å½’æ˜¯ä»ä¸‹å¾€ä¸Šè¿›è¡Œæ€è€ƒã€‚è¿™æ ·æˆ‘ä»¬å°±èƒ½çœ‹åˆ°æˆ‘ä»¬ä¼šç”¨å¾ˆå°‘çš„è¯­å¥è§£å†³å¾ˆå¤§çš„é—®é¢˜ï¼Œæ‰€ä»¥é€’å½’ç­–ç•¥æœ€ä¸»è¦çš„ä½“ç°å°±æ˜¯è¾ƒå°‘çš„ä»£ç é‡è§£å†³å¤æ‚çš„é—®é¢˜ã€‚&lt;/p&gt;

&lt;p&gt;&lt;/p&gt;

&lt;p&gt;&lt;/b&gt;
&lt;span class=&#34;highlight-text primary&#34;&gt;
Exampleï¼šè®¡ç®—é˜¶ä¹˜
&lt;/span&gt;
è®¡ç®—é˜¶ä¹˜æ˜¯é€’å½’ç¨‹åºçš„ç»å…¸ç¤ºä¾‹ã€‚è®¡ç®—æŸä¸ªæ•°çš„é˜¶ä¹˜å°±æ˜¯ç”¨é‚£ä¸ªæ•°ä¹˜ä»¥åŒ…å«1åœ¨å†…çš„æ¯”å®ƒå°çš„æ‰€æœ‰æ•°ã€‚ä¾‹å¦‚ï¼Œ&lt;code&gt;factorial(6)&lt;/code&gt;ç­‰ä»·äº&lt;code&gt;6*5*4*3*2*1&lt;/code&gt;,é˜¶ä¹˜çš„ç‰¹æ€§æ˜¯ï¼ŒæŸä¸ªæ•°çš„é˜¶ä¹˜ç­‰äºèµ·å§‹æ•°ä¹˜ä»¥æ¯”å®ƒå°çš„æ•°çš„é˜¶ä¹˜ã€‚é˜¶ä¹˜å‡½æ•°ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;int factorial(int n) {
	return n * factorial(n-1);
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½†æ˜¯è¿™ä¸ªå‡½æ•°ä¼šæ°¸è¿œæ‰§è¡Œä¸‹å»ï¼Œå› ä¸ºå®ƒæ²¡æœ‰ç»ˆæ­¢æ¡ä»¶ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ¡ä»¶å‘Šè¯‰å®ƒä½•æ—¶åœæ­¢ã€‚æˆ‘ä»¬è¿™é‡Œç»™å‡ºçš„æ¡ä»¶å°±æ˜¯&lt;code&gt;n == 1&lt;/code&gt;åœæ­¢&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;int factorial(int n){
	if(n == 1){
		return 1;
	}
	else {
		return n * factorial(n - 1);
	}
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æµç¨‹ç¤ºæ„å›¾ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;../../../fact-shape.jpg&#34; alt=&#34;fact-shape&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;/b&gt;
&lt;span class=&#34;highlight-text primary&#34;&gt;
Exampleï¼šæ–æ³¢çº³å¥‘æ•°åˆ—
&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;æ•°å­¦ä¸Š&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97&#34;&gt;æ–æ³¢çº³å¥‘æ•°åˆ—&lt;/a&gt;æ˜¯ä»¥é€’å½’çš„æ–¹å¼æ¥å®šä¹‰çš„ï¼š
&lt;img src=&#34;../../../Fibonacci Sequence.png&#34; alt=&#34;Fibonacci Sequence&#34; /&gt;&lt;/p&gt;

&lt;p&gt;å†™æˆé€’å½’ç¨‹åºï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;int Fibonacci(int n){
    if (n &amp;lt;= 1)  
        return n;  
    else  
        return Fibonacci(n-1) + Fibonacci(n-2);  
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;/b&gt;
&lt;span class=&#34;highlight-text primary&#34;&gt;
é€’å½’æ¡ä»¶
&lt;/span&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;é€’å½’å¼€å§‹æ—¶éœ€è¦ä¸€ä¸ªç§å­å€¼&lt;/li&gt;
&lt;li&gt;ä¸æ–­çš„è°ƒç”¨è‡ªèº«&lt;/li&gt;
&lt;li&gt;æ£€æŸ¥å½“å‰å€¼æ˜¯å¦å·²ç»åŒ¹é…åŸºæœ¬æ¡ä»¶ã€‚å¦‚æœåŒ¹é…ï¼Œåˆ™è¿›è¡Œå¤„ç†å¹¶è¿”å›å€¼&lt;/li&gt;
&lt;/ul&gt;</description>
    </item>
    
    <item>
      <title>å†è§2017ï¼Œä½ å¥½2018</title>
      <link>https://linkrober.github.io/bookshelf/2018/01/%E5%86%8D%E8%A7%812017%E4%BD%A0%E5%A5%BD2018/</link>
      <pubDate>Tue, 02 Jan 2018 00:00:00 +0000</pubDate>
      
      <guid>https://linkrober.github.io/bookshelf/2018/01/%E5%86%8D%E8%A7%812017%E4%BD%A0%E5%A5%BD2018/</guid>
      <description>&lt;p&gt;ä¸çŸ¥ä¸è§‰å·¥ä½œå·²æœ‰ä¸‰ä¸ªå¹´å¤´ï¼Œåœ¨iOSè¿™æ¡è·¯ä¸Šï¼Œä»å½“å¹´æˆ˜æˆ˜å…¢å…¢çš„æ–°äººå˜æˆä¸€ä¸ªç†Ÿç»ƒçš„å¼€å‘è€…ï¼Œè¿™ä¸€è·¯èµ°æ¥çœŸä¸å®¹æ˜“ã€‚ä¸ä»…ä»…æ˜¯èº«ä½“ä¸Šçš„è´Ÿè·ï¼Œä¸ªäººå¯¹äºæŠ€æœ¯çš„è¿½æ±‚ä¹Ÿä½¿è‡ªå·±æˆ–è¿·æƒ˜æˆ–å¥‹èµ·ã€‚&lt;/p&gt;

&lt;p&gt;&lt;/p&gt;

&lt;h4 id=&#34;å·¥ä½œ&#34;&gt;å·¥ä½œ&lt;/h4&gt;

&lt;p&gt;å‰ä¸¤å¹´åŸºæœ¬ä¸Šéƒ½åœ¨åŠ ç­èµ¶ä¸šåŠ¡åšæ˜¯æŸå—ä¸šåŠ¡ï¼Œå¯¹äºä¸€æ¬¾Appä»æ— åˆ°æœ‰å¦‚ä½•æ¶æ„çš„æ²¡æœ‰ç³»ç»Ÿçš„è€ƒè™‘è¿‡ã€‚ä»Šå¹´åœ¨å…¬å¸çš„è¿™æ¬¾Wecycleè§†é¢‘ç¤¾äº¤Appä¸Šï¼Œå›¢é˜Ÿå†…ä»å¼€å‘è¯­è¨€ã€è®¾è®¡æ¨¡å¼ã€ç¼“å­˜ç­–ç•¥ã€ç½‘ç»œå±‚è®¾è®¡ã€ç»„ä»¶åŒ–æ–¹æ¡ˆç­‰å‡ ä¸ªç»´åº¦æ¥æ¶æ„è¿™æ¬¾Appã€‚å› ä¸ºå‰æœŸäº§å“æ¶æ„çš„å¥½ï¼Œåé¢äº§å“è¿­ä»£å¤§å®¶éƒ½åšçš„æ¯”è¾ƒè½»æ¾ã€‚å°±åƒä¸€å¹¢å¤§å¦æœ‰äº†æ•´ä½“çš„æ¡†æ¶ï¼Œéœ€è¦ä»€ä¹ˆå°±å¾€é‡Œé¢å¡å°±è¡Œï¼Œå®šæœŸä¿®æ­£ä¸‹ï¼Œæ—¶é—´ä¹…äº†ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒæ¥¼æ­ªäº†ã€‚&lt;/p&gt;

&lt;p&gt;ä»Šå¹´Appåšäº†ä¸å°‘ï¼Œé™¤äº†åˆšæ‰è¯´çš„è¿˜æœ‰Snapvoteï¼Œä¸€æ¬¾æŠ•ç¥¨Appï¼›VISOï¼Œä¸€æ¬¾è§†é¢‘å’Œæ»¤é•œç¼–è¾‘çš„Appã€‚
Wecycleæ˜¯Object-Cå’ŒSwiftæ··ç¼–çš„å·¥ç¨‹ï¼Œåœ¨è¿™æœŸé—´ç®—æ˜¯å…¥é—¨äº†è‹¹æœçˆ¸çˆ¸çš„æ–°å¼€å‘è¯­è¨€ï¼ŒSwfitæ‰€å€¡å¯¼çš„é¢ç›¸åè®®ç¼–ç¨‹è®©å¼€å‘äººå‘˜çš„è„‘æ´å¯ä»¥å¼€çš„æ›´å¤§äº†ï¼Œé€šè¿‡åè®®æŠ½è±¡å„ç§åº”ç”¨åœºæ™¯ç€å®è®©äººå…´å¥‹äº†ä¸€æŠŠï¼Œåœ¨Swfit2.0ä¹‹å&lt;code&gt;protocol&lt;/code&gt;çš„&lt;code&gt;extension&lt;/code&gt;æ”¯æŒé»˜è®¤å®ç°ï¼Œä¸ºåè®®æ’ä¸Šäº†ç¿…è†€ã€‚æ„Ÿå…´è¶£çš„åŒå­¦ä¸å¦¨çœ‹çœ‹&lt;a href=&#34;https://github.com/ishkawa/APIKit&#34;&gt;&lt;code&gt;APIKit&lt;/code&gt;&lt;/a&gt;è¿™ä¸ªSwiftåº“ï¼Œå®ƒé€šè¿‡POPçš„æ–¹å¼åœ¨ç½‘ç»œè¯·æ±‚å’Œæ¨¡å‹è§£æä¹‹é—´ç»™å‡ºäº†ä¸€ä¸ªå¾ˆæ£’çš„è§£å†³æ–¹æ¡ˆï¼Œåœ¨æ­¤ä¸å±•å¼€äº†ã€‚Swiftçš„è§£åŒ…ã€å†™æ—¶å¤åˆ¶ã€å¤§é‡çš„å€¼ç±»å‹çš„ä½¿ç”¨ä½¿å¾—æˆ‘ä»¬çš„ä»£ç æ¯”OCæ—¶ä»£å†™èµ·æ¥æ›´å®‰å…¨ã€‚&lt;/p&gt;

&lt;p&gt;Snapvoteæ˜¯ä¸€æ¬¾ç®€å•çš„æŠ•ç¥¨ç±»å·¥å…·Appï¼Œæ²¡æœ‰ç”¨æˆ·ç³»ç»Ÿï¼Œå¯ä»¥è¯´æ˜¯æ¯”è¾ƒç®€å•çš„äº†ï¼Œæ‰€ä»¥è€ƒè™‘ç”¨è·¨å¹³å°çš„æ¡†æ¶ReactNativeå¼€å‘ï¼Œé¡ºä¾¿ç»ƒç»ƒæ‰‹ã€‚ä¸€æ¬¡ä½¿ç”¨ä¸¤ä¸ªå·¥å…·ï¼ˆXcodeã€React Native Debugerï¼‰åŒæ—¶è°ƒè¯•,é‚£å«é…¸çˆ½ï¼Œä¸¤ä¸ªæ˜¾ç¤ºå™¨éƒ½ä¸å¤Ÿç”¨ã€‚æ‰’æ‹‰æ‰’æ‹‰ReactNativeçš„OCå®ç°ï¼ŒRuntimeã€æ¶ˆæ¯è½¬å‘ã€RunLoopã€å¤šçº¿ç¨‹ã€çº¿ç¨‹é”ä¸€å¤§å †çš„çŸ¥è¯†ç‚¹ï¼Œè®©äººå—ç›ŠåŒªæµ…ï¼›åŒæ—¶åˆç¨å¾®å­¦äº†ç‚¹javascriptã€‚å…³äºReactNativeçš„ç›¸å…³ä½“éªŒè‡ªå·±å†™äº†ä¸€ä¸ªç³»åˆ—å…±å››ç¯‡æ–‡ç« ,ä»å®‰è£…åˆ°åŸç†çš„è®¨è®ºï¼Œç®—æ˜¯æœ‰ä¸ªäº¤ä»£å§ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://linkrober.github.io/bookshelf/2017/10/react-native%E5%A6%82%E4%BD%95%E9%9B%86%E6%88%90%E5%88%B0%E7%8E%B0%E6%9C%89%E9%A1%B9%E7%9B%AE%E4%B8%AD/&#34;&gt;React Nativeå¦‚ä½•é›†æˆåˆ°ç°æœ‰é¡¹ç›®ä¸­&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://linkrober.github.io/bookshelf/2017/10/react-native%E5%92%8Cnative%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1/&#34;&gt;React Nativeå’ŒNativeé—´çš„é€šä¿¡å®è·µ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://linkrober.github.io/bookshelf/2017/10/rctrootviewrctbridge%E5%81%9A%E4%BA%86%E4%BB%80%E4%B9%88/&#34;&gt;RCTRootViewã€RCTBridgeåšäº†ä»€ä¹ˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://linkrober.github.io/bookshelf/2017/12/object-c%E5%92%8Cjs%E9%80%9A%E4%BF%A1%E6%A6%82%E8%BF%B0/&#34;&gt;Object-Cå’ŒJSé€šä¿¡æ¦‚è¿°&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;a href=&#34;https://itunes.apple.com/us/app/viso-photo-editor-collage/id1312830469?ls=1&amp;amp;mt=8&#34;&gt;VISO&lt;/a&gt;è§†é¢‘å›¾ç‰‡ç¼–è¾‘çš„Appå’ŒVISCOå¾ˆåƒï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥ä½“éªŒä¸‹ï¼ŒæœŸå¾…ä½ ä»¬çš„æ„è§ğŸ˜„ã€‚ç»å†äº†OCå’ŒSwiftæ··ç¼–çš„ç—›è‹¦ï¼Œæœ¬æ¥æƒ³ä½¿ç”¨çº¯Swiftå¼€å‘ï¼Œä½†æ˜¯å—é™äºå…¬å¸å†…éƒ¨æŸäº›è§†é¢‘ç¼–è¾‘åº“æ˜¯OCå†™çš„ä¸€æ—¶åŠä¼šå„¿æ²¡å‘æ”¹è¿‡æ¥ï¼Œåªèƒ½å†™å›OCäº†ã€‚é€šè¿‡è¿™æ¬¾Appçš„å¼€å‘è®©æˆ‘å¯¹éŸ³è§†é¢‘çš„å¤„ç†æœ‰äº†ä¸€ä¸ªå…¨é¢çš„äº†è§£ã€‚å‰ä¸¤å¹´ä¸€ç›´å¿™äºä¸šåŠ¡æ²¡æœ‰æ·±æŒ–OCçš„åº•å±‚ï¼Œä»Šå¹´èŠ±äº†å¾ˆå¤šæ—¶é—´åœ¨è¿™ä¸Šé¢ï¼Œä¸ä»…å¯¹Runtimeã€RunLoopã€çº¿ç¨‹ã€çº¿ç¨‹é”æœ‰äº†æ›´æ·±å…¥çš„ç†è§£ï¼Œè¿˜èŠ±æ—¶é—´æŠŠCåˆæ‹‰å‡ºæ¥ç»ƒäº†ç»ƒã€‚ç”¨Cå†™äº†ä¸ªAppä¸Šçš„SocketæœåŠ¡ï¼ˆPsï¼šå› ä¸ºæœŸé—´ä¸€ç›´åœ¨çœ‹ç½‘ç»œæ–¹é¢çš„ä¹¦ç±&lt;a href=&#34;https://read.douban.com/ebook/12054542/&#34;&gt;ã€Šå›¾è§£HTTPã€‹&lt;/a&gt;ã€&lt;a href=&#34;https://book.douban.com/subject/1088054/&#34;&gt;ã€ŠTCPï¼IPè¯¦è§£ã€‹&lt;/a&gt;ï¼Œå†™çš„æ—¶å€™å°‘èµ°äº†ç‚¹å¼¯è·¯ï¼Œæœç„¶æ˜¯ä¹¦åˆ°ç”¨æ—¶æ–¹æ¨å°‘ï¼‰ï¼Œé€šè¿‡æµè§ˆå™¨è®¿é—®Appçš„æŸä¸ªç«¯å£å®æ—¶çš„æŸ¥çœ‹åŸ‹ç‚¹æ•°æ®ï¼Œæ–¹ä¾¿äº†QAçš„æµ‹è¯•ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://linkrober.github.io/bookshelf/2017/11/%E4%B8%80%E4%B8%AA%E9%9F%B3%E8%A7%86%E9%A2%91%E5%8E%82%E7%9A%84%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B%E6%A6%82%E8%BF%B0/&#34;&gt;ä¸€ä¸ªéŸ³è§†é¢‘å‚çš„å›¾åƒå¤„ç†æµç¨‹æ¦‚è¿°&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://linkrober.github.io/bookshelf/2017/09/run-loops-%E4%B8%80/&#34;&gt;Run Loops (ä¸€)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://linkrober.github.io/bookshelf/2017/12/ios%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%AD%E7%9A%84%E9%94%81/&#34;&gt;iOSå¤šçº¿ç¨‹ä¸­çš„é”&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;è¡Œä¸š&#34;&gt;è¡Œä¸š&lt;/h4&gt;

&lt;p&gt;å› ä¸ºå¸‚åœºä¸Šçš„åŸ¹è®­ç­ä¸æ–­çš„è¾“å‡ºiOSå¼€å‘è€…ï¼ŒiOSå¸‚åœºåŸºæœ¬é¥±å’Œï¼Œå·¥ä½œä¹Ÿä¸æ˜¯ä¸‰å¹´å‰éšéšä¾¿ä¾¿çš„å°±èƒ½æ‰¾åˆ°ï¼Œå¯¹æŠ€æœ¯äººå‘˜çš„åŸºæœ¬ç´ å…»è¦æ±‚æ›´é«˜ï¼Œå¸‚åœºæ­£åœ¨æ…¢æ…¢å›å½’åˆ°è‰¯æ€§ï¼ŒæŒºå¥½ã€‚ ä»Šå¹´Javascriptã€Pythonã€Javaå¤§è¡Œå…¶é“ï¼Œä½†è¿˜æ˜¯ç›¸ä¿¡è‹¹æœçˆ¸çˆ¸ã€‚åœ¨OCè¿™é—¨è¯­è¨€ä¸Šæˆ‘ä¼šç»§ç»­æ·±å…¥ï¼Œå®ƒæ˜¯ä¸€é—¨åŠ¨æ€çš„è¯­è¨€æœ‰å¾ˆå¤šæœ‰è¶£çš„æŠ€æœ¯æ˜¯é‚£äº›åœ¨ç¼–è¯‘æœŸå°±å†³å®šæ€ä¹ˆè·‘çš„è¯­è¨€æ‰€ä¸å…·å¤‡çš„ã€‚å­¦ä¹ å¹¶å¸æ”¶å®ƒï¼Œè®©è‡ªå·±æ›´é€å½»çš„äº†è§£ä¸€é—¨è¯­è¨€çš„åº•å±‚æœºåˆ¶ã€‚å¯¹ä¸€ä¸ªå‡ å¹´çš„å¼€å‘äººå‘˜æ¥è¯´ï¼Œå¦‚æœä¸€é—¨è¯­è¨€éƒ½ä¸èƒ½ç†è§£çš„æ¯”è¾ƒé€å½»ï¼Œé‚£æ˜¯å¯æ‚²çš„ã€‚èŠ±æ›´å¤šçš„æ—¶é—´ç†Ÿæ‚‰Swiftï¼Œä»Šåè®©è‡ªå·±çš„æŠ€æœ¯èƒ½å¤Ÿå¹³ç¨³çš„è¿‡æ¸¡ã€‚&lt;/p&gt;

&lt;p&gt;â€œåœ¨æˆ‘ä»¬è¿™ä¸ªåœ°æ–¹ï¼Œä½ å¿…é¡»ä¸åœåœ°å¥”è·‘ï¼Œæ‰èƒ½ç•™åœ¨åŸåœ°ã€‚â€ â€”â€” ã€Šçˆ±ä¸½ä¸æ¼«æ¸¸å¥‡å¢ƒã€‹â— çº¢æ¡ƒçš‡å&lt;/p&gt;

&lt;h4 id=&#34;ç”Ÿæ´»&#34;&gt;ç”Ÿæ´»&lt;/h4&gt;

&lt;p&gt;ä»Šå¹´è‡ªå·±çš„ä¸ªäººç”Ÿæ´»å‡ºç°äº†äº›çŠ¶å†µï¼Œå¤šçš„ä¹Ÿä¸è¯´äº†å¤§å®¶éƒ½æ‡‚ã€‚è¿™æ¬¡ç»å†è®©æˆ‘æ„è¯†åˆ°å³ä½¿æ˜¯ä¸¤ä¸ªäººå·²ç»åœ¨ä¸€èµ·äº†ï¼Œä¹Ÿä¸è¦ä¸¢å¤±æ‰åŸæ¥çš„è‡ªå·±ï¼Œä¸è¦å¿˜è®°å¯¹æ–¹æ˜¯å› ä¸ºåŸæ¥çš„ä½ æ‰æƒ³å’Œä½ åœ¨ä¸€èµ·ã€‚å¦‚æœä½ å˜äº†ï¼Œå¥¹ä¹Ÿå˜äº†ã€‚æ§åˆ¶è‡ªå·±ï¼Œæ—¶åˆ»ä¿æŒä¼˜ç§€ã€‚æ— è®ºæ˜¯å·¥ä½œè¿˜æ˜¯ç”Ÿæ´»ï¼Œæ´»çš„ç²¾è‡´ç‚¹ã€‚&lt;/p&gt;

&lt;h4 id=&#34;2017ä¹¦å•&#34;&gt;2017ä¹¦å•&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;ã€Šå›¾è§£HTTPã€‹&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;å›¾æ–‡å¹¶èŒ‚ï¼Œå™è¿°ç”ŸåŠ¨ã€‚é€‚åˆæ–°æ‰‹ï¼Œè®©è¯»è€…å¯¹HTTPå¾ˆå¿«å½¢æˆä¸€ä¸ªæ•´ä½“çš„æ¦‚å¿µï¼Œæ˜ç™½ä¸ºä½•è¿™æ ·è®¾è®¡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;ã€ŠLinux Shellè„šæœ¬ã€‹&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;å½“ä½œå‚è€ƒä¹¦éœ€è¦çš„æ—¶å€™ç¿»ç¿»&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;ã€ŠObject-Cé«˜çº§ç¼–ç¨‹ï¼ˆiOSå’ŒOSXå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†ï¼‰ã€‹&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Autoreleaseã€å±æ€§ä¿®é¥°ç¬¦ã€blockã€GCDéƒ½æœ‰æ¯”è¾ƒæ·±å…¥çš„ç†è§£ï¼Œéƒ½æ˜¯å¹²è´§ï¼Œé€‚åˆåå¤é˜…è¯»ã€‚&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;ã€ŠHead First HTMLã€‹&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;å…¥é—¨æ¨è&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;ã€Šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ã€‹&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;å¥½ä¹¦ï¼Œå¯¹ç¼–è¯‘å’Œè¿æ¥æœ‰æ¯”è¾ƒæ·±å…¥çš„æè¿°ï¼Œæ˜¯ä¸ªå¤§è èï¼Œå¾—æ…¢æ…¢å•ƒã€‚&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;ã€Šæ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿã€‹&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;å¥½ä¹¦ï¼Œæ“ä½œç³»ç»Ÿå¿…è¯»ä¹¦ç±ï¼Œåˆæ˜¯ä¸ªå¤§è èã€‚&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
    </item>
    
    <item>
      <title>Object-Cå’ŒJSé€šä¿¡æ¦‚è¿°</title>
      <link>https://linkrober.github.io/bookshelf/2017/12/object-c%E5%92%8Cjs%E9%80%9A%E4%BF%A1%E6%A6%82%E8%BF%B0/</link>
      <pubDate>Mon, 25 Dec 2017 00:00:00 +0000</pubDate>
      
      <guid>https://linkrober.github.io/bookshelf/2017/12/object-c%E5%92%8Cjs%E9%80%9A%E4%BF%A1%E6%A6%82%E8%BF%B0/</guid>
      <description>&lt;p&gt;æœ¬ç³»åˆ—æ–‡ç« ä½œä¸ºå­¦ä¹ RNæœŸé—´çš„æ€»ç»“&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://linkrober.github.io/bookshelf/2017/10/react-native%E5%A6%82%E4%BD%95%E9%9B%86%E6%88%90%E5%88%B0%E7%8E%B0%E6%9C%89%E9%A1%B9%E7%9B%AE%E4%B8%AD/&#34;&gt;React Nativeå¦‚ä½•é›†æˆåˆ°ç°æœ‰é¡¹ç›®ä¸­&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://linkrober.github.io/bookshelf/2017/10/react-native%E5%92%8Cnative%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1/&#34;&gt;React Nativeå’ŒNativeé—´çš„é€šä¿¡å®è·µ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://linkrober.github.io/bookshelf/2017/10/rctrootviewrctbridge%E5%81%9A%E4%BA%86%E4%BB%80%E4%B9%88/&#34;&gt;RCTRootViewã€RCTBridgeåšäº†ä»€ä¹ˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Object-Cå’ŒJSé€šä¿¡æ¦‚è¿°&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;/p&gt;

&lt;h4 id=&#34;æµç¨‹æ¢³ç†&#34;&gt;æµç¨‹æ¢³ç†&lt;/h4&gt;

&lt;p&gt;&lt;img src=&#34;../../../æ¥è‡ªJSPathä½œè€…Bangçš„ä¸€å¼ æµç¨‹å›¾.png&#34; alt=&#34;æ¥è‡ªJSPathä½œè€…Bangçš„ä¸€å¼ æµç¨‹å›¾&#34; /&gt;
é¦–å…ˆï¼Œæ— è®ºæ˜¯RNç«¯è¿˜æ˜¯Nativeç«¯éƒ½ä¼šæŒæœ‰ä¸€ä¸ªbridgeè´Ÿè´£å¯¹æ¥è‡ªä¸åŒç«¯çš„æ¨¡å—è¿›è¡Œæ¡¥è¡—ï¼Œå†åšæ¶ˆæ¯å¤„ç†ã€‚ç°é™„ä¸Šä¸€å¼ æ¥è‡ªJSPathä½œè€…Bangçš„å›¾ã€‚
RNè°ƒç”¨æŸä¸ªæ–¹æ³•å‘Nativeå‘é€æ¶ˆæ¯ï¼Œæ–¹æ³•é¦–å…ˆä¼šè¢«åˆ†è§£æˆModuleIdã€MethodIdå’Œå‚æ•°ï¼Œå‘é€åˆ°OCBridgeã€‚é‚£ä¹ˆOCBridgeæ˜¯å¦‚ä½•æ¥å—çš„å‘¢ï¼Ÿï¼ˆå› ä¸ºå¯¹JSä»£ç ä¸ç†Ÿæ‚‰è¿™é‡Œåªè®¨è®ºOCéƒ¨åˆ†ï¼‰&lt;/p&gt;

&lt;p&gt;åœ¨ç¬¬ä¸€æ¬¡åˆå§‹åŒ–ReactNativeçš„æ—¶å€™æ¨¡å—ä¿¡æ¯ä¼šè¢«åˆå§‹åŒ–ï¼ŒåŒ…æ‹¬æ¨¡å—åç§°ã€æ–¹æ³•åã€‚åœ¨æ³¨å†Œæ¨¡å—çš„æ—¶å€™æˆ‘ä»¬ä¼šç”¨åˆ°&lt;code&gt;RCT_EXPORT_MODULE();&lt;/code&gt;è¿™ä¸ªå®ï¼Œå®å±•å¼€&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;#define RCT_EXPORT_MODULE(js_name) \
RCT_EXTERN void RCTRegisterModule(Class); \
+ (NSString *)moduleName { return @#js_name; } \
+ (void)load { RCTRegisterModule(self); }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ–¹æ³•1:å¦‚æœè‡ªå®šä¹‰äº†æ¨¡å—çš„åç§°å°±ä½¿ç”¨è‡ªå®šä¹‰çš„åç§°è€Œä¸æ˜¯åŸç±»çš„åç§°&lt;/p&gt;

&lt;p&gt;æ–¹æ³•2:åœ¨+(void)loadæ–¹æ³•é‡Œå¯¹ç±»è¿›è¡Œä¸€æ¬¡æ³¨å†Œï¼Œæ³¨å†Œä»£ç å¦‚ä¸‹&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;void RCTRegisterModule(Class moduleClass)
{
  static dispatch_once_t onceToken;
  dispatch_once(&amp;amp;onceToken, ^{
    RCTModuleClasses = [NSMutableArray new];
  });

  RCTAssert([moduleClass conformsToProtocol:@protocol(RCTBridgeModule)],
            @&amp;quot;%@ does not conform to the RCTBridgeModule protocol&amp;quot;,
            moduleClass);

  // Register module
  [RCTModuleClasses addObject:moduleClass];
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚æœå½“å‰ç±»éµå¾ªåè®®&lt;code&gt;RCTBridgeModule&lt;/code&gt;,å°±æŠŠå®ƒæ”¾åˆ°ä¸€ä¸ªé™æ€å˜é‡æ•°ç»„&lt;code&gt;RCTModuleClasses&lt;/code&gt;ä¸­ã€‚æ‰€ä»¥å¯åŠ¨ä¹‹åï¼Œæ‰€æœ‰RNéœ€è¦çš„æ¨¡å—éƒ½ä¼šè¢«åŠ¨æ€è½½å…¥ã€‚
è¿™äº›æ¨¡å—ä¼šè¢«å­˜å‚¨åœ¨ä¸‰å¼ è¡¨ä¸­&lt;code&gt;_moduleDataByName&lt;/code&gt;ã€&lt;code&gt;_moduleDataByID&lt;/code&gt;ã€&lt;code&gt;_moduleClassesByID&lt;/code&gt;,åœ¨åˆå§‹åŒ–çš„æ—¶å€™é€šè¿‡éå†è¯¥æ•°ç»„æ¥åˆå§‹åŒ–ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;NSDictionary&amp;lt;NSString *, RCTModuleData *&amp;gt; *_moduleDataByName;
NSArray&amp;lt;RCTModuleData *&amp;gt; *_moduleDataByID;
NSArray&amp;lt;Class&amp;gt; *_moduleClassesByID;
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;for (Class moduleClass in RCTGetModuleClasses()) {
    NSString *moduleName = RCTBridgeModuleNameForClass(moduleClass);

    // Check for module name collisions
    RCTModuleData *moduleData = moduleDataByName[moduleName];
    if (moduleData) {
      if (moduleData.hasInstance) {
        // Existing module was preregistered, so it takes precedence
        continue;
      } else if ([moduleClass new] == nil) {
        // The new module returned nil from init, so use the old module
        continue;
      } else if ([moduleData.moduleClass new] != nil) {
        // Both modules were non-nil, so it&#39;s unclear which should take precedence
        RCTLogError(@&amp;quot;Attempted to register RCTBridgeModule class %@ for the &amp;quot;
                    &amp;quot;name &#39;%@&#39;, but name was already registered by class %@&amp;quot;,
                    moduleClass, moduleName, moduleData.moduleClass);
      }
    }

    // Instantiate moduleData (TODO: can we defer this until config generation?)
    moduleData = [[RCTModuleData alloc] initWithModuleClass:moduleClass
                                                     bridge:self];
    moduleDataByName[moduleName] = moduleData;
    [moduleClassesByID addObject:moduleClass];
    [moduleDataByID addObject:moduleData];
  }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åˆ†åˆ«æ˜¯æ¨¡å—åç§°ã€æ¨¡å—åç§°å¯¹åº”çš„å¯¹è±¡&lt;code&gt;RCTModuleData&lt;/code&gt;ã€æ¨¡å—åç§°å’Œæ¨¡å—å¯¹è±¡çš„æ˜ å°„å­—å…¸ï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;è¿™æ—¶å€™è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ä¸œè¥¿éœ€è¦å¤„ç†å°±æ˜¯callbackï¼ŒJSBridgeåœ¨ä¼ é€’æ¶ˆæ¯çš„æ—¶å€™ä¼šæŠŠcallbackç¼“å­˜èµ·æ¥ï¼Œä»…ä»…æŠŠcallbackIdä¼ é€’åˆ°OCBridgeã€‚
è¿™æ—¶å€™OCBridgeæ‹¿åˆ°äº†ä¼ è¿‡æ¥çš„ModuleIdã€MethodIdã€callbackIdï¼Œå†é€šè¿‡Nativeç«¯çš„é…ç½®è¡¨åˆ†åˆ«å–å‡ºæ¨¡å—å’Œæ–¹æ³•ã€‚æ¨¡å—ä¼šè¢«è½¬åŒ–ä¸º&lt;code&gt;RCTModuleData&lt;/code&gt;å¯¹è±¡ï¼Œæ–¹æ³•éƒ½ä¼šè¢«è½¬åŒ–ä¸ºä¸€ä¸ª&lt;code&gt;RCTModuleMethod&lt;/code&gt;å¯¹è±¡ï¼Œçœ‹ä¸€ä¸‹è¿™ä¸ªå¯¹è±¡&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{
  Class _moduleClass;
  const RCTMethodInfo *_methodInfo;
  NSString *_JSMethodName;

  SEL _selector;
  NSInvocation *_invocation;
  NSArray&amp;lt;RCTArgumentBlock&amp;gt; *_argumentBlocks;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å‘ç°äº†&lt;code&gt;_moduleClass&lt;/code&gt;ã€&lt;code&gt;_argumentBlocks&lt;/code&gt;ã€&lt;code&gt;_invocation&lt;/code&gt;ã€&lt;code&gt;_selector&lt;/code&gt;è¿™æ—¶å€™å°±å¾ˆå®¹æ˜“æƒ³åˆ°æ¶ˆæ¯è½¬å‘çš„æœ€åä¸€ä¸ªé˜¶æ®µï¼Œå°†æ¶ˆæ¯çš„ç›®æ ‡ã€selectorã€å‚æ•°å°è£…åˆ°NSInvocationä¸­è¿›è¡Œæ¶ˆæ¯è½¬å‘ã€‚&lt;/p&gt;

&lt;p&gt;åˆšæ‰ä¸Šé¢è®²åˆ°æ¨¡å—çš„æ³¨å†Œï¼Œé‚£ä¹ˆæ–¹æ³•æ˜¯å¦‚ä½•ç­›é€‰çš„å‘¢ï¼Ÿæ³¨æ„ä¸‹é¢çš„3ä¸ªå®&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;#define RCT_EXPORT_METHOD(method) \
  RCT_REMAP_METHOD(, method)
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;#define RCT_REMAP_METHOD(js_name, method) \
  _RCT_EXTERN_REMAP_METHOD(js_name, method, NO) \
  - (void)method;
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;#define _RCT_EXTERN_REMAP_METHOD(js_name, method, is_blocking_synchronous_method) \
  + (const RCTMethodInfo *)RCT_CONCAT(__rct_export__, RCT_CONCAT(js_name, RCT_CONCAT(__LINE__, __COUNTER__))) { \
    static RCTMethodInfo config = {#js_name, #method, is_blocking_synchronous_method}; \
    return &amp;amp;config; \
  }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨æˆ‘ä»¬å…·ä½“å®šä¹‰æ–¹æ³•çš„æ—¶å€™å¹¶æ²¡æœ‰&lt;code&gt;-(void)&lt;/code&gt;å­—ç¬¦ä¸²å‰ç¼€ï¼Œå› ä¸ºåœ¨é¢„ç¼–è¯‘çš„æ—¶å€™ï¼Œå®ä¼šå¸®æˆ‘ä»¬åŠ ä¸Šè¿™æ®µå­—ç¬¦ï¼ˆçœ‹ç¬¬äºŒä¸ªå®ï¼‰ã€‚
ç¬¬ä¸‰ä¸ªå®ä¸»è¦å®ç°äº†å­—ç¬¦ä¸²çš„æ‹¼æ¥ï¼Œ&lt;code&gt;(__LINE__, __COUNTER__)&lt;/code&gt;çš„æ„æ€æ˜¯ä¸ºå½“å‰çš„å®ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„tagï¼ˆè¡Œæ•°+ä¸€ä¸ªæ•°å­—ï¼‰ï¼Œå†å’Œå‰é¢çš„&lt;code&gt;js_name&lt;/code&gt;è¿æ¥ï¼Œæœ€åå†å’Œ&lt;code&gt;__rct_export__&lt;/code&gt;è¿æ¥ï¼Œå¤§æ¦‚åƒè¿™æ ·&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;-(void)__rct_export__8976699MethodName{
	//
}
&lt;/code&gt;&lt;/pre&gt;

&lt;blockquote&gt;
&lt;p&gt;å…¶å®&lt;strong&gt;COUNTER&lt;/strong&gt;æ˜¯ä¸€ä¸ªé¢„å®šä¹‰çš„å®ï¼Œè¿™ä¸ªå€¼åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å°†ä»0å¼€å§‹è®¡æ•°ï¼Œæ¯æ¬¡è¢«è°ƒç”¨æ—¶åŠ 1ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;æ‰€æœ‰JSBridgeä¼ è¿‡æ¥çš„å‚æ•°éƒ½æ˜¯&lt;code&gt;NSNumber&lt;/code&gt;,OCBridgeä¼šæŠŠå®ƒä»¬è½¬åŒ–æˆåŸºæœ¬ç±»å‹å’Œå­—ç¬¦ä¸²ã€‚ä¸Šé¢åœ¨æåˆ°JSBridgeä¼ å‚æ•°çš„æ—¶å€™ä¼šå¸¦ä¸€ä¸ªcallbackIdï¼Œè¿™æ—¶å€™OCBridgeä¼šæ ¹æ®è¿™ä¸ªIdç”Ÿæˆä¸€ä¸ªcallbackï¼Œä¿å­˜åœ¨å†…å­˜ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;è¿™æ—¶å€™OCæ‰§è¡Œæ–¹æ³•çš„è°ƒç”¨ï¼Œæ‰§è¡Œblockã€‚å°†å‚æ•°å’ŒcallbackIdä¼ åˆ°JSBridgeï¼ŒJSBridgeæ ¹æ®Idæ‰¾åˆ°ä¹‹å‰ç¼“å­˜çš„JSCallbackï¼Œè¿›è¡Œè°ƒç”¨ã€‚åˆ°è¿™é‡Œå°±å®ŒæˆRN-Native-RNçš„ä¸€ä¸ªé—­ç¯ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;JSæ˜¯æ€ä¹ˆè°ƒç”¨OCçš„å‘¢ï¼Ÿ&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;å…¶å®å¹¶ä¸æ˜¯JSè°ƒç”¨OCï¼Œè€Œæ˜¯JSå°†æ¶ˆæ¯æ”¾åˆ°ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—é‡Œé¢MessageQueueï¼Œç­‰OCæ¥å–ï¼Œè¿™é‡Œé¢è¿˜æœ‰å¾ˆå¤šé—®é¢˜å€¼å¾—è®¨è®ºå¤šé•¿æ—¶é—´å–ä¸€æ¬¡ï¼›ä¸æ¥å–æ€ä¹ˆåŠã€‚æœ‰å¾…æˆ‘ä»¬ç»§ç»­ç ”ç©¶&lt;/p&gt;

&lt;hr /&gt;

&lt;blockquote&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆOCå’ŒJSå¯ä»¥å®ç°è¿™ç§æ¡†æ¶ï¼Ÿ&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;è¦å®ç°è¿™ä¸ªæœºåˆ¶éœ€è¦è¯­è¨€æœ‰åŠ¨æ€åå°„çš„ç‰¹æ€§(OCæ˜¯ä¸€é—¨åŠ¨æ€è¯­è¨€ï¼Œæ¶ˆæ¯å’Œæ¶ˆæ¯çš„targetç­‰éƒ½æ˜¯åœ¨è¿è¡Œæ—¶å†³å®š)ï¼Œå³å¯ä»¥é€šè¿‡ç±»/æ–¹æ³•åå­—ç¬¦ä¸²æ‰¾åˆ°å¯¹åº”çš„ç±»/æ–¹æ³•è¿›è¡Œè°ƒç”¨ï¼Œæ²¡æœ‰è¿™ç‰¹æ€§å°±åšä¸äº†ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;çŸ¥è¯†ç‚¹&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨&lt;a href=&#34;https://linkrober.github.io/bookshelf/2017/09/run-loops-%E4%B8%80/&#34;&gt;RunLoop&lt;/a&gt;è®©JSçº¿ç¨‹å¸¸é©»å†…å­˜&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code&gt;//RCTJSCExecutor

+ (void)runRunLoopThread
{
  @autoreleasepool {
    // copy thread name to pthread name
    pthread_setname_np([NSThread currentThread].name.UTF8String);

    // Set up a dummy runloop source to avoid spinning
    CFRunLoopSourceContext noSpinCtx = {0, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL};
    CFRunLoopSourceRef noSpinSource = CFRunLoopSourceCreate(NULL, 0, &amp;amp;noSpinCtx);
    CFRunLoopAddSource(CFRunLoopGetCurrent(), noSpinSource, kCFRunLoopDefaultMode);
    CFRelease(noSpinSource);

    // run the run loop
    while (kCFRunLoopRunStopped != CFRunLoopRunInMode(kCFRunLoopDefaultMode, ((NSDate *)[NSDate distantFuture]).timeIntervalSinceReferenceDate, NO)) {
      RCTAssert(NO, @&amp;quot;not reached assertion&amp;quot;); // runloop spun. that&#39;s bad.
    }
  }
}

static NSThread *newJavaScriptThread(void)
{
  NSThread *javaScriptThread = [[NSThread alloc] initWithTarget:[RCTJSCExecutor class]
                                                       selector:@selector(runRunLoopThread)
                                                         object:nil];
  javaScriptThread.name = RCTJSCThreadName;
  javaScriptThread.qualityOfService = NSOperationQualityOfServiceUserInteractive;
  [javaScriptThread start];
  return javaScriptThread;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;é€šè¿‡åŠ¨æ€&lt;a href=&#34;https://linkrober.github.io/bookshelf/2017/10/runtime%E4%B8%89-%E6%B6%88%E6%81%AF%E8%BD%AC%E5%8F%91/&#34;&gt;æ¶ˆæ¯è½¬å‘&lt;/a&gt;å‘é€æ¥è‡ªRNçš„æ¶ˆæ¯,RCTModuleMethod&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code&gt;//RCTModuleMethod

NSMethodSignature *typeSignature = [RCTConvert methodSignatureForSelector:selector];
NSInvocation *typeInvocation = [NSInvocation invocationWithMethodSignature:typeSignature];
typeInvocation.selector = selector;
typeInvocation.target = [RCTConvert class];

[argumentBlocks addObject:^(__unused RCTBridge *bridge, NSUInteger index, id json) {
void *returnValue = malloc(typeSignature.methodReturnLength);
[typeInvocation setArgument:&amp;amp;json atIndex:2];
[typeInvocation invoke];
[typeInvocation getReturnValue:returnValue];
[invocation setArgument:returnValue atIndex:index + 2];
free(returnValue);
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;ç”¨Runtimeæ‹¿åˆ°æ‰€æœ‰çš„ç±»ä¿¡æ¯å’Œæ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code&gt;//RCTBridge

void RCTVerifyAllModulesExported(NSArray *extraModules)
{
  // Check for unexported modules
  unsigned int classCount;
  Class *classes = objc_copyClassList(&amp;amp;classCount);

  NSMutableSet *moduleClasses = [NSMutableSet new];
  [moduleClasses addObjectsFromArray:RCTGetModuleClasses()];
  [moduleClasses addObjectsFromArray:[extraModules valueForKeyPath:@&amp;quot;class&amp;quot;]];

  for (unsigned int i = 0; i &amp;lt; classCount; i++) {
    Class cls = classes[i];
    Class superclass = cls;
    while (superclass) {
      if (class_conformsToProtocol(superclass, @protocol(RCTBridgeModule))) {
        if ([moduleClasses containsObject:cls]) {
          break;
        }

        // Verify it&#39;s not a super-class of one of our moduleClasses
        BOOL isModuleSuperClass = NO;
        for (Class moduleClass in moduleClasses) {
          if ([moduleClass isSubclassOfClass:cls]) {
            isModuleSuperClass = YES;
            break;
          }
        }
        if (isModuleSuperClass) {
          break;
        }

        RCTLogWarn(@&amp;quot;Class %@ was not exported. Did you forget to use RCT_EXPORT_MODULE()?&amp;quot;, cls);
        break;
      }
      superclass = class_getSuperclass(superclass);
    }
  }

  free(classes);
}
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;GCDçš„å¤§é‡ä½¿ç”¨ï¼Œåœ¨åˆå§‹åŒ–å„ä¸ªæ¨¡å—æ—¶(initModulesAndLoadSourceå’ŒsetupJSExecutorAndModuleConfigè¿™ä¸¤ä¸ªgroup)å¯¹äºçº¿ç¨‹ä¾èµ–çš„æ§åˆ¶&lt;code&gt;dispatch_group_enter();&lt;/code&gt;&lt;code&gt;dispatch_group_leave()&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code&gt;//RCTBatchedBridge

- (void)start
{
  [[NSNotificationCenter defaultCenter]
    postNotificationName:RCTJavaScriptWillStartLoadingNotification
    object:_parentBridge userInfo:@{@&amp;quot;bridge&amp;quot;: self}];

  RCT_PROFILE_BEGIN_EVENT(0, @&amp;quot;-[RCTBatchedBridge setUp]&amp;quot;, nil);

  dispatch_queue_t bridgeQueue = dispatch_queue_create(&amp;quot;com.facebook.react.RCTBridgeQueue&amp;quot;, DISPATCH_QUEUE_CONCURRENT);

  dispatch_group_t initModulesAndLoadSource = dispatch_group_create();

  // Asynchronously load source code
  dispatch_group_enter(initModulesAndLoadSource);
  __weak RCTBatchedBridge *weakSelf = self;
  __block NSData *sourceCode;
  [self loadSource:^(NSError *error, NSData *source, __unused int64_t sourceLength) {
    if (error) {
      RCTLogWarn(@&amp;quot;Failed to load source: %@&amp;quot;, error);
      dispatch_async(dispatch_get_main_queue(), ^{
        [weakSelf stopLoadingWithError:error];
      });
    }

    sourceCode = source;
    dispatch_group_leave(initModulesAndLoadSource);
  } onProgress:^(RCTLoadingProgress *progressData) {
#if RCT_DEV &amp;amp;&amp;amp; __has_include(&amp;quot;RCTDevLoadingView.h&amp;quot;)
    RCTDevLoadingView *loadingView = [weakSelf moduleForClass:[RCTDevLoadingView class]];
    [loadingView updateProgress:progressData];
#endif
  }];

  // Synchronously initialize all native modules that cannot be loaded lazily
  [self initModulesWithDispatchGroup:initModulesAndLoadSource];

  RCTPerformanceLogger *performanceLogger = self-&amp;gt;_performanceLogger;
  __block NSString *config;
  dispatch_group_enter(initModulesAndLoadSource);
  dispatch_async(bridgeQueue, ^{
    dispatch_group_t setupJSExecutorAndModuleConfig = dispatch_group_create();

    // Asynchronously initialize the JS executor
    dispatch_group_async(setupJSExecutorAndModuleConfig, bridgeQueue, ^{
      [performanceLogger markStartForTag:RCTPLJSCExecutorSetup];
      [weakSelf setUpExecutor];
      [performanceLogger markStopForTag:RCTPLJSCExecutorSetup];
    });

    // Asynchronously gather the module config
    dispatch_group_async(setupJSExecutorAndModuleConfig, bridgeQueue, ^{
      if (weakSelf.valid) {
        RCT_PROFILE_BEGIN_EVENT(0, @&amp;quot;-[RCTBatchedBridge moduleConfig&amp;quot;, nil);
        [performanceLogger markStartForTag:RCTPLNativeModulePrepareConfig];
        config = [weakSelf moduleConfig];
        [performanceLogger markStopForTag:RCTPLNativeModulePrepareConfig];
        RCT_PROFILE_END_EVENT(RCTProfileTagAlways, @&amp;quot;&amp;quot;);
      }
    });

    dispatch_group_notify(setupJSExecutorAndModuleConfig, bridgeQueue, ^{
      // We&#39;re not waiting for this to complete to leave dispatch group, since
      // injectJSONConfiguration and executeSourceCode will schedule operations
      // on the same queue anyway.
      [performanceLogger markStartForTag:RCTPLNativeModuleInjectConfig];
      [weakSelf injectJSONConfiguration:config onComplete:^(NSError *error) {
        [performanceLogger markStopForTag:RCTPLNativeModuleInjectConfig];
        if (error) {
          RCTLogWarn(@&amp;quot;Failed to inject config: %@&amp;quot;, error);
          dispatch_async(dispatch_get_main_queue(), ^{
            [weakSelf stopLoadingWithError:error];
          });
        }
      }];
      dispatch_group_leave(initModulesAndLoadSource);
    });
  });

  dispatch_group_notify(initModulesAndLoadSource, bridgeQueue, ^{
    RCTBatchedBridge *strongSelf = weakSelf;
    if (sourceCode &amp;amp;&amp;amp; strongSelf.loading) {
      [strongSelf executeSourceCode:sourceCode];
    }
  });

  RCT_PROFILE_END_EVENT(RCTProfileTagAlways, @&amp;quot;&amp;quot;);
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;å‚è€ƒæ–‡æ¡£&#34;&gt;å‚è€ƒæ–‡æ¡£&lt;/h4&gt;

&lt;p&gt;&lt;a href=&#34;http://blog.cnbang.net/tech/2698/&#34;&gt;React Nativeé€šä¿¡æœºåˆ¶è¯¦è§£&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://awhisper.github.io/2016/06/24/ReactNative%E6%B5%81%E7%A8%8B%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/&#34;&gt;ReactNative iOSæºç è§£æ&lt;/a&gt;&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>iOSå¤šçº¿ç¨‹ä¸­çš„é”</title>
      <link>https://linkrober.github.io/bookshelf/2017/12/ios%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%AD%E7%9A%84%E9%94%81/</link>
      <pubDate>Fri, 01 Dec 2017 00:00:00 +0000</pubDate>
      
      <guid>https://linkrober.github.io/bookshelf/2017/12/ios%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%AD%E7%9A%84%E9%94%81/</guid>
      <description>&lt;p&gt;æ¶‰åŠåˆ°å¤šçº¿ç¨‹å…±äº«èµ„æºçš„æƒ…å†µä¸‹å°±é¿å…ä¸äº†èµ„æºç«äº‰çš„é—®é¢˜ï¼Œè¿™æ—¶å€™å°±ä¼šç”¨åˆ°å„ç§é”ï¼Œä¾‹å¦‚ï¼Œ&lt;code&gt;@synchronized&lt;/code&gt;ã€&lt;code&gt;NSLock&lt;/code&gt;ã€&lt;code&gt;OSSpinLock&lt;/code&gt;ç­‰ç­‰ï¼Œè™½ç„¶éƒ½æ˜¯é”ï¼Œä½†æ˜¯é”çš„åº•å±‚å®ç°ä¹Ÿä¸å°½ç›¸åŒã€‚å¤§æ¦‚å¯ä»¥åˆ†ä¸ºï¼š&lt;span class=&#34;highlight-text blue&#34;&gt;äº’æ–¥é”&lt;/span&gt;ã€&lt;span class=&#34;highlight-text blue&#34;&gt;è‡ªæ—‹é”&lt;/span&gt;ã€&lt;span class=&#34;highlight-text blue&#34;&gt;é€’å½’é”&lt;/span&gt;ã€
&lt;span class=&#34;highlight-text blue&#34;&gt;è¯»å†™é”&lt;/span&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{
	lock()//åŠ é”
		doSomeThing()//ä¸´ç•ŒåŒº
	unlock()//è§£é”
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æˆ‘ä»¬é”çš„ç›®çš„æ˜¯åœ¨ä»»ä½•æ—¶åˆ»æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨ä¿®æ”¹èµ„æºï¼Œå³åœ¨ä»»ä½•æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªæ“ä½œè€…ä¿æŒé”ã€‚&lt;/p&gt;

&lt;p&gt;&lt;/p&gt;

&lt;h4 id=&#34;äº’æ–¥é”&#34;&gt;äº’æ–¥é”&lt;/h4&gt;

&lt;p&gt;é€šè¿‡ä¸€ä¸ªå…¨å±€å˜é‡æ¥æ§åˆ¶æŸä¸ªçº¿ç¨‹æ˜¯å¦å¯ä»¥åœ¨æŸä¸ªæ—¶åˆ»è®¿é—®èµ„æºï¼Œè¯¥å˜é‡å€¼å¤§äº0è¯´æ˜é”æ­£åœ¨è¢«ä½¿ç”¨ã€‚å¦‚æœæŸä¸ªçº¿ç¨‹åœ¨å°è¯•è·å¾—é”çš„æ˜¯å¦å‘ç°å·²ç»è¢«å ç”¨ï¼Œçº¿ç¨‹æŒ‚èµ·ï¼Œç­‰å¾…é”çš„é‡Šæ”¾ã€‚&lt;/p&gt;

&lt;h4 id=&#34;è‡ªæ—‹é”&#34;&gt;è‡ªæ—‹é”&lt;/h4&gt;

&lt;p&gt;é€šè¿‡ä¸€ä¸ªå…¨å±€å˜é‡æ¥æ§åˆ¶æŸä¸ªçº¿ç¨‹æ˜¯å¦å¯ä»¥åœ¨æŸä¸ªæ—¶åˆ»è®¿é—®èµ„æºï¼Œè¯¥å˜é‡å€¼å¤§äº0è¯´æ˜é”æ­£åœ¨è¢«ä½¿ç”¨ã€‚å¦‚æœæŸä¸ªçº¿ç¨‹åœ¨å°è¯•è·å¾—é”çš„æ˜¯å¦å‘ç°å·²ç»è¢«å ç”¨ï¼Œè¿›å…¥å¿™ç­‰çŠ¶æ€ï¼Œç›´åˆ°è·å¾—é”ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;ä»¥ä¸Šå¯ä»¥çœ‹å‡ºï¼Œäº’æ–¥é”å’Œè‡ªæ—‹é”å¾ˆç±»ä¼¼ï¼Œç¨æœ‰ä¸åŒçš„åœ°æ–¹åœ¨äºå½“å¤„äºç­‰å¾…çŠ¶æ€çš„æ—¶å€™å„è‡ªçš„çº¿ç¨‹æ˜¯æ€ä¹ˆè°ƒåº¦çš„ã€‚äº’æ–¥é”å³ä½¿æ—¶é—´ç‰‡è¿˜æœªç”¨å°½ï¼Œäº’æ–¥é”ä¹Ÿä¼šç›´æ¥æŒ‚èµ·ï¼Œè¿™æ ·å°±å‡å°‘äº†CPUçš„å¼€é”€ã€‚ä½†æ˜¯è¿™æ—¶å€™ä¼šè¿›è¡Œä¸Šä¸‹æ–‡ï¼ˆçº¿ç¨‹ï¼‰çš„åˆ‡æ¢ï¼Œä¹Ÿä¼šå¸¦æ¥ä¸€å®šçš„å¼€é”€ï¼Œé€‚åˆI/Oå¯†é›†å‹æ“ä½œã€‚è‡ªæ—‹é”ï¼Œé¡¾åæ€ä¹‰ï¼Œå³ä½¿å¤„äºç­‰å¾…çŠ¶æ€çº¿ç¨‹ä¹Ÿä¸ä¼šæŒ‚èµ·ï¼Œä¸€ç›´å¤„äºå¿™ç­‰çŠ¶æ€ï¼Œç±»ä¼¼äºä¸€ç›´åœ¨è¿›è¡Œä¸€ä¸ªwhilteå¾ªç¯ã€‚è¿™æ ·å¢åŠ äº†CPUçš„å¼€é”€ï¼Œæ‰€ä»¥å¯¹äºéœ€è¦ä¿æŒä¸Šä¸‹æ–‡çš„ä»»åŠ¡å¿…é¡»è¦ä½¿ç”¨è‡ªæ—‹é”ï¼ŒåŒæ—¶å®ƒæ˜¯ä¸èƒ½è¢«æŠ¢å çš„ï¼ˆé«˜ä¼˜å…ˆçº§ä¼šæŠ¢å ä½ä¼˜å…ˆçº§çš„è¿›ç¨‹ï¼‰ï¼Œé€‚ç”¨äºCPUå¯†é›†å‹çš„ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&#34;é€’å½’é”&#34;&gt;é€’å½’é”&lt;/h4&gt;

&lt;p&gt;å¯¹äºé€’å½’è°ƒçš„æ—¶å€™æˆ‘ä»¬ä¸èƒ½ç®€å•çš„ä½¿ç”¨æŸä¸ªé”æ¥é”ä½ä¸´ç•ŒåŒºï¼Œè¿™æ ·å°±ä¼šé€ æˆæ­»é”ï¼Œå¿…é¡»è¦ä½¿ç”¨é€’å½’é”ã€‚å½“åŠ é”çš„æ—¶å€™ï¼Œå˜é‡å°±ä¼šåŠ 1ï¼Œè§£é”çš„æ—¶å€™å¼€å§‹å‡1ï¼Œç›´åˆ°å€¼ä¸º0çš„æ—¶å€™é‡Šæ”¾é”ã€‚&lt;/p&gt;

&lt;h4 id=&#34;è¯»å†™é”&#34;&gt;è¯»å†™é”&lt;/h4&gt;

&lt;p&gt;åœ¨ä¸Šé¢æåˆ°çš„å‡ ç§é”åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®èµ„æºï¼Œåœ¨æ“ä½œèµ„æºçš„æ—¶å€™ï¼Œå¾€å¾€ä¼šå‡ºç°ä¸€ä¸ªçº¿ç¨‹åœ¨å†™æ“ä½œï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨è¯»æ“ä½œï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±ä¼šç”¨åˆ°è¯»å†™é”ã€‚
è¯»å†™é”ï¼Œå®ƒåˆ†ä¸ºä¸¤ç§é”ï¼Œè¯»é”å’Œå†™é”ã€‚å½“ä¸€ä¸ªçº¿ç¨‹åœ¨è¯»èµ„æºçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸ºå…¶åŠ ä¸Šè¯»é”ï¼Œæœ‰å¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿè¦è®¿é—®èµ„æºçš„æ—¶å€™æˆ‘ä»¬éœ€è¦å†åŠ ä¸€ä¸ªè¯»é”ã€‚å½“ç¬¬ä¸‰ä¸ªçº¿ç¨‹éœ€è¦è¿›è¡Œå†™æ“ä½œçš„æ—¶å€™æˆ‘ä»¬å°±è¦åŠ ä¸Šä¸€ä¸ªå†™é”ï¼Œä½†æ˜¯è¿™ä¸ªå†™é”åªæœ‰å½“è¯»é”çš„ä½¿ç”¨è€…ä¸º0çš„æ—¶å€™æ‰æœ‰æ•ˆã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¿…é¡»ç­‰å¦å¤–ä¸¤ä¸ªçº¿ç¨‹çš„è¯»æ“ä½œç»“æŸä¹‹åæ‰èƒ½ä¸ºå…¶åŠ ä¸Šå†™é”ã€‚è™½ç„¶äº’æ–¥é”å’Œè‡ªæ—‹é”ä¹Ÿèƒ½è¾¾åˆ°è¦æ±‚ï¼Œä½†æ˜¯è¯»å†™é”æ— ç–‘è®©æ§åˆ¶æ›´åŠ ç²¾ç»†ï¼ŒèŠ‚çœäº†CPUã€‚&lt;/p&gt;

&lt;h4 id=&#34;iosä¸­çš„é”&#34;&gt;iOSä¸­çš„é”&lt;/h4&gt;

&lt;p&gt;å¤§ç¥ibiremeçš„ä¸€ç¯‡åšå®¢&lt;a href=&#34;https://blog.ibireme.com/2016/01/16/spinlock_is_unsafe_in_ios/&#34;&gt;ä¸å†å®‰å…¨çš„ OSSpinLock&lt;/a&gt;å¯¹é”çš„æ€§èƒ½åšäº†ç®€å•çš„æ¯”è¾ƒï¼Œå¤§å®¶å¯ä»¥çœ‹ä¸‹ã€‚
&lt;img src=&#34;../../../æ¥è‡ªibiremeçš„åšå®¢.png&#34; alt=&#34;æ¥è‡ªibiremeçš„åšå®¢&#34; /&gt;&lt;/p&gt;

&lt;h6 id=&#34;osspinlock&#34;&gt;OSSpinLock&lt;/h6&gt;

&lt;span class=&#34;highlight-text blue&#34;&gt;è‡ªæ—‹é”&lt;/span&gt;

&lt;p&gt;åœ¨æ­¤ä¹‹å‰OSSpinLockæ˜¯æ— ç–‘æ€§èƒ½æœ€å¥½çš„é”ï¼Œåœ¨2015å¹´çš„æ—¶å€™è‹¹æœå·¥ç¨‹å¸ˆé€éœ²å‡ºäº†è‡ªæ—‹é”çš„bugã€‚å…·ä½“é—®é¢˜å¤§æ¦‚å¦‚ä¸‹ï¼š
ç³»ç»Ÿç»´æŠ¤äº†ä¸åŒç­‰çº§ä¼˜å…ˆçº§çš„çº¿ç¨‹ï¼Œé«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹æ›´å®¹æ˜“è·å¾—ç³»ç»Ÿèµ„æºã€‚å½“ä¸€ä¸ªä½ä¼˜å…ˆçº§çš„çº¿ç¨‹å…ˆè·å¾—é”ä¹‹åï¼Œé«˜ä¼˜å…ˆçº§çº¿ç¨‹è¿™æ—¶å€™ä¹Ÿè¯•å›¾è·å–é”ã€‚è¿™æ—¶å€™é«˜ä¼˜å…ˆçº§å æ®äº†å¤§é‡çš„CPUï¼Œä¸€ç›´å¤„äºå¿™ç­‰çŠ¶æ€ã€‚è€Œä½ä¼˜å…ˆçº§çš„çº¿ç¨‹å› ä¸ºæ²¡æœ‰åˆ†é…åˆ°è¶³å¤Ÿçš„CPUä¸€ç›´æ— æ³•å®Œæˆä»»åŠ¡ï¼Œä¹Ÿå°±æ— æ³•é‡Šæ”¾é”ã€‚è¿™æ—¶å€™çº¿ç¨‹çš„è°ƒåº¦å°±äº§ç”Ÿäº†ä¼˜å…ˆçº§ç¿»è½¬ã€‚&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;/b&gt;
&lt;span class=&#34;highlight-text success&#34;&gt;
Example
&lt;/span&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;//å®šä¹‰OSSpinLocké”
__block OSSpinLock theLock = OS_SPINLOCK_INIT;
//çº¿ç¨‹1
dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
    OSSpinLockLock(&amp;amp;theLock); 
    NSLog(@&amp;quot;éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 å¼€å§‹&amp;quot;); 
    sleep(3); 
    NSLog(@&amp;quot;éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 ç»“æŸ&amp;quot;);
    OSSpinLockUnlock(&amp;amp;theLock);
});
//çº¿ç¨‹2
dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
     OSSpinLockLock(&amp;amp;theLock); 
     sleep(1); 
     NSLog(@&amp;quot;éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ2&amp;quot;); 
     OSSpinLockUnlock(&amp;amp;theLock);
});

&lt;/code&gt;&lt;/pre&gt;

&lt;h6 id=&#34;sychronized&#34;&gt;sychronized&lt;/h6&gt;

&lt;p&gt;&lt;span class=&#34;highlight-text blue&#34;&gt;äº’æ–¥é”&lt;/span&gt; &lt;span class=&#34;highlight-text blue&#34;&gt;é€’å½’é”&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;iOSä¸­æ€§èƒ½æœ€å·®çš„é”ï¼Œä½†æ˜¯å†™èµ·æ¥å¾ˆå¼€å¿ƒï¼Œç”¨èµ·æ¥ç®€å•ï¼Œæ— è®ºæ™®é€šçš„é”è¿˜æ˜¯é€’å½’é”éƒ½èƒ½åº”å¯¹ã€‚å®ƒç‰ºç‰²äº†æ€§èƒ½ï¼Œä¿è¯äº†æ¥å£å¾—å‹å¥½ã€‚å®ƒä¼šæŠŠæ¯ä¸ªä¼ å…¥çš„å¯¹è±¡å½“ä½œé”ï¼ˆè¿™è¦æ±‚æˆ‘ä»¬è¦ä¿è¯å¯¹è±¡çš„å”¯ä¸€æ€§ï¼‰å¹¶æŠŠä»–ä»¬æ”¾åœ¨ä¸€ä¸ªå“ˆå¸Œè¡¨ä¸­å­˜å‚¨ï¼Œé€šè¿‡è¿™å¼ è¡¨æ¥ç®¡ç†é”ã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹è±¡ä¸èƒ½ä¸º&lt;strong&gt;nil&lt;/strong&gt;ï¼Œè¿™ä¼šè®©ä¸´ç•ŒåŒºä¸å†æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;/b&gt;&lt;/p&gt;

&lt;span class=&#34;highlight-text success&#34;&gt;
Example
&lt;/span&gt;

&lt;pre&gt;&lt;code&gt;//éœ€è¦åŠ é”çš„å¯¹è±¡
NSObject *obj = [[NSObject alloc] init];
//çº¿ç¨‹1
dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
    @synchronized(obj) {
         NSLog(@&amp;quot;éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 å¼€å§‹&amp;quot;);
         sleep(3); 
         NSLog(@&amp;quot;éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 ç»“æŸ&amp;quot;);
     } 
  }); 
//çº¿ç¨‹2
dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{ 
    sleep(1); 
    @synchronized(obj) { 
         NSLog(@&amp;quot;éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ2&amp;quot;); 
     } 
});

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;Result&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ThreadTest[13438:385647] éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 å¼€å§‹
ThreadTest[13438:385647] éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 ç»“æŸ
ThreadTest[13438:385646] éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ2
&lt;/code&gt;&lt;/pre&gt;

&lt;h6 id=&#34;nslock&#34;&gt;NSLock&lt;/h6&gt;

&lt;span class=&#34;highlight-text blue&#34;&gt;äº’æ–¥é”&lt;/span&gt;

&lt;p&gt;å°†Cè¯­è¨€çš„pthread_mutexé”è¿›è¡Œäº†ä¸€æ¬¡å°è£…ï¼Œæ›´åŠ çš„OCã€‚&lt;code&gt;NSLock&lt;/code&gt;æä¾›äº†&lt;code&gt;tryLock&lt;/code&gt;å’Œ&lt;code&gt;lockBeforeDate:&lt;/code&gt;æ–¹æ³•ã€‚åœ¨åŠ é”å‰å°è¯•åŠ é”ï¼Œå¦‚æœè¿”å›æ— æ³•è·å¾—é”ï¼Œå¹¶ä¸ä¼šé˜»å¡çº¿ç¨‹ä¼šç»§ç»­å¾€ä¸‹èµ°ï¼Œè¿”å›&lt;code&gt;NO&lt;/code&gt;,&lt;code&gt;lockBeforeDate:&lt;/code&gt;è®©ä½ æ§åˆ¶åŠ é”çš„æ—¶é—´ï¼Œåœ¨è§„å®šæ—¶é—´æœªè·å¾—é”è¿”å›&lt;code&gt;NO&lt;/code&gt;
&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;/b&gt;
&lt;span class=&#34;highlight-text success&#34;&gt;
Example
&lt;/span&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;//åˆ›å»ºé”
NSLock *lock = [[NSLock alloc] init];
//çº¿ç¨‹1
dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{ 
    //[lock lock]; 
    //ç«‹å³åŠ é”
    [lock lockBeforeDate:[NSDate date]];
    NSLog(@&amp;quot;éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 å¼€å§‹&amp;quot;); 
    sleep(2); 
    NSLog(@&amp;quot;éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ1 ç»“æŸ&amp;quot;); 
    [lock unlock];
});
//çº¿ç¨‹2
dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
    sleep(1);
    //å°è¯•åŠ é”
    if ([lock tryLock]) {
        //å°è¯•è·å–é”ï¼Œå¦‚æœè·å–ä¸åˆ°è¿”å›NOï¼Œä¸ä¼šé˜»å¡è¯¥çº¿ç¨‹ 
        NSLog(@&amp;quot;é”å¯ç”¨çš„æ“ä½œ&amp;quot;); 
        [lock unlock]; 
    }else{
        NSLog(@&amp;quot;é”ä¸å¯ç”¨çš„æ“ä½œ&amp;quot;); 
    } 
    
    NSDate *date = [[NSDate alloc] initWithTimeIntervalSinceNow:3]; 
    if ([lock lockBeforeDate:date]) {
          //å°è¯•åœ¨æœªæ¥çš„3så†…è·å–é”ï¼Œå¹¶é˜»å¡è¯¥çº¿ç¨‹ï¼Œå¦‚æœ3så†…è·å–ä¸åˆ°æ¢å¤çº¿ç¨‹, è¿”å›NO,ä¸ä¼šé˜»å¡è¯¥çº¿ç¨‹
          NSLog(@&amp;quot;æ²¡æœ‰è¶…æ—¶ï¼Œè·å¾—é”&amp;quot;); 
          [lock unlock]; 
     }else{ 
          NSLog(@&amp;quot;è¶…æ—¶ï¼Œæ²¡æœ‰è·å¾—é”&amp;quot;); 
     } 
});

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;Result&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ThreadTest[13541:394814] éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ 1 å¼€å§‹
ThreadTest[13541:394804] é”ä¸å¯ç”¨çš„æ“ä½œ
ThreadTest[13541:394814] éœ€è¦çº¿ç¨‹åŒæ­¥çš„æ“ä½œ 1 ç»“æŸ
ThreadTest[13541:394804] æ²¡æœ‰è¶…æ—¶ï¼Œè·å¾—é”
&lt;/code&gt;&lt;/pre&gt;

&lt;h6 id=&#34;nsrecursivelock&#34;&gt;NSRecursiveLock&lt;/h6&gt;

&lt;p&gt;&lt;span class=&#34;highlight-text blue&#34;&gt;äº’æ–¥é”&lt;/span&gt; &lt;span class=&#34;highlight-text blue&#34;&gt;é€’å½’é”&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;å®ç°å’Œ&lt;code&gt;NSLock&lt;/code&gt;å·®ä¸å¤šï¼Œåªä¸è¿‡åœ¨åº•å±‚NSLockä½¿ç”¨çš„Cçš„&lt;code&gt;pthread_mutex_lock&lt;/code&gt;,è€Œ&lt;code&gt;NSRecursiveLock&lt;/code&gt;ä½¿ç”¨çš„æ˜¯&lt;code&gt;pthread_mutex_recursive&lt;/code&gt;ã€‚
å®ƒä¹ŸåŒæ ·æä¾›äº†&lt;code&gt;- (BOOL)tryLock&lt;/code&gt;å’Œ&lt;code&gt;- (BOOL)lockBeforeDate:(NSDate *)limit&lt;/code&gt;æ–¹æ³•&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;/b&gt;
&lt;span class=&#34;highlight-text success&#34;&gt;
Example
&lt;/span&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;//NSLock *lock = [[NSLock alloc] init];
NSRecursiveLock *lock = [[NSRecursiveLock alloc] init];
dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{ 
    static void (^RecursiveMethod)(int); 
    RecursiveMethod = ^(int value) { 
        [lock lock]; 
        if (value &amp;gt; 0) { 
            NSLog(@&amp;quot;value = %d&amp;quot;, value); 
            sleep(1); 
            RecursiveMethod(value - 1); 
      } 
        [lock unlock]; 
    };
     RecursiveMethod(5); 
});

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚æœä½¿ç”¨&lt;code&gt;NSLock&lt;/code&gt;å°±ä¼šç›´æ¥æ­»é”ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Result&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ThreadTest[13593:400360] value = 5
ThreadTest[13593:400360] value = 4
ThreadTest[13593:400360] value = 4
ThreadTest[13593:400360] value = 2
ThreadTest[13593:400360] value = 1
&lt;/code&gt;&lt;/pre&gt;

&lt;h6 id=&#34;nscondition&#34;&gt;NSCondition&lt;/h6&gt;

&lt;p&gt;&lt;span class=&#34;highlight-text blue&#34;&gt;äº’æ–¥é”&lt;/span&gt; &lt;span class=&#34;highlight-text blue&#34;&gt;æ¡ä»¶å˜é‡&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;æ¡ä»¶å˜é‡å’Œä¿¡å·é‡å¾ˆç±»ä¼¼ï¼Œæä¾›äº†é˜»å¡ã€ç­‰å¾…å°±ç»ªã€å”¤é†’çº¿ç¨‹çš„æ–¹æ³•ã€‚æ¯”å¦‚ï¼Œç”Ÿäº§-æ¶ˆè´¹è€…æ¨¡å¼ã€‚
åœ¨å•çº¿ç¨‹æ‰§è¡Œä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé€šè¿‡ä¸€ä¸ªå¸ƒå°”å€¼æ¥æ§åˆ¶æŸä¸ªæ–¹æ³•æˆ–è€…å€¼æ˜¯å¦éœ€è¦è¢«æ‰§è¡Œå’Œä¿®æ”¹ã€‚åœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹ï¼Œéœ€è¦äº’æ–¥é”æ¥é…åˆä¿è¯çº¿ç¨‹å®‰å…¨ã€‚&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;/b&gt;
&lt;span class=&#34;highlight-text success&#34;&gt;
Example
&lt;/span&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;NSConditionLock *lock = [[NSConditionLock alloc] init];
NSMutableArray *products = [NSMutableArray array]; 
NSInteger HAS_DATA = 1; 
NSInteger NO_DATA = 0;

dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{ 
    while (1) { 
        [lock lockWhenCondition:NO_DATA]; 
        [products addObject:[[NSObject alloc] init]]; 
        NSLog(@&amp;quot;produce a product,æ€»é‡:%zi&amp;quot;,products.count); 
        [lock unlockWithCondition:HAS_DATA]; 
        sleep(1); 
   } 
}); 

dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{ 
    while (1) { 
         NSLog(@&amp;quot;wait for product&amp;quot;); 
         [lock lockWhenCondition:HAS_DATA]; 
         [products removeObjectAtIndex:0]; 
         NSLog(@&amp;quot;custome a product&amp;quot;); 
         [lock unlockWithCondition:NO_DATA]; 
    } 
});

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;Result&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ThreadTest[13645:406942] wait for product
ThreadTest[13645:406951] produce a product, æ€»é‡ :1
ThreadTest[13645:406942] custome a product
ThreadTest[13645:406942] wait for product
ThreadTest[13645:406951] produce a product, æ€»é‡:1
ThreadTest[13645:406942] custome a product
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åªæœ‰å½“&lt;code&gt;unlock&lt;/code&gt;å’Œ&lt;code&gt;lock&lt;/code&gt;çš„å€¼ä¸€ä¸€å¯¹åº”æ‰èƒ½å”¤é†’çº¿ç¨‹ï¼Œæ‰§è¡Œåç»­æ“ä½œã€‚&lt;/p&gt;

&lt;h4 id=&#34;å‚è€ƒèµ„æ–™&#34;&gt;å‚è€ƒèµ„æ–™&lt;/h4&gt;

&lt;p&gt;&lt;a href=&#34;https://blog.ibireme.com/2016/01/16/spinlock_is_unsafe_in_ios/&#34;&gt;ä¸å†å®‰å…¨çš„ OSSpinLock&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://casatwy.com/pthreadde-ge-chong-tong-bu-ji-zhi.html&#34;&gt;pthreadçš„å„ç§åŒæ­¥æœºåˆ¶&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://bestswifter.com/ios-lock/&#34;&gt;æ·±å…¥ç†è§£ iOS å¼€å‘ä¸­çš„é”&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://www.jianshu.com/p/4edf98a61483&#34;&gt;IOS ä¿è¯çº¿ç¨‹åŒæ­¥æ–¹å¼&amp;amp;æ€§èƒ½å¯¹æ¯”&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/lattera/glibc/blob/master/nptl/pthread_mutex_lock.c&#34;&gt;pthreadmutexlock.c æºç &lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://yulingtianxia.com/blog/2015/11/01/More-than-you-want-to-know-about-synchronized/&#34;&gt;å…³äº @synchronizedï¼Œè¿™å„¿æ¯”ä½ æƒ³çŸ¥é“çš„è¿˜è¦å¤š&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://pubs.opengroup.org/onlinepubs/7908799/xsh/pthread_mutex_lock.html&#34;&gt;pthreadmutexlock&lt;/a&gt;
&lt;a href=&#34;https://developer.apple.
com/library/content/documentation/Cocoa/Conceptual/Multithreading/ThreadSafety/ThreadSafety.html&#34;&gt;ThreadSafety&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://stackoverflow.com/questions/62814/difference-between-binary-semaphore-and-mutex&#34;&gt;Difference between binary semaphore and mutex&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://blog.csdn.net/Javadino/article/details/2891388&#34;&gt;[Pthread] Linuxä¸­çš„çº¿ç¨‹åŒæ­¥æœºåˆ¶(äºŒ)&amp;ndash;In Glibc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://android.googlesource.com/platform/external/pthreads/+/master/pthread_cond_wait.
c&#34;&gt;pthreadcondwait&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://stackoverflow.com/questions/3513045/conditional-variable-vs-semaphore&#34;&gt;Conditional Variable vs Semaphore&lt;/a&gt;&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>å¿«é€Ÿæ’åº</title>
      <link>https://linkrober.github.io/bookshelf/2017/12/%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/</link>
      <pubDate>Fri, 01 Dec 2017 00:00:00 +0000</pubDate>
      
      <guid>https://linkrober.github.io/bookshelf/2017/12/%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/</guid>
      <description>&lt;span class=&#34;highlight-text primary&#34;&gt;
æ•…äº‹
&lt;/span&gt;

&lt;p&gt;å¿«é€Ÿæ’åºç”±&lt;strong&gt;C.A.R.Hoareï¼ˆä¸œå°¼éœå°”ï¼‰&lt;/strong&gt;åœ¨1960å¹´æå‡ºã€‚ä¹‹ååˆæœ‰è®¸å¤šäººå¯¹æ­¤è¿›è¡Œæ”¹è¿›ã€‚å¦‚æœä½ å¯¹å¿«é€Ÿæ’åºæ„Ÿå…´è¶£å¯ä»¥å»çœ‹çœ‹ä¸œå°¼éœå°”1962å¹´åœ¨Computer Journalå‘è¡¨çš„è®ºæ–‡â€œQuicksortâ€ä»¥åŠã€Šç®—æ³•å¯¼è®ºã€‹çš„ç¬¬ä¸ƒç« ã€‚&lt;/p&gt;

&lt;p&gt;&lt;/b&gt;
&lt;span class=&#34;highlight-text primary&#34;&gt;
åŸºæœ¬æ€æƒ³
&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;é€šè¿‡ä¸€æ¬¡æ’åºå°†éœ€è¦æ’åºçš„æ•°ç»„åˆ†å‰²æˆä¸¤éƒ¨åˆ†,ä¸€éƒ¨åˆ†çš„å€¼æ¯”å¦ä¸€éƒ¨åˆ†è¦å°ã€‚å†å°†è¿™ä¸¤ä¸ªéƒ¨åˆ†é€šè¿‡ä¸Šé¢çš„æ–¹å¼æ’åºï¼Œä»¥æ­¤ç±»æ¨ã€‚æœ€ååˆ†å‰²æˆäº†å¾ˆå°çš„ä¸€éƒ¨åˆ†ï¼Œç›´åˆ°æ¯ä¸ªæ•°å­—ã€‚æ•´ä¸ªæ’åºçš„è¿‡ç¨‹æˆ‘ä»¬å¯ä»¥é€šè¿‡é€’å½’çš„æ–¹å¼è¿›è¡Œã€‚&lt;/p&gt;

&lt;p&gt;&lt;/b&gt;
&lt;span class=&#34;highlight-text primary&#34;&gt;
æ—¶é—´å¤æ‚åº¦
&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;å¿«é€Ÿæ’åºä¹‹æ‰€æ¯”è¾ƒå¿«ï¼Œå› ä¸ºç›¸æ¯”å†’æ³¡æ’åºï¼Œæ¯æ¬¡äº¤æ¢æ˜¯è·³è·ƒå¼çš„ã€‚æ¯æ¬¡æ’åºçš„æ—¶å€™è®¾ç½®ä¸€ä¸ªåŸºå‡†ç‚¹ï¼Œå°†å°äºç­‰äºåŸºå‡†ç‚¹çš„æ•°å…¨éƒ¨æ”¾åˆ°åŸºå‡†ç‚¹çš„å·¦è¾¹ï¼Œå°†å¤§äºç­‰äºåŸºå‡†ç‚¹çš„æ•°å…¨éƒ¨æ”¾åˆ°åŸºå‡†ç‚¹çš„å³è¾¹ã€‚è¿™æ ·åœ¨æ¯æ¬¡äº¤æ¢çš„æ—¶å€™å°±ä¸ä¼šåƒå†’æ³¡æ’åºä¸€æ ·æ¯æ¬¡åªèƒ½åœ¨ç›¸é‚»çš„æ•°ä¹‹é—´è¿›è¡Œäº¤æ¢ï¼Œäº¤æ¢çš„è·ç¦»å°±å¤§çš„å¤šäº†ã€‚å› æ­¤æ€»çš„æ¯”è¾ƒå’Œäº¤æ¢æ¬¡æ•°å°±å°‘äº†ï¼Œé€Ÿåº¦è‡ªç„¶å°±æé«˜äº†ã€‚å½“ç„¶åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œä»å¯èƒ½æ˜¯ç›¸é‚»çš„ä¸¤ä¸ªæ•°è¿›è¡Œäº†äº¤æ¢ã€‚å› æ­¤å¿«é€Ÿæ’åºçš„æœ€å·®æ—¶é—´å¤æ‚åº¦å’Œå†’æ³¡æ’åºæ˜¯ä¸€æ ·çš„éƒ½æ˜¯O(N2)ï¼Œå®ƒçš„å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸ºO(NlogN)ã€‚&lt;/p&gt;

&lt;p&gt;&lt;/b&gt;
&lt;span class=&#34;highlight-text primary&#34;&gt;
Exampleï¼šæ¼”ç¤ºç¬¬ä¸€è½®æ’åº
&lt;/span&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;5 7 6 4 3 1 9 8 0 2
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¯¹ä¸Šé¢çš„æ•°è¿›è¡Œæ’åº,å…ˆå®šä¹‰ä¸€ä¸ªåŸºå‡†æ•°ï¼š&lt;strong&gt;5&lt;/strong&gt;ã€‚æ¯”è¾ƒä»ä¸¤è¾¹è¿›è¡Œï¼Œä¸€è¾¹æ˜¯ä»ç´¢å¼•ä¸º0çš„å¼€å§‹ï¼Œå¦‚æœé‡åˆ°æ¯”5å¤§çš„å°±åœä¸‹ï¼›å¦ä¸€è¾¹æ˜¯ä»ç´¢å¼•ä¸º9çš„å¼€å§‹ï¼Œå¦‚æœé‡åˆ°æ¯”5å°çš„å°±åœä¸‹ã€‚ç„¶åäº¤æ¢ä¸¤éçš„æ•°ã€‚åœ¨ç¬¬ä¸€è½®ä¸­ï¼Œä»å·¦è¾¹å¼€å§‹æ¯”è¾ƒçš„åœ¨é‡åˆ°7ä¹‹åå°±ä¼šåœä¸‹æ¥ï¼Œå› ä¸º7æ¯”5å¤§ï¼›ä»å³è¾¹å¼€å§‹çš„é‡åˆ°2å°±ä¼šåœä¸‹æ¥ï¼Œå› ä¸º2æ¯”5å°ã€‚ç„¶åäº¤æ¢ä¸¤ä¸ªäººçš„ä½ç½®ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;5 2 6 4 3 1 9 8 0 7
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç»§ç»­èµ°ï¼Œ6æ¯”5å¤§ï¼Œ0æ¯”5å°ï¼Œäº¤æ¢&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;5 2 0 4 3 1 9 8 6 7
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç»§ç»­èµ°ï¼Œå·¦è¾¹çš„é‡åˆ°äº†9ï¼Œæ¯”5å¤§ï¼Œåœä¸‹æ¥ï¼›å³è¾¹çš„ç»è¿‡8ï¼Œå¿«è¦å’Œå·¦è¾¹çš„ç›¸é‡äº†åœä¸‹æ¥ã€‚è¿™æ—¶å€™å½“æŠŠ9å’Œ5äº¤æ¢çš„æ—¶å€™å‘ç°æ’åºå5å·¦è¾¹å¹¶æ²¡æœ‰éƒ½æ¯”å³è¾¹å°&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;9 2 0 4 3 1 5 8 6 7
&lt;/code&gt;&lt;/pre&gt;

&lt;div class=&#34;alert danger &#34;&gt;
  &lt;p&gt;æ³¨æ„è¿™é‡Œæˆ‘ä»¬åˆšå¼€å§‹çš„æ—¶å€™å°±å…ˆåé¡ºåºèµ°é”™äº†ï¼Œåº”è¯¥å³è¾¹çš„å…ˆæ¯”è¾ƒã€‚&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;çº æ­£ä¸€ä¸‹ï¼Œé‡æ–°å¼€å§‹ï¼Œæœ€åä¸€æ­¥æ¯”è¾ƒçš„æ—¶å€™ï¼šè¿™æ—¶å€™å³è¾¹çš„å…ˆåˆ°1ï¼Œå‘ç°1æ¯”5å°åœä¸‹ã€‚ç­‰å·¦è¾¹çš„å’Œå³è¾¹çš„ç›¸é‡æ—¶ã€‚å°†å³è¾¹çš„1å’ŒåŸºå‡†æ•°5äº¤æ¢ï¼Œå¦‚ä¸‹&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;1 2 0 4 3 5 9 8 6 7
&lt;/code&gt;&lt;/pre&gt;

&lt;span class=&#34;highlight-text primary&#34;&gt;
Code
&lt;/span&gt;

&lt;pre&gt;&lt;code&gt;int a[10] = {6,1,2,7,9,3,4,5,10,8};

void quickSort(int left,int right){
    int i,j,t,temp;
    if(left &amp;gt; right){
        return;
    }
    
    temp = a[left];
    i = left;
    j = right;
    
    while (i!=j) {
        while (a[j] &amp;gt; temp &amp;amp;&amp;amp; i &amp;lt; j) {
            j--;
        }
        while (a[i] &amp;lt;= temp &amp;amp;&amp;amp; i &amp;lt; j) {
            i++;
        }
        
        if(i &amp;lt; j){
            t = a[i];
            a[i] = a[j];
            a[j] = t;
        }
    }
    a[left] = a[i];
    a[i] = temp;
    
    quickSort(left, i - 1);
    quickSort(i + 1, right);
}

int main(int argc, const char * argv[]) {
    // insert code here...
    quickSort(0, 9);
    for(int i = 0 ; i &amp;lt; 10;i++){
        printf(&amp;quot;%d &amp;quot;,a[i]);
    }
    return 0;
}
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>ä¸€ä¸ªéŸ³è§†é¢‘å‚çš„å›¾åƒå¤„ç†æµç¨‹æ¦‚è¿°</title>
      <link>https://linkrober.github.io/bookshelf/2017/11/%E4%B8%80%E4%B8%AA%E9%9F%B3%E8%A7%86%E9%A2%91%E5%8E%82%E7%9A%84%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B%E6%A6%82%E8%BF%B0/</link>
      <pubDate>Mon, 27 Nov 2017 00:00:00 +0000</pubDate>
      
      <guid>https://linkrober.github.io/bookshelf/2017/11/%E4%B8%80%E4%B8%AA%E9%9F%B3%E8%A7%86%E9%A2%91%E5%8E%82%E7%9A%84%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B%E6%A6%82%E8%BF%B0/</guid>
      <description>&lt;p&gt;&lt;img src=&#34;http://upload-images.jianshu.io/upload_images/1086250-3eac00965effbe70?imageMogr2/auto-orient/strip%7CimageView2/2/w/320&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;è§†é¢‘ç¼–è¾‘åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š&lt;strong&gt;Camrea Engineï¼ˆè§†é¢‘èµ„æºé‡‡é›†ï¼‰&lt;/strong&gt;å’Œ&lt;strong&gt;Video Edit Engineï¼ˆåæœŸè§†é¢‘ç¼–è¾‘ï¼‰&lt;/strong&gt;ã€‚åœ¨Camrea Engineé‡‡é›†çš„æ—¶å€™æˆ‘ä»¬ä¹Ÿå¯ä»¥åšä¸€äº›ç¼–è¾‘æ“ä½œï¼Œè¿™å«é¢„å¤„ç†ï¼Œæ¯”å¦‚è¯´åŠ æ»¤é•œã€‚ç­‰åˆ°æŠŠé‡‡é›†åˆ°çš„èµ„æºäº¤ç»™Video Edit Engineæ—¶å°±æ˜¯åå¤„ç†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;/p&gt;

&lt;p&gt;Camera Engineæ˜¯é€šè¿‡æŠŠè¢«æ‘„å¯¹è±¡çš„å…‰ä¿¡å·è½¬å˜æˆç›¸åº”çš„ç”µä¿¡å·ï¼Œè¿™æ—¶å€™è¿˜æ˜¯æ¨¡æ‹Ÿä¿¡å·ï¼Œç»è¿‡é‡‡æ ·ã€é‡åŒ–ã€ç¼–ç ï¼Œå½¢æˆæ•°å­—ä¿¡å·ï¼Œè®¡ç®—æœºå°±å¯ä»¥ç”¨0å’Œ1æ¥è®°å½•å®ƒï¼Œæœ€ç»ˆä¿å­˜åˆ°ç£ç›˜ä¸Šã€‚&lt;/p&gt;

&lt;p&gt;&lt;span class=&#34;highlight-text blue&#34;&gt;è¿™é‡Œå…ˆé˜è¿°ä¸€ä¸‹åŸºæœ¬çŸ¥è¯†ï¼š&lt;/span&gt;&lt;/br&gt;
æ»¤é•œæ˜¯æ€ä¹ˆåŠ ä¸Šå»çš„å‘¢ï¼Ÿè¿™è¦ä»å›¾ç‰‡è¯´èµ·ã€‚å…¶å®è§†é¢‘å°±æ˜¯å¾ˆå¤šå¼ å›¾ç‰‡è¿ç»­æ’­æ”¾å½¢æˆçš„ã€‚äººçœ¼ä¸ºä»€ä¹ˆå¯ä»¥çœ‹åˆ°ä¸œè¥¿ï¼Œç‰©ä½“é€šè¿‡æ¼«åå°„æŠŠå…‰å­æ‰“åˆ°è§†ç½‘è†œä¸Šï¼Œè€Œè¿™ä¸ªå½±åƒåœ¨è§†ç½‘è†œä¸Šæ¶ˆå¤±éœ€è¦ä¸€æ®µæ—¶é—´ï¼Œè¿™å°±æ˜¯æ®‹å½±ã€‚ç»è¿‡è¯•éªŒåªè¦ä¸¤å¼ å›¾ç‰‡çš„åˆ‡æ¢åœ¨1/24ç§’äººçœ¼æ˜¯åˆ†è¾¨ä¸å‡ºæ¥çš„ï¼Œé‚£ä¹ˆå¯¹äººæ¥è¯´å®ƒå°±æ˜¯è¿ç»­çš„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://upload-images.jianshu.io/upload_images/1086250-f7df91c7c0967686?imageMogr2/auto-orient/strip%7CimageView2/2/w/700&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨èƒ¶å·æ—¶ä»£æ˜¯æ¯ç§’è¦æ±‚24å¼ ï¼Œæ•°å­—æ—¶æœŸæ˜¯è¾¾åˆ°äº†æ¯ç§’30å¼ ï¼Œå°±ç®—ä¸­é—´ä¸¢äº†6å¼ å›¾ç‰‡æˆ‘ä»¬ä¹Ÿæ˜¯ä¸çŸ¥é“çš„ï¼Œå¢åŠ äº†è§†é¢‘å¤„ç†çš„å®¹é”™ç‡ï¼Œä¸‹é¢æˆ‘ä»¬ä¸“ä¸šä¸€ç‚¹ï¼Œç”¨å¸§æ¥ä»£è¡¨ä¸€å¼ å›¾ã€‚é‚£ä¹ˆä¸€å¸§æ˜¯æ€ä¹ˆæ„æˆçš„å‘¢ï¼Œæ¯å¸§ä¸Šçš„è‰²å½©éƒ½æ˜¯é€šè¿‡RGBä¸‰åŸè‰²å„ç§ä¸åŒçš„ç»„åˆå‘ˆç°ç»™æˆ‘ä»¬çš„ã€‚åœ¨æˆ‘ä»¬çš„æ—¥å¸¸ç”Ÿæ´»ä¸­ç»å¸¸ä¼šå¬åˆ†è¾¨ç‡1080920ç±»ä¼¼çš„è¯ï¼Œå®ƒè¯´çš„å°±æ˜¯åœ¨è¿™ä¸ªå±å¹•ä¸Šæœ‰æ¨ªå‘æœ‰920ä¸ªåƒç´ ï¼Œçºµå‘æœ‰1080ä¸ªåƒç´ ï¼Œæ¯ä¸ªåƒç´ å°±æ˜¯ä¸€ä¸ªè‰²ç‚¹ã€‚æŠŠå›¾ç‰‡æ”¾å¤§ï¼Œä½ å°±å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°å›¾ç‰‡æ˜¯ç”±ä¸€ä¸ªä¸ªå°æ–¹å—æ„æˆçš„ï¼Œæ¯ä¸ªæ–¹å—éƒ½æœ‰è‡ªå·±çš„é¢œè‰²ã€‚è¿™é‡Œçš„é¢œè‰²å°±æ˜¯é€šè¿‡RGBä¸‰åŸè‰²å åŠ è€Œæˆçš„ï¼Œè€ŒRGBæ¯ä¸ªéƒ½æœ‰256ç§äº®åº¦ï¼Œä»0åˆ°255ã€‚é‚£ä¹ˆæ€»å…±å°±èƒ½ç»„åˆå‡º256256*256=16777216ç§é¢œè‰²ï¼Œå¾ˆå¤šå§ã€‚&lt;/p&gt;

&lt;p&gt;&lt;span class=&#34;highlight-text blue&#34;&gt;åˆ°è¿™é‡ŒåŸºæœ¬çŸ¥è¯†æˆ‘ä»¬é“ºå«çš„å·®ä¸å¤šäº†&lt;/span&gt;&lt;/br&gt;
å†å›åˆ°åŠ æ»¤é•œçš„è¯é¢˜ï¼Œåœ¨ä¸šåŠ¡å±‚å¼€å‘ä¸­æˆ‘ä»¬åŠ æ»¤é•œå…¶å®æ˜¯åŠ å…¥äº†ä¸€ç§å¯ä»¥è®©Camera Engineè¯†åˆ«çš„æè¿°ï¼Œå®ƒæè¿°äº†æ¯ä¸€å¸§ä¸Šçš„æ¯ä¸€ä¸ªåƒç´ å¦‚ä½•è¢«â€œä¿®æ”¹â€ï¼Œè¿™é‡Œçš„â€œä¿®æ”¹â€å¯ä»¥æ˜¯ç›´æ¥ä¿®æ”¹åƒç‚¹çš„RBGå€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯åœ¨è¿™ä¸€å¸§ä¸Šå åŠ ä¸€å±‚(å½“ç„¶ä¹Ÿå¯ä»¥å åŠ å¤šå±‚)ã€‚è‚‰çœ¼å°±ä¼šçœ‹åˆ°å’ŒåŸæ¥è§†é¢‘ä¸åŒçš„æ»¤é•œæ•ˆæœã€‚æœ‰çš„æ»¤é•œäº®ï¼Œæœ‰çš„æ»¤é•œæš—ç­‰ç­‰ï¼Œå…¶å®æœ€ç»ˆå°±æ˜¯é€šè¿‡è°ƒæ•´GRBçš„äº®åº¦æ¥å®ç°çš„ã€‚åˆ°è¿™é‡Œå°±æ˜¯æ˜¯è§†é¢‘çš„é¢„å¤„ç†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://upload-images.jianshu.io/upload_images/1086250-b0f7dc9db4e364fc?imageMogr2/auto-orient/strip%7CimageView2/2/w/320&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Video Edit Engine&lt;/strong&gt;è®¾è®¡åˆ°ä¸€ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼šstoryboardã€clipã€streamã€producerã€effectå’Œplayerã€‚&lt;/p&gt;

&lt;p&gt;storyboardç›¸å½“äºä¸€ä¸ªç”»å¸ƒï¼Œè¿™æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µï¼Œä¾¿äºæˆ‘ä»¬ç†è§£è§†é¢‘ç¼–è¾‘ï¼Œæ‰€æœ‰çš„ç¼–è¾‘æ“ä½œæˆ‘ä»¬éƒ½åœ¨è¿™ä¸Šé¢è¿›è¡Œã€‚ä¸Šé¢æ”¾çš„å°±æ˜¯è§†é¢‘ã€å›¾ç‰‡ï¼Œè¿™é‡Œå¹¶ä¸æ˜¯æŒ‡è§†é¢‘ã€å›¾ç‰‡çš„åŸæ–‡ä»¶ï¼Œè€Œæ˜¯å¯¹åŸæ–‡ä»¶çš„æè¿°ã€‚æ¯”å¦‚è§†é¢‘çš„èµ·å§‹æ—¶é—´å’Œç»ˆæ­¢æ—¶é—´ã€è§†é¢‘çš„è·¯å¾„ï¼Œæ–¹å‘ç­‰ç­‰ã€‚è¿™ç§æè¿°æ˜¯é€šè¿‡ä¸€ç§é¢å‘å¯¹è±¡çš„ç±»clipä½“ç°çš„ã€‚ä¸€ä¸ªstoryboardä¸Šå¯ä»¥æœ‰å¾ˆå¤šæ®µæè¿°æ–‡ä»¶clipï¼Œå®ƒä»¬æ˜¯æœ‰åºçš„ï¼Œå¯ä¿®æ”¹çš„ã€‚è¿™æ—¶å€™æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ºclipæ·»åŠ effectã€‚effectå¯ä»¥ç†è§£ä¸ºä¿®æ”¹è§†é¢‘çš„æè¿°æ–‡ä»¶çš„æŠ½è±¡ç±»ï¼ˆæˆ‘ä»¬ä½¿ç”¨çš„ç´ ætemplateå°±æ˜¯effectæ›´ä¸Šå±‚çš„æŠ½è±¡ï¼‰ã€‚åœ¨storyboardå¯¼å‡ºæˆè§†é¢‘æˆ–å›¾ç‰‡çš„æ—¶å€™ï¼Œå®ƒå‘Šè¯‰Engineæ€ä¹ˆä¿®æ”¹è§†é¢‘çš„ï¼Œæœ€ç»ˆä¹Ÿæ˜¯é€šè¿‡ä¿®æ”¹æ¯ä¸€å¸§ä¸Šçš„åƒç´ ç‚¹æ¥å®ç°çš„ã€‚
&lt;img src=&#34;http://upload-images.jianshu.io/upload_images/1086250-765d8bfa6eb45e74?imageMogr2/auto-orient/strip%7CimageView2/2/w/700&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨å¯¼å‡ºçš„æ—¶å€™éœ€è¦ç»è¿‡è¿›ä¸€æ­¥å°è£…ï¼ŒæŠŠstoryboardå°è£…æˆstreamï¼Œå®ƒä¼šå°†æ–‡ä»¶è¿›è¡Œè§£ç ï¼Œæ ¹æ®effectå¯¹clipçš„æè¿°ï¼Œé€šè¿‡producerç”Ÿæˆä¸€ä¸ªç”¨æˆ·æƒ³è¦çš„è§†é¢‘ã€‚åªæœ‰é€šè¿‡streamæ‰èƒ½å‹ç¼©ç¼–ç æˆæœ¬åœ°çš„æ–‡ä»¶æˆ–è€…è§£ç æˆæ¯”ç‰¹æµè®©æ’­æ”¾å™¨playeræ¥ä½¿ç”¨ã€‚æ‰€ä»¥streamèµ·åˆ°äº†ä¸€ä¸ªå¯¹VFï¼ˆè§†é¢‘ï¼‰å’ŒAFï¼ˆéŸ³é¢‘ï¼‰ç¼–è§£ç çš„ä½œç”¨ã€‚è¿™é‡Œå°±æ˜¯è§†é¢‘çš„åå¤„ç†ã€‚&lt;/p&gt;

&lt;p&gt;åˆ°è¿™é‡Œå°±æ˜¯ä¸€äº›è§†é¢‘ç›¸å…³çš„å‚è§†é¢‘å›¾ç‰‡ç¼–è¾‘çš„å¤§æ¦‚æ€è·¯ã€‚&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>RCTRootViewã€RCTBridgeåšäº†ä»€ä¹ˆ</title>
      <link>https://linkrober.github.io/bookshelf/2017/10/rctrootviewrctbridge%E5%81%9A%E4%BA%86%E4%BB%80%E4%B9%88/</link>
      <pubDate>Sat, 28 Oct 2017 00:00:00 +0000</pubDate>
      
      <guid>https://linkrober.github.io/bookshelf/2017/10/rctrootviewrctbridge%E5%81%9A%E4%BA%86%E4%BB%80%E4%B9%88/</guid>
      <description>&lt;p&gt;æœ¬ç³»åˆ—æ–‡ç« ä½œä¸ºå­¦ä¹ RNæœŸé—´çš„æ€»ç»“&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://linkrober.github.io/bookshelf/2017/10/react-native%E5%A6%82%E4%BD%95%E9%9B%86%E6%88%90%E5%88%B0%E7%8E%B0%E6%9C%89%E9%A1%B9%E7%9B%AE%E4%B8%AD/&#34;&gt;React Nativeå¦‚ä½•é›†æˆåˆ°ç°æœ‰é¡¹ç›®ä¸­&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://linkrober.github.io/bookshelf/2017/10/react-native%E5%92%8Cnative%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1/&#34;&gt;React Nativeå’ŒNativeé—´çš„é€šä¿¡å®è·µ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;RCTRootViewã€RCTBridgeåšäº†ä»€ä¹ˆ&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://linkrober.github.io/bookshelf/2017/12/native%E5%92%8Cjs%E9%80%9A%E4%BF%A1%E6%A6%82%E8%BF%B0/&#34;&gt;Object-Cå’ŒJSé€šä¿¡æ¦‚è¿°&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;/p&gt;

&lt;p&gt;æœ¬ç« ä¸»è¦è®¨è®ºï¼ŒRCTRootViewã€RCTBridgeå½¼æ­¤ä¹‹é—´çš„å…³ç³»ï¼Œä»¥åŠå®ƒä»¬åšäº†ä»€ä¹ˆã€‚å…ˆæ”¾ä¸Šç±»å›¾&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;../../../ç›¸å…³ç±»å›¾.png&#34; alt=&#34;ç›¸å…³ç±»å›¾&#34; /&gt;&lt;/p&gt;

&lt;h4 id=&#34;rctrootview&#34;&gt;RCTRootView&lt;/h4&gt;

&lt;p&gt;å®ƒæ˜¯RNåœ¨Nativeä¸Šå±•ç¤ºçš„å®¹å™¨ï¼Œ&lt;code&gt;RCTJavaScriptWillStartLoadingNotification&lt;/code&gt;ã€&lt;code&gt;RCTJavaScriptDidLoadNotification&lt;/code&gt;ã€&lt;code&gt;RCTContentDidAppearNotification&lt;/code&gt;è¿™äº›é€šçŸ¥æ³¨å†Œéƒ½åœ¨é‡Œé¢ã€‚åŒæ—¶ä¹Ÿæ˜¯è¿è¡Œjsçš„å…¥å£ã€‚&lt;/p&gt;

&lt;p&gt;&lt;span class=&#34;highlight-text blue&#34;&gt;RCTJavaScriptWillStartLoadingNotification&lt;/span&gt;&lt;/br&gt;
å½“ä½ åœ¨Debugæ¨¡å¼ä¸‹ï¼Œé€‰æ‹©&lt;strong&gt;Live Reload&lt;/strong&gt;æ¯æ¬¡ä¿å­˜jsæ–‡ä»¶çš„æ—¶å€™å°±ä¼šé‡æ–°åŠ è½½jsã€‚ä¹‹å‰çš„&lt;code&gt;reactTag&lt;/code&gt;ä¼šæ¸…ç©ºï¼Œç­‰å¾…é‡æ–°èµ‹å€¼ï¼Œä½†ç¬¬ä¸€æ¬¡åˆå§‹åŒ–å¹¶ä¸ä¼šè§¦å‘è¿™ä¸ªé€šçŸ¥ã€‚å› ä¸ºé€šçŸ¥è¿™æ—¶å€™è¿˜æ²¡æ³¨å†Œã€‚&lt;/p&gt;

&lt;p&gt;&lt;span class=&#34;highlight-text blue&#34;&gt;RCTJavaScriptDidLoadNotification&lt;/span&gt;&lt;/br&gt;
åŒæ ·çš„åœ¨&lt;strong&gt;Live Reload&lt;/strong&gt;æ¨¡å¼ä¸‹ï¼Œæ¯æ¬¡ä¿å­˜ï¼Œæ‰ä¼šæ­£çœŸçš„é‡æ–°åŠ è½½jsï¼Œå®Œæ¯•ä¹‹åï¼Œå¼€å§‹è§†å›¾viewçš„é‡æ–°åˆå§‹åŒ–å³ï¼Œ&lt;code&gt;RCTRootContentView&lt;/code&gt;ï¼Œç„¶å&lt;code&gt;RCTRootView&lt;/code&gt;ä¼šé€šè¿‡bridgeå‘é€æ¶ˆæ¯&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;- (void)enqueueJSCall:(NSString *)module 
			   method:(NSString *)method 
			     args:(NSArray *)args 
		   completion:(dispatch_block_t)completion;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å®ƒæŠŠæ¨¡å—åç§°ï¼Œæ–¹æ³•åå’Œåœ¨nativeä¸­å®šä¹‰çš„å±æ€§ï¼ˆä¸Šä¸€èŠ‚æåˆ°çš„properiesï¼‰å‘é€åˆ°jsç«¯ï¼Œè®©jsç«¯å®Œæ•´çš„é€»è¾‘æ¸²æŸ“&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;å®ƒä»¬æ˜¯å¦‚ä½•æ§åˆ¶åœ¨ç¬¬ä¸€æ¬¡åˆå§‹åŒ–rootviewçš„æ—¶å€™ä¸æ‰§è¡Œ&lt;code&gt;RCTJavaScriptDidLoadNotification&lt;/code&gt;è¿™ä¸ªé€šçŸ¥å®šä¹‰çš„äº‹ä»¶çš„å‘¢ï¼Ÿæ˜¯é€šè¿‡ä¸‹é¢çš„åˆ¤æ–­&lt;/p&gt;
&lt;/blockquote&gt;

&lt;pre&gt;&lt;code&gt; RCTBridge *bridge = notification.userInfo[@&amp;quot;bridge&amp;quot;];
  if (bridge != _contentView.bridge) {
    [self bundleFinishedLoading:bridge];
  }
&lt;/code&gt;&lt;/pre&gt;

&lt;div class=&#34;alert danger &#34;&gt;
  &lt;p&gt;&lt;code&gt;RCTBatchedBridge.mm&lt;/code&gt;æ˜¯&lt;code&gt;RCTBridge.m&lt;/code&gt;çš„å­ç±»ï¼Œä½†æ˜¯åœ¨åé¢å¯èƒ½ä¼šåºŸå¼ƒã€‚&lt;code&gt;RCTBridge&lt;/code&gt;é€šè¿‡ä¸€ç§å‘ä¸‹è½¬å‹çš„æ–¹å¼ï¼Œè®©å…¶æ‹¥æœ‰äº†å­ç±»çš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;&lt;span class=&#34;highlight-text blue&#34;&gt;RCTContentDidAppearNotification&lt;/span&gt;&lt;/br&gt;
åœ¨è§†å›¾å‡ºæ¥çš„æ—¶å€™RNä¼šé€šè¿‡è¿™ä¸ªé€šçŸ¥éšè—loadingé¡µé¢ï¼Œloadingé¡µé¢ä¹Ÿæ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ï¼Œé€šè¿‡é‡æ–°å®ƒçš„&lt;code&gt;setLoadingView:&lt;/code&gt;æ–¹æ³•ã€‚&lt;/p&gt;

&lt;span class=&#34;highlight-text yellow&#34;&gt;æ€»ç»“ï¼š&lt;/span&gt;

&lt;ul&gt;
&lt;li&gt;è´Ÿè´£RNå’ŒNativeé€šä¿¡çš„&lt;code&gt;RCTBridge&lt;/code&gt;å®ä¾‹çš„åˆå§‹åŒ–ã€‚&lt;/li&gt;
&lt;li&gt;æ­£çœŸç”¨æ¥å±•ç¤ºè§†å›¾çš„&lt;code&gt;RCTRootContentView&lt;/code&gt;çš„åˆå§‹åŒ–ï¼Œå®Œäº‹åé€šè¿‡&lt;code&gt;[self insertSubview:_contentView atIndex:0];&lt;/code&gt;çš„æ–¹å¼åŠ åˆ°rootviewä¸Šã€‚&lt;/li&gt;
&lt;li&gt;è´Ÿè´£loadingè§†å›¾çš„å±•ç¤ºå’Œéšè—ã€‚&lt;/li&gt;
&lt;li&gt;è´Ÿè´£åœ¨åˆ·æ–°è§†å›¾æ—¶æ¸…ç©ºreactTagï¼Œå®ƒæ˜¯ä¹Ÿæ˜¯åŒºåˆ†jsä¸­æ¯ä¸ªviewçš„identifierã€‚&lt;/li&gt;
&lt;li&gt;è´Ÿè´£é€šçŸ¥&lt;code&gt;RCTBridge&lt;/code&gt;åœ¨åˆé€‚çš„æ—¶å€™å‘JSå‘é€å·²ç»å‡†å¤‡å¥½çš„ä¿¡æ¯ï¼Œæ¨¡å—åï¼Œæ–¹æ³•åã€å‚æ•°ä¸€èµ·ä¼ é€’è¿‡å»ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;rctbridge&#34;&gt;RCTBridge&lt;/h4&gt;

&lt;p&gt;æ‰€æœ‰çš„æ¨¡å—éƒ½ä¿å­˜åœ¨å†…å­˜çš„é™æ€å¸¸é‡åŒºåŸŸï¼Œè¿™ä¸ªå†…å­˜ç©ºé—´æ˜¯åœ¨&lt;code&gt;RCTBridge&lt;/code&gt;ä¸­è¢«åˆå§‹åŒ–çš„ã€‚å› æ­¤è¿™äº›æ¨¡å—å±äºå…¨å±€çš„å˜é‡ï¼Œå¯ä»¥åœ¨ä¸åŒçš„bridgeä¹‹é—´å…±äº«ã€‚å¯ä»¥é€šè¿‡&lt;code&gt;NSString *RCTBridgeModuleNameForClass(Class cls)&lt;/code&gt;æ‹¿åˆ°æ¯ä¸ªæ¨¡å—çš„åç§°ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;NSString *RCTBridgeModuleNameForClass(Class cls)
{
#if RCT_DEBUG
  RCTAssert([cls conformsToProtocol:@protocol(RCTBridgeModule)],
            @&amp;quot;Bridge module `%@` does not conform to RCTBridgeModule&amp;quot;, cls);
#endif

  NSString *name = [cls moduleName];
  if (name.length == 0) {
    name = NSStringFromClass(cls);
  }

  if ([name hasPrefix:@&amp;quot;RK&amp;quot;]) {
    name = [name substringFromIndex:2];
  } else if ([name hasPrefix:@&amp;quot;RCT&amp;quot;]) {
    name = [name substringFromIndex:3];
  }

  return name;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œåœ¨nativeä¸­å®šä¹‰çš„æ¨¡å—åœ¨è¢«ä¼ é€’åˆ°jsçš„æ—¶å€™ä¼šåŠ ä¸Š&lt;code&gt;RK&lt;/code&gt;æˆ–è€…&lt;code&gt;RCT&lt;/code&gt;å‰ç¼€ã€‚&lt;/p&gt;

&lt;div class=&#34;alert info no-icon &#34;&gt;
  &lt;p&gt;æ¨¡å—éƒ½æ˜¯éµå¾ª&lt;code&gt;RCTBridgeModule&lt;/code&gt;åè®®çš„ï¼Œç”¨å®&lt;code&gt;RCT_EXPORT_MODULE();&lt;/code&gt;è¿›è¡Œå£°æ˜ï¼›&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;JSé˜Ÿåˆ—çš„åˆå§‹åŒ–ä¼šåœ¨&lt;code&gt;RCTBridge&lt;/code&gt;è¢«è°ƒç”¨åˆ°çš„æ—¶å€™é€šè¿‡&lt;code&gt;+ (void)initialize&lt;/code&gt;è¿›è¡Œåˆå§‹åŒ–ï¼Œè€Œä¸”å®ƒæ˜¯ä¸€ä¸ªå•åˆ—å¯¹è±¡ã€‚é€šè¿‡Cçš„&lt;code&gt;extern __attribute__((visibility(&amp;quot;default&amp;quot;)))&lt;/code&gt;æš´éœ²å‡ºæ¥ï¼Œè®©è¯¥é˜Ÿåˆ—å˜é‡æš´éœ²åœ¨åŠ¨æ€é“¾æ¥åº“ä¹‹å¤–&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;dispatch_queue_t RCTJSThread;

+ (void)initialize
{
  static dispatch_once_t onceToken;
  dispatch_once(&amp;amp;onceToken, ^{

    // Set up JS thread
    RCTJSThread = (id)kCFNull;
  });
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ¯ä¸€ä¸ªå½“å‰è§†å›¾æ­£åœ¨ä½¿ç”¨çš„bridgeä¹Ÿä¼šæ”¾åœ¨é™æ€å¸¸é‡åŒºï¼Œæ¯æ¬¡è§†å›¾åˆ‡æ¢çš„æ—¶å€™éƒ½ä¼šé‡æ–°èµ‹å€¼ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;static RCTBridge *RCTCurrentBridgeInstance = nil;

/**
 * The last current active bridge instance. This is set automatically whenever
 * the bridge is accessed. It can be useful for static functions or singletons
 * that need to access the bridge for purposes such as logging, but should not
 * be relied upon to return any particular instance, due to race conditions.
 */
+ (instancetype)currentBridge
{
  return RCTCurrentBridgeInstance;
}

+ (void)setCurrentBridge:(RCTBridge *)currentBridge
{
  RCTCurrentBridgeInstance = currentBridge;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨&lt;code&gt;RCTBridge&lt;/code&gt;çš„åˆå§‹åŒ–æ–¹æ³•ä¸­åŒæ—¶è¿˜ä¼šå¯¹&lt;code&gt;RCTBatchedBridge&lt;/code&gt;è¿›è¡Œåˆå§‹åŒ–ï¼Œç”±å…¶å‘é€æ¶ˆæ¯å¼€å§‹åŠ è½½jsã€‚å…¶ä¸­åˆ†ä¸ºä¸¤æ­¥ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;åˆå§‹åŒ–modulå’Œloadèµ„æº&lt;/li&gt;
&lt;li&gt;è®¾ç½®JSçš„Executorå’Œmodulçš„é…ç½®&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å®ƒä»¬åœ¨åŒä¸€ä¸ªé˜Ÿåˆ—&lt;code&gt;dispatch_queue_t bridgeQueue = dispatch_queue_create(&amp;quot;com.facebook.react.RCTBridgeQueue&amp;quot;, DISPATCH_QUEUE_CONCURRENT);&lt;/code&gt;é‡Œçš„ä¸¤ä¸ªä¸åŒçš„groupä¸­å¼‚æ­¥æ‰§è¡Œï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;dispatch_group_t initModulesAndLoadSource = dispatch_group_create();&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;dispatch_group_t setupJSExecutorAndModuleConfig = dispatch_group_create();&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å› ä¸ºåœ¨ç¬¬ä¸€ä¸ªgroupä¸­çš„å¼‚æ­¥æ–¹æ³•ä¸­ä¹Ÿå­˜åœ¨å¼‚æ­¥æ“ä½œæ‰€æœ‰ä½œè€…ä½¿ç”¨çš„&lt;code&gt;dispatch_group_enter()&lt;/code&gt; å’Œ &lt;code&gt;dispatch_group_leave()&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ç¬¬äºŒä¸ªgroupç›´æ¥ç”¨çš„&lt;code&gt;dispatch_group_async(dispatch_group_t  _Nonnull group, dispatch_queue_t  _Nonnull queue, ^(void)block)&lt;/code&gt;
å½“ç¬¬äºŒgroupçš„å¼‚æ­¥ä»»åŠ¡å®Œæˆä¹‹åï¼ˆ&lt;code&gt;initModulesAndLoadSource&lt;/code&gt;ä¾èµ–&lt;code&gt;setupJSExecutorAndModuleConfig&lt;/code&gt;ï¼‰ï¼Œå°±å¼€å§‹æ‰§è¡Œå¯¹åº”çš„notifyé—­åŒ…å‘jsæ³¨å…¥jsonå­—ç¬¦ä¸²&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;dispatch_group_notify(setupJSExecutorAndModuleConfig, bridgeQueue, ^{
      // We&#39;re not waiting for this to complete to leave dispatch group, since
      // injectJSONConfiguration and executeSourceCode will schedule operations
      // on the same queue anyway.
      [performanceLogger markStartForTag:RCTPLNativeModuleInjectConfig];
      [weakSelf injectJSONConfiguration:config onComplete:^(NSError *error) {
        [performanceLogger markStopForTag:RCTPLNativeModuleInjectConfig];
        if (error) {
          RCTLogWarn(@&amp;quot;Failed to inject config: %@&amp;quot;, error);
          dispatch_async(dispatch_get_main_queue(), ^{
            [weakSelf stopLoadingWithError:error];
          });
        }
      }];
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¾…ç¬¬äºŒä¸ªgroupç»“æŸï¼Œå¼€å§‹æ‰§è¡Œç¬¬ä¸€ä¸ªgroupå¯¹åº”çš„notifyé—­åŒ…,å¼€å§‹åŠ è½½jsï¼ŒåŠ è½½ç»“æŸä¹‹åå‘å‡º&lt;code&gt;RCTJavaScriptDidLoadNotification&lt;/code&gt;é€šçŸ¥ã€‚&lt;/p&gt;

&lt;div class=&#34;alert info no-icon &#34;&gt;
  &lt;p&gt;æ‰§è¡ŒJSæ‰€æœ‰ç›¸å…³çš„å†…å®¹éƒ½æ˜¯&lt;code&gt;@protocol RCTJavaScriptExecutor&lt;/code&gt;è¿™ä¸ªåè®®è´Ÿè´£ï¼Œå®šä¹‰åœ¨bridgeä¸­&lt;code&gt;@property (nonatomic, weak, readonly) id&amp;lt;RCTJavaScriptExecutor&amp;gt; javaScriptExecutor;&lt;/code&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;å½“ä½ åœ¨Debugæ¨¡å¼ä¸‹saveæˆ–è€…é€€å‡ºå½“å‰é¡µé¢çš„æ—¶å€™æ”¶åˆ°reloadå‘½ä»¤ï¼Œè¯¥ç±»ä¼šåœ¨ä¸»çº¿ç¨‹ä¸­å°†å½“å‰çš„bridgeç½®ç©ºï¼Œå¦‚æœæ²¡æœ‰æˆåŠŸä¼šè°ƒç”¨å…¶æ‰€éµå¾ªçš„åè®®&lt;code&gt;@protocol RCTInvalidating&lt;/code&gt;ä¸­çš„&lt;code&gt;invalidate&lt;/code&gt;æ–¹æ³•è¿›è¡Œä¸€ç³»åˆ—çš„å±€éƒ¨å˜é‡é‡Šæ”¾æ“ä½œ&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;- (void)invalidate
{
  RCTBridge *batchedBridge = self.batchedBridge;
  self.batchedBridge = nil;

  if (batchedBridge) {
    RCTExecuteOnMainQueue(^{
      [batchedBridge invalidate];
    });
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;span class=&#34;highlight-text yellow&#34;&gt;æ€»ç»“ï¼š&lt;/span&gt;

&lt;ul&gt;
&lt;li&gt;ä¿å­˜æ¨¡å—çš„é›†åˆ &amp;ndash;&lt;code&gt;RCTModuleClasses&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å®šä¹‰äº†JSé˜Ÿåˆ— &amp;ndash; &lt;code&gt;dispatch_queue_t RCTJSThread&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å®šä¹‰å½“å‰æ­£åœ¨ä½¿ç”¨çš„bridgeï¼Œå¹¶è´Ÿè´£åˆ‡æ¢&lt;/li&gt;
&lt;li&gt;è´Ÿè´£&lt;code&gt;RCTBatchedBridge&lt;/code&gt;çš„åˆå§‹åŒ–ï¼Œè°ƒç”¨å­ç±»bridgeï¼Œå¼€å§‹æ‰§è¡ŒåŠ è½½jsçš„ä¸€ç³»åˆ—æ“ä½œ&lt;/li&gt;
&lt;li&gt;è´Ÿè´£åœ¨viewæ¶ˆå¤±æˆ–è€…é‡æ–°åŠ è½½çš„æ—¶å€™é‡Šæ”¾ä¹‹å‰çš„ä¸€äº›å¯¹è±¡ï¼ˆeg. currentbridge,éµå¾ª&lt;code&gt;RCTBridgeModule&lt;/code&gt;åè®®çš„å¯¹è±¡ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;</description>
    </item>
    
    <item>
      <title>React Nativeå’ŒNativeé—´çš„é€šä¿¡å®è·µ</title>
      <link>https://linkrober.github.io/bookshelf/2017/10/react-native%E5%92%8Cnative%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1%E5%AE%9E%E8%B7%B5/</link>
      <pubDate>Wed, 25 Oct 2017 00:00:00 +0000</pubDate>
      
      <guid>https://linkrober.github.io/bookshelf/2017/10/react-native%E5%92%8Cnative%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1%E5%AE%9E%E8%B7%B5/</guid>
      <description>&lt;!-- thumbnailImage = &#39;rn_image.jpeg&#39;
thumbnailImagePosition = &#39;bottom&#39; --&gt;

&lt;p&gt;æœ¬ç³»åˆ—æ–‡ç« ä½œä¸ºå­¦ä¹ RNæœŸé—´çš„æ€»ç»“&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://linkrober.github.io/bookshelf/2017/10/react-native%E5%A6%82%E4%BD%95%E9%9B%86%E6%88%90%E5%88%B0%E7%8E%B0%E6%9C%89%E9%A1%B9%E7%9B%AE%E4%B8%AD/&#34;&gt;React Nativeå¦‚ä½•é›†æˆåˆ°ç°æœ‰é¡¹ç›®ä¸­&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;React Nativeå’ŒNativeé—´çš„é€šä¿¡å®è·µ&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://linkrober.github.io/bookshelf/2017/10/rctrootviewrctbridge%E5%81%9A%E4%BA%86%E4%BB%80%E4%B9%88/&#34;&gt;RCTRootViewã€RCTBridgeåšäº†ä»€ä¹ˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://linkrober.github.io/bookshelf/2017/12/native%E5%92%8Cjs%E9%80%9A%E4%BF%A1%E6%A6%82%E8%BF%B0/&#34;&gt;Object-Cå’ŒJSé€šä¿¡æ¦‚è¿°&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;/p&gt;

&lt;p&gt;åˆšå¼€å§‹æ¥è§¦RNï¼Œæœ‰å‡ ç‚¹å¤§å®¶éƒ½æƒ³å¼„æ¸…æ¥šï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;å¦‚ä½•ä»Nativeå‘RNä¼ é€’å‚æ•°ï¼Œè¿™é‡Œä¹Ÿåˆ†ä¸ºå‡ å°ç‚¹&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;åœ¨åˆå§‹åŒ–RNçš„æ—¶å€™å¦‚ä½•ä»Nativeä¼ é€’åˆå§‹åŒ–çš„å‚æ•°&lt;/li&gt;
&lt;li&gt;åœ¨RNè§†å›¾å·²ç»æ¸²æŸ“å®Œæˆä¹‹åï¼Œå¦‚æœä»Nativeé‚£å‚æ•°&lt;/li&gt;
&lt;/ol&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å¦‚ä½•ä»RNå‘Nativeä¼ é€’å‚æ•°ï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;å¦‚ä½•å‘Nativeå‘é€æ¶ˆæ¯ï¼ˆèƒ½å¦ä½¿ç”¨é—­åŒ…ï¼‰&lt;/li&gt;
&lt;li&gt;å¦‚ä½•è®©RNæ¥å—naitveçš„å¼‚æ­¥å›è°ƒ&lt;/li&gt;
&lt;/ol&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;native-rn&#34;&gt;Native -&amp;gt; RN&lt;/h4&gt;

&lt;h6 id=&#34;properties&#34;&gt;Properties&lt;/h6&gt;

&lt;p&gt;&lt;code&gt;properties&lt;/code&gt;æ˜¯RNå’ŒNativeé—´é€šä¿¡æœ€ç®€å•çš„æ–¹å¼ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨åˆå§‹åŒ–&lt;code&gt;RCTRootView&lt;/code&gt;çš„æ—¶å€™ï¼Œå°†éœ€è¦çš„æ•°æ®é€šè¿‡æ–¹æ³•å…¥å‚çš„å½¢å¼ä¼ å…¥ï¼Œå®ƒæ˜¯ä¸€ä¸ªå­—å…¸ç±»å‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;- (instancetype)initWithBundleURL:(NSURL *)bundleURL
                       moduleName:(NSString *)moduleName
                initialProperties:&lt;span class=&#34;highlight-text red&#34;&gt;(NSDictionary *)initialProperties&lt;/span&gt;
                    launchOptions:(NSDictionary *)launchOptions
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨RNä¸­æˆ‘ä»¬ç”¨æ¥æ‰¿æ¥&lt;code&gt;initialProperties&lt;/code&gt;å‚æ•°çš„å°±æ˜¯æ¯ä¸ªjsç±»çš„&lt;code&gt;props&lt;/code&gt;ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨Nativeä¸­ä¿®æ”¹&lt;code&gt;props&lt;/code&gt;å±æ€§ï¼Œå°±è¦å¯¹&lt;code&gt;RCTRootView&lt;/code&gt;çš„&lt;code&gt;appProperties&lt;/code&gt;è¿›è¡Œé‡æ–°èµ‹å€¼ï¼Œç„¶åRNä¼šå¯¹è§†å›¾è¿›è¡Œé‡æ–°æ¸²æŸ“ï¼Œå½“ä¸”ä»…å½“ä¸¤æ¬¡èµ‹å€¼ä¸ä¸€æ ·çš„æ—¶å€™æ‰ä¼šé‡æ–°æ¸²æŸ“ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;rootView.appProperties = @{@&amp;quot;content&amp;quot; : imageList};
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;- (instancetype)initWithBridge:(RCTBridge *)bridge
                    moduleName:(NSString *)moduleName
             initialProperties:(NSDictionary *)initialProperties NS_DESIGNATED_INITIALIZER;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨åˆå§‹åŒ–bridgeæ—¶ä»¥ä»£ç†çš„æ–¹å¼å°†bundleURLä¼ å…¥ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;- (instancetype)initWithDelegate:(id&amp;lt;RCTBridgeDelegate&amp;gt;)delegate
                   launchOptions:(NSDictionary *)launchOptions;


 @protocol RCTBridgeDelegate &amp;lt;NSObject&amp;gt;

/**
 * The location of the JavaScript source file. When running from the packager
 * this should be an absolute URL, e.g. `http://localhost:8081/index.ios.bundle`.
 * When running from a locally bundled JS file, this should be a `file://` url
 * pointing to a path inside the app resources, e.g. `file://.../main.jsbundle`.
 */
- (NSURL *)sourceURLForBridge:(RCTBridge *)bridge;

@optional 
&lt;/code&gt;&lt;/pre&gt;

&lt;div class=&#34;alert warning &#34;&gt;
  &lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œèµ‹å€¼æ“ä½œå¿…éœ€è¦æ”¾åœ¨Nativeçš„ä¸»çº¿ç¨‹ã€‚è€Œä¸”jsä¸­çš„&lt;code&gt;componentWillReceiveProps&lt;/code&gt;å’Œ&lt;code&gt;componentWillUpdateProps&lt;/code&gt;å¹¶ä¸ä¼šå› ä¸ºé‡æ–°æ¸²æŸ“è€Œè¢«å†æ¬¡è°ƒç”¨ï¼Œä½ åªèƒ½åœ¨&lt;code&gt;componentWillMount&lt;/code&gt;æ–¹æ³•ä¸­è®¿é—®æ–°çš„&lt;code&gt;props&lt;/code&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;h6 id=&#34;rcteventemitter&#34;&gt;RCTEventEmitter&lt;/h6&gt;

&lt;p&gt;æˆ‘ä»¬å¯ä»¥ä½¿ç”¨&lt;code&gt;RCTEventEmitter&lt;/code&gt;ç±»æ¥è®©jsç›‘å¬nativeçš„äº‹ä»¶ï¼Œfacebookçš„æ–‡æ¡£ä¸­æ˜¯è¿™æ ·æè¿°&lt;code&gt;RCTEventEmitter&lt;/code&gt;çš„ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;/**
 * RCTEventEmitter is an abstract base class to be used for modules that emit
 * events to be observed by JS.
 */
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å®ƒæ˜¯ä¸€ä¸ªæ¨¡å—çš„æŠ½è±¡åŸºç±»ï¼Œç”¨æ¥å‘é€è¢«JSç›‘å¬çš„äº‹ä»¶ã€‚æˆ‘ä»¬é€šè¿‡&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;- (void)sendEventWithName:(NSString *)name body:(id)body
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ–¹æ³•æ¥å®Œæˆäº‹ä»¶çš„å‘é€ã€‚å…¥å‚æ˜¯äº‹ä»¶åç§°å’Œéœ€è¦æºå¸¦çš„å‚æ•°ï¼ˆDictionaryï¼‰ã€‚
æ¯ä¸€ä¸ª&lt;code&gt;RCTRootView&lt;/code&gt;éƒ½æœ‰ä¸€ä¸ª&lt;code&gt;RCTBridge&lt;/code&gt;å±æ€§ï¼Œå®ƒæ˜¯RNä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªç±»ï¼Œè´Ÿè´£Nativeå’ŒJSä¹‹é—´çš„é€šä¿¡ã€‚é€šè¿‡&lt;code&gt;RCTBridge&lt;/code&gt;çš„:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;/**
 * Retrieve a bridge module instance by name or class. Note that modules are
 * lazily instantiated, so calling these methods for the first time with a given
 * module name/class may cause the class to be sychronously instantiated,
 * potentially blocking both the calling thread and main thread for a short time.
 */
- (id)moduleForName:(NSString *)moduleName;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æ‹¿åˆ°æ¯ä¸ª&lt;code&gt;RCTRootView&lt;/code&gt;å¯¹åº”çš„&lt;code&gt;RCTEventEmitter&lt;/code&gt;å®ä¾‹ï¼ˆå®ƒæ˜¯é€šè¿‡lazy loadçš„æ–¹å¼åˆå§‹åŒ–çš„ï¼‰ï¼Œå› ä¸ºè¿™é‡Œçš„&lt;code&gt;moduleName&lt;/code&gt;å‚æ•°å¯ä»¥æ˜¯ç±»åä¹Ÿå¯ä»¥æ˜¯è‡ªå®šä¹‰çš„æ¨¡å—åç§°ï¼Œæ‰€ä»¥åœ¨é¡¹ç›®ä¸­å¦‚æœå‡ºç°å¤šä¸ªå®ä¾‹ï¼Œéœ€è¦åœ¨åˆå§‹åŒ–é€šè¿‡viewçš„&lt;code&gt;reactTag&lt;/code&gt;å±æ€§æ¥åŒºåˆ†ã€‚è¯¥å±æ€§å£°æ˜åœ¨åˆ†ç±»&lt;code&gt;UIView+React.h&lt;/code&gt;ä¸­ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;RCT_EXPORT_MODULE();

+ (EventEmitterManger *)mangerWithRootView:(RCTRootView *)rootView {
    return [rootView.bridge moduleForName:NSStringFromClass(self)];
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™æ ·æˆ‘ä»¬å°±æ‹¿åˆ°ç›®æ ‡RootViewå¯¹åº”çš„&lt;code&gt;RCTEventEmitter&lt;/code&gt;å¯¹è±¡ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ä¸ºäº‹ä»¶å®šä¹‰ä¸€ä¸ªidentifierï¼Œé‡å†™&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;/**
 * Override this method to return an array of supported event names. Attempting
 * to observe or send an event that isn&#39;t included in this list will result in
 * an error.
 */
- (NSArray&amp;lt;NSString *&amp;gt; *)supportedEvents;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ–¹æ³•ï¼ŒæŠŠä½ æ–¹æ³•çš„identiferä½œä¸ºæ•°ç»„çš„ä¸€ä¸ªå…ƒç´ è¿”å›ã€‚è¿™æ ·å°±å¯ä»¥ä½¿ç”¨ä¸Šé¢æ‰€è¯´çš„æ–¹æ³•è¿›è¡Œæ¶ˆæ¯çš„å‘é€äº†ã€‚
åˆ°è¿™é‡ŒNativeç«¯çš„ä»£ç å·²ç»å®Œæˆäº†ï¼Œä¸‹é¢çœ‹åœ¨jsä¸­å¦‚ä½•è®¾ç½®ã€‚
æˆ‘ä»¬éœ€è¦åœ¨å¯¹åº”çš„jsä¸­å¼•å…¥ä¸€ä¸ª&lt;code&gt;NativeModules&lt;/code&gt;ã€&lt;code&gt;NativeEventEmitter&lt;/code&gt;æ¨¡å—ï¼Œç„¶åè·å–ç›‘å¬æ¨¡å—çš„manger&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var raToRnManger = NativeModules.EventEmitterManger
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨jså¯¹è±¡çš„å£°æ˜å‘¨æœŸæ–¹æ³•&lt;code&gt;componentWillMount&lt;/code&gt;ä¸­è®¾ç½®ç›‘å¬ï¼Œæ¥ä¸‹æ¥å°±ç­‰nativeå‘é€æ¶ˆæ¯äº†ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;componentWillMount(){
         var raToRnMangerEmitter = new NativeEventEmitter(raToRnManger)
          const subscription = raToRnMangerEmitter.addListener(&amp;quot;EventReminder&amp;quot;,
              (reminder) =&amp;gt; {
                  console.log(&amp;quot;test&amp;quot;)
                    this.setState({
                        name:&amp;quot;B&amp;quot;
                    })
              }
          );
    }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;rn-native&#34;&gt;RN -&amp;gt; Native&lt;/h4&gt;

&lt;h6 id=&#34;rctbridgemodule&#34;&gt;RCTBridgeModule&lt;/h6&gt;

&lt;p&gt;åœ¨Nativeç«¯å®šä¹‰RNæ¨¡å—çš„æ—¶å€™ï¼Œè®©å…¶éµå¾ª&lt;code&gt;&amp;lt;RCTBridgeModule&amp;gt;&lt;/code&gt;åè®®ï¼Œåœ¨å®ç°æ–‡ä»¶ä¸­æš´éœ²å‡ºä½ æƒ³è¦ä»RNå‘Nativeå‘é€çš„æ¶ˆæ¯&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;RCT_EXPORT_METHOD(exampleMethod:(NSString *)name)
{
    NSLog(@&amp;quot;%@&amp;quot;,name);
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚æœä½ æƒ³è¦è¯¥æ–¹æ³•å‚æ•°æ”¯æŒé—­åŒ…ï¼Œå¯ä»¥ä½¿ç”¨RNå†…ç½®çš„é—­åŒ…ç±»å‹&lt;code&gt;RCTResponseSenderBlock&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;RCT_EXPORT_METHOD(exampleCallbackMethod:(RCTResponseSenderBlock)callback)
{
    NSDictionary *param = @{@&amp;quot;letter&amp;quot;:@&amp;quot;B&amp;quot;};
    callback(@[[NSNull null], param]);
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨jsç«¯ï¼Œé€šè¿‡&lt;code&gt;NativeModules&lt;/code&gt;æ¨¡å—æ‹¿åˆ°Nativeä¸­å¯¹åº”çš„æ¨¡å—&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var manger = NativeModules.ExportMethodManger
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚æœRNä¸­æŸä¸ªäº‹ä»¶è¢«è§¦å‘äº†ï¼Œç›´æ¥é€šè¿‡mangerå‘Nativeå‘é€æ¶ˆæ¯ï¼Œæ¶ˆæ¯åç§°æ­£å¦‚ä½ åœ¨Nativeä¸­å£°æ˜çš„é‚£æ ·&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;onPressLearnMore(){
        manger.exampleMethod(&amp;quot;##############Learn More############&amp;quot;)
    }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨Nativeé¡¹ç›®ä¸­åµŒå…¥RNï¼Œä½ ç»å¯¹ä¸æƒ³è¦åœ¨jsä¸­å†å†™ä¸€å¥—ç½‘ç»œè¯·æ±‚å§ã€‚è¿™æ—¶å€™å°±ä¼šé‡åˆ°ç”¨RNå±•ç¤ºUIï¼Œè€Œæ•°æ®è¯·æ±‚æ”¾åœ¨åœ¨Nativeä¸­åšçš„æƒ…å†µã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨&lt;code&gt;XMLHttpRequest&lt;/code&gt;è¿™ç±»jsç½‘ç»œæ¡†æ¶ï¼Œä½†æ˜¯è¿™é‡Œæƒ³è¯´çš„æ˜¯&lt;code&gt;async/await&lt;/code&gt;è¯­æ³•ï¼Œå®ƒåœ¨ES6ä¸­è¢«æä¾›ã€‚ä»å‘½åä¸Šä¸€çœ¼å°±èƒ½çœ‹å‡ºå…¶ç›®çš„ï¼Œå¼‚æ­¥æ–¹æ³•ç­‰å¾…æ¶ˆæ¯è¿”å›ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;async updateEvents(){
        try {
            var events = await manger.findEvents();
            this.setState({
                letter:events[0].letter
            });
          } catch (e) {
            console.error(e);
          }
    }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™æ ·ï¼Œå¦‚æœNativeä¸­&lt;code&gt;findEvents&lt;/code&gt;æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„æ–¹æ³•å°±å¯ä»¥åœ¨jsä¸­ç­‰å¾…Nativeçš„å›è°ƒäº†ã€‚&lt;/p&gt;

&lt;div class=&#34;alert info &#34;&gt;
  &lt;p&gt;ä»JSåˆ°Naitveæ‰€æœ‰çš„æ¶ˆæ¯éƒ½æ˜¯ç”±&lt;code&gt;NSInvocation&lt;/code&gt;è´Ÿè´£è½¬å‘ï¼Œåé¢æ‰“ç®—ä¸“é—¨å¼€ä¸€ç« è®¨è®ºè¿™ä¸ªç±»åœ¨RNä¸­çš„ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>React Nativeå¦‚ä½•é›†æˆåˆ°ç°æœ‰é¡¹ç›®ä¸­</title>
      <link>https://linkrober.github.io/bookshelf/2017/10/react-native%E5%A6%82%E4%BD%95%E9%9B%86%E6%88%90%E5%88%B0%E7%8E%B0%E6%9C%89%E9%A1%B9%E7%9B%AE%E4%B8%AD/</link>
      <pubDate>Mon, 23 Oct 2017 00:00:00 +0000</pubDate>
      
      <guid>https://linkrober.github.io/bookshelf/2017/10/react-native%E5%A6%82%E4%BD%95%E9%9B%86%E6%88%90%E5%88%B0%E7%8E%B0%E6%9C%89%E9%A1%B9%E7%9B%AE%E4%B8%AD/</guid>
      <description>&lt;!-- thumbnailImage = &#39;rn_thumbnailImage.jpeg&#39;
thumbnailImagePosition = &#39;bottom&#39; --&gt;

&lt;p&gt;æœ¬ç³»åˆ—æ–‡ç« ä½œä¸ºå­¦ä¹ RNæœŸé—´çš„æ€»ç»“&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;React Nativeå¦‚ä½•é›†æˆåˆ°ç°æœ‰é¡¹ç›®ä¸­&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://linkrober.github.io/bookshelf/2017/10/react-native%E5%92%8Cnative%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1/&#34;&gt;React Nativeå’ŒNativeé—´çš„é€šä¿¡å®è·µ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://linkrober.github.io/bookshelf/2017/10/rctrootviewrctbridge%E5%81%9A%E4%BA%86%E4%BB%80%E4%B9%88/&#34;&gt;RCTRootViewã€RCTBridgeåšäº†ä»€ä¹ˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://linkrober.github.io/bookshelf/2017/12/native%E5%92%8Cjs%E9%80%9A%E4%BF%A1%E6%A6%82%E8%BF%B0/&#34;&gt;Object-Cå’ŒJSé€šä¿¡æ¦‚è¿°&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;/p&gt;

&lt;p&gt;è™½ç„¶ReactNativeèƒ½åšåˆ°iOSå’ŒAndroidçš„å¤§éƒ¨åˆ†é€»è¾‘å…±äº«ä¸€å¥—ä»£ç ï¼ŒèŠ‚çº¦å¼€å‘æˆæœ¬ï¼›æ‹¥æœ‰åƒJSPatché‚£æ ·çš„çƒ­ä¿®å¤åŠŸèƒ½ï¼Œä¸ºçº¿ä¸Šé—®é¢˜æä¾›éå¸¸çµæ´»çš„è§£å†³æ–¹æ¡ˆã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆå¤§éƒ¨åˆ†å…¬å¸è¿˜æ˜¯æŒè§‚æœ›æ€åº¦ï¼Œæˆ–è€…åªåœ¨äº§å“çš„æŸäº›éƒ¨åˆ†ç”¨RNè¿›è¡Œå¼€å‘å‘¢ï¼Ÿ&lt;/p&gt;

&lt;p&gt;é¦–å…ˆï¼ŒReact Nativeå®˜æ–¹çš„æŸäº›ç»„ä»¶ä»ç„¶å­˜åœ¨æ€§èƒ½ç“¶é¢ˆï¼Œå¼€å‘å¤æ‚åœºæ™¯çš„æ—¶å€™å¯èƒ½ä¼šé‡åˆ°æ€§èƒ½é—®é¢˜ï¼ŒåƒListViewï¼ŒåŠ¨ä¸åŠ¨å°±æ¸²æŸ“æ•´ä¸ªè§†å›¾ï¼Œè™½ç„¶æ¨å‡ºäº†FlatListä½†æ˜¯ä¹Ÿå­˜åœ¨ç€ä¸€äº›å…¶ä»–çš„Bugã€‚å…¶æ¬¡ï¼ŒRNçš„å‘¨è¾¹ç”Ÿæ€å¹¶ä¸å®Œå–„ï¼Œå¾ˆå¤šOCæˆ–Swiftä¸Šå·²æœ‰çš„Libraryåœ¨NRä¸Šéœ€è¦é€šè¿‡RNæä¾›çš„æ–¹æ³•é‡æ–°ç”¨JSå®ç°æˆ–è€…éœ€è¦æŠŠè¿™äº›åº“æ¡¥æ¥åˆ°RNã€‚å› æ­¤å¤§éƒ¨åˆ†å…¬å¸ä¼šé€‰æ‹©äº¤äº’ä¸å¤šï¼Œé¡µé¢ä¸å¤ªå¤æ‚çš„åœºæ™¯æ¥å°è¯•ã€‚æœ¬ç« ï¼Œä¸»è¦ä»‹ç»å¦‚æœåœ¨å·²æœ‰çš„Appä¸­é›†æˆReact Nativeã€‚&lt;/p&gt;

&lt;h4 id=&#34;å…³é”®æ­¥éª¤&#34;&gt;å…³é”®æ­¥éª¤&lt;/h4&gt;

&lt;ol&gt;
&lt;li&gt;è®¾ç½®RNçš„ä¾èµ–å’Œç›®å½•ç»“æ„&lt;/li&gt;
&lt;li&gt;ææ¸…æ¥šä½ è¦åœ¨ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨çš„RNç»„ä»¶&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨CocoaPodsæ·»åŠ ä½ è¦ä½¿ç”¨çš„RNç»„ä»¶çš„ä¾èµ–&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨npmå®‰è£…JSç»„ä»¶&lt;/li&gt;
&lt;li&gt;åœ¨JavaScriptç¯å¢ƒä¸‹ï¼Œå¼€å‘ä½ çš„RNæ¨¡å—&lt;/li&gt;
&lt;li&gt;æ·»åŠ ä¸€ä¸ª&lt;code&gt;RCTRootView&lt;/code&gt;åˆ°ä½ çš„appã€‚å®ƒå°†ä¼šä½œä¸ºå®¹å™¨å±•ç¤ºä½ çš„RNæ¨¡å—ã€‚&lt;/li&gt;
&lt;li&gt;å¯åŠ¨RNæœåŠ¡ï¼ŒRunä½ çš„Appã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&#34;alert info &#34;&gt;
  &lt;p&gt;å‰ç½®æ¡ä»¶ï¼šå®‰è£…Nodeã€npmæœ€æ–°ç‰ˆæœ¬(npmæ˜¯åŸºäºNodeå®ç°çš„åŒ…ç®¡ç†å·¥å…·å’ŒiOSçš„CocoaPodåœ°ä½ç›¸å½“)&lt;/p&gt;
&lt;/div&gt;

&lt;h6 id=&#34;è®¾ç½®rnçš„ä¾èµ–å’Œç›®å½•ç»“æ„&#34;&gt;è®¾ç½®RNçš„ä¾èµ–å’Œç›®å½•ç»“æ„&lt;/h6&gt;

&lt;p&gt;ä¸ºReact Nativeé¡¹ç›®åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ï¼Œåœ¨æ–‡ä»¶å¤¹ä¸­æ–°å»º&lt;code&gt;/ios&lt;/code&gt;ç›®å½•ï¼Œæ‹·è´æ‰€æœ‰åŸé¡¹ç›®çš„å†…å®¹åˆ°&lt;code&gt;/ios&lt;/code&gt;ç›®å½•ä¸‹ã€‚&lt;/p&gt;

&lt;h6 id=&#34;å®‰è£…javascriptä¾èµ–&#34;&gt;å®‰è£…JavaScriptä¾èµ–&lt;/h6&gt;

&lt;p&gt;åœ¨åˆšåˆšæ–°å»ºçš„æ–‡ä»¶å¤¹ä¸­ï¼ˆå³æ ¹ç›®å½•ä¸­ï¼‰åˆ›å»ºä¸€ä¸ª&lt;code&gt;package.json&lt;/code&gt;æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä¸€ä¸‹å†…å®¹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{
  &amp;quot;name&amp;quot;: &amp;quot;Snapvote&amp;quot;,
  &amp;quot;version&amp;quot;: &amp;quot;0.0.1&amp;quot;,
  &amp;quot;private&amp;quot;: true,
  &amp;quot;scripts&amp;quot;: {
    &amp;quot;start&amp;quot;: &amp;quot;node node_modules/react-native/local-cli/cli.js start&amp;quot;,
    &amp;quot;test&amp;quot;: &amp;quot;jest&amp;quot;
  },
  &amp;quot;dependencies&amp;quot;: {
    &amp;quot;react&amp;quot;: &amp;quot;16.0.0-alpha.12&amp;quot;,
    &amp;quot;react-native&amp;quot;: &amp;quot;0.48.4&amp;quot;,
    &amp;quot;react-native-vector-icons&amp;quot;: &amp;quot;^4.4.2&amp;quot;,
    &amp;quot;whatwg-fetch&amp;quot;: &amp;quot;^2.0.3&amp;quot;
  },
  &amp;quot;devDependencies&amp;quot;: {
    &amp;quot;babel-jest&amp;quot;: &amp;quot;21.2.0&amp;quot;,
    &amp;quot;babel-preset-react-native&amp;quot;: &amp;quot;4.0.0&amp;quot;,
    &amp;quot;jest&amp;quot;: &amp;quot;21.2.0&amp;quot;,
    &amp;quot;react-test-renderer&amp;quot;: &amp;quot;16.0.0-alpha.12&amp;quot;
  },
  &amp;quot;jest&amp;quot;: {
    &amp;quot;preset&amp;quot;: &amp;quot;react-native&amp;quot;
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ¥ä¸‹å»ï¼Œå®‰è£…reactå’Œreact-nativeåŒ…ã€‚æ‰“å¼€Terminalï¼Œåœ¨ä½ é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹é¢æ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;npm install --save r16.0.0-alpha.12 react-native
&lt;/code&gt;&lt;/pre&gt;

&lt;div class=&#34;alert warning &#34;&gt;
  &lt;p&gt;è¦ç¡®ä¿è¿™é‡Œå®‰è£…çš„ç‰ˆæœ¬å’Œpackage.jsoné‡Œè¯´æ˜çš„ç‰ˆæœ¬ä¸€è‡´&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ä¹‹åï¼Œå°†ä¼šåœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª&lt;code&gt;/node_modules&lt;/code&gt;çš„ç›®å½•ï¼Œè¿™é‡Œä¿å­˜ç€æ‰€æœ‰ä½ é¡¹ç›®ä¸­æ‰€éœ€çš„JavaScriptä¾èµ–ã€‚&lt;/p&gt;

&lt;h6 id=&#34;å®‰è£…cocoapods&#34;&gt;å®‰è£…CocoaPods&lt;/h6&gt;

&lt;p&gt;è¿™é‡Œå°±ä¸è¯´äº†&lt;/p&gt;

&lt;h6 id=&#34;é…ç½®cocoapodsä¾èµ–&#34;&gt;é…ç½®CocoaPodsä¾èµ–&lt;/h6&gt;

&lt;p&gt;åœ¨ä½ é›†æˆRNåˆ°ä½ é¡¹ç›®ä¸­ä¹‹å‰ï¼Œä½ éœ€è¦é€‰æ‹©ä½ è¦ä½¿ç”¨çš„React Nativeåº“ã€‚ä½ å°†é€šè¿‡CocoaPodåº“çš„å¼€å‘æ¨¡å¼å°†å…¶é›†æˆè¿›å»ã€‚
&lt;img src=&#34;../../../pod_develop.png&#34; alt=&#34;pod_develop&#34; /&gt;
è¿™äº›åº“çš„&lt;code&gt;subspec&lt;/code&gt;æ–‡ä»¶éƒ½ä¼šåœ¨&lt;code&gt;/node_modules&lt;/code&gt;ç›®å½•ä¸‹è¢«è¯´æ˜,æœ€åæ‰§è¡Œ&lt;code&gt;pod install&lt;/code&gt;å‘½ä»¤ï¼Œæ‰€æœ‰çš„React Nativeåº“ä¾èµ–åˆ°è¿™é‡Œå°±éƒ½å‡†å¤‡å¥½äº†ã€‚
&lt;img src=&#34;../../../pod_file.png&#34; alt=&#34;pod_file&#34; /&gt;&lt;/p&gt;

&lt;h6 id=&#34;ä¸šåŠ¡ä»£ç &#34;&gt;ä¸šåŠ¡ä»£ç &lt;/h6&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;åˆ›å»º &lt;code&gt;index.js&lt;/code&gt; æ–‡ä»¶
åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»º&lt;code&gt;index.js&lt;/code&gt;æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯ä½ RNé¡¹ç›®çš„
&lt;span class=&#34;highlight-text danger&#34;&gt;
å…¥å£
&lt;/span&gt;ï¼Œæ‰€æœ‰åœ¨Nativeä¸­è¦ç”¨åˆ°çš„RNæ¨¡å—éƒ½åœ¨è¿™é‡Œé¢è¿›è¡Œæ³¨å†Œã€‚ä¾‹å¦‚é¡¹ç›®ä¸­çš„æŠ•ç¥¨åˆ—è¡¨ã€è®¾ç½®é¡µé¢ç­‰ã€‚å„ä¸ªæ¨¡å—çš„åç§°è¦å’ŒNativeä¸­çš„æ¨¡å—åç§°å¯¹åº”ã€‚
&lt;img src=&#34;../../../rn_modul.png&#34; alt=&#34;rn_modul&#34; /&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;æ·»åŠ React Native ä»£ç ï¼ˆJavaScriptå’ŒCSSï¼‰&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;pre&gt;&lt;code&gt;&#39;use strict&#39;;

import React from &#39;react&#39;;
import {
  AppRegistry,
  StyleSheet,
  Text,
  View,
  FlatList,
  NativeModules,
  Image,
  ActivityIndicator,
  TouchableOpacity,
  ScrollView,
  Switch,
  TouchableWithoutFeedback,
  Alert,
  NativeEventEmitter,
  
} from &#39;react-native&#39;;

import StarRatingView from &#39;./starRating.view.js&#39;

var { width, height } = require(&#39;Dimensions&#39;).get(&#39;window&#39;);
var nativeModuleManager = NativeModules.XYRCTBrigeModule;

class SettingsView extends React.PureComponent{

    constructor(props){
        super(props);
    }
    .....
    .....
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨Nativeä¸­ä½¿ç”¨&lt;code&gt;RCTRootView&lt;/code&gt;ä½œä¸ºRNæ¨¡å—çš„å®¹å™¨ã€‚æ‰€æœ‰é€šè¿‡RNæ¸²æŸ“å‡ºæ¥çš„è§†å›¾éƒ½ä¼šå±•ç¤ºåœ¨è¯¥Viewä¸Šã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;#import &amp;lt;React/RCTBundleURLProvider.h&amp;gt;
#import &amp;lt;React/RCTRootView.h&amp;gt;

@implementation AppDelegate

- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
{
  NSURL *jsCodeLocation;
  &lt;span class=&#34;highlight-text green&#34;&gt;//è®¾ç½®è·å–JavaScriptæ–‡ä»¶çš„è·¯å¾„ï¼Œä»æœåŠ¡å™¨æˆ–è€…æœ¬åœ°æ–‡ä»¶è·å–&lt;/span&gt;
#if DEBUG
  jsCodeLocation = [NSURL URLWithString:@&amp;quot;http://10.0.30.119:8081/index.ios.bundle?platform=ios&amp;quot;];
#else
  jsCodeLocation = [[RCTBundleURLProvider sharedSettings] jsBundleURLForBundleRoot:@&amp;quot;index.ios&amp;quot; fallbackResource:nil];
#endif
  
  &lt;span class=&#34;highlight-text green&#34;&gt;//é€šè¿‡URLã€æ¨¡å—åç§°åŠ è½½å¯¹åº”çš„RNè§†å›¾ï¼Œç”Ÿæˆä¸€ä¸ªOCå¯¹è±¡`RCTRootView`ï¼Œæœ€åå°†è¯¥Viewæ·»åŠ åˆ°controllerçš„Viewä¸Š&lt;/span&gt;
  RCTRootView *rootView = [[RCTRootView alloc] initWithBundleURL:jsCodeLocation
                                                      moduleName:@&amp;quot;TabberView&amp;quot;
                                               initialProperties:nil
                                                   launchOptions:launchOptions];
  rootView.backgroundColor = [[UIColor alloc] initWithRed:1.0f green:1.0f blue:1.0f alpha:1];
  
  self.window = [[UIWindow alloc] initWithFrame:[UIScreen mainScreen].bounds];
  UIViewController *rootViewController = [UIViewController new];
  rootViewController.view = rootView;
  self.window.rootViewController = rootViewController;
  [self.window makeKeyAndVisible];
  return YES;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åˆ°è¿™é‡Œå°±å®Œæˆäº†ä¸€ä¸ªç®€å•React Native Appçš„é›†æˆã€‚&lt;/p&gt;

&lt;h4 id=&#34;æµ‹è¯•&#34;&gt;æµ‹è¯•&lt;/h4&gt;

&lt;ol&gt;
&lt;li&gt;å› ä¸ºHTTPSçš„é™åˆ¶ï¼Œè¯·å°†Domainæ·»åŠ åˆ°&lt;code&gt;Info.plist&lt;/code&gt;çš„ç™½åå•
&lt;code&gt;
&amp;lt;key&amp;gt;NSAppTransportSecurity&amp;lt;/key&amp;gt;
&amp;lt;dict&amp;gt;
&amp;lt;key&amp;gt;NSExceptionDomains&amp;lt;/key&amp;gt;
&amp;lt;dict&amp;gt;
    &amp;lt;key&amp;gt;localhost&amp;lt;/key&amp;gt;
    &amp;lt;dict&amp;gt;
        &amp;lt;key&amp;gt;NSTemporaryExceptionAllowsInsecureHTTPLoads&amp;lt;/key&amp;gt;
        &amp;lt;true/&amp;gt;
    &amp;lt;/dict&amp;gt;
&amp;lt;/dict&amp;gt;
&amp;lt;/dict&amp;gt;
&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œ&lt;code&gt;npm start&lt;/code&gt;å¼€å¯æœ¬åœ°æœåŠ¡&lt;/li&gt;
&lt;li&gt;Xcode run.&lt;/li&gt;
&lt;/ol&gt;

&lt;h4 id=&#34;ç›¸å…³é“¾æ¥&#34;&gt;ç›¸å…³é“¾æ¥&lt;/h4&gt;

&lt;p&gt;&lt;a href=&#34;https://facebook.github.io/react-native/docs/integration-with-existing-apps.html&#34;&gt;Integration with Existing Apps&lt;/a&gt;&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>Runtime(ä¸‰) æ¶ˆæ¯è½¬å‘</title>
      <link>https://linkrober.github.io/bookshelf/2017/10/runtime%E4%B8%89-%E6%B6%88%E6%81%AF%E8%BD%AC%E5%8F%91/</link>
      <pubDate>Mon, 16 Oct 2017 00:00:00 +0000</pubDate>
      
      <guid>https://linkrober.github.io/bookshelf/2017/10/runtime%E4%B8%89-%E6%B6%88%E6%81%AF%E8%BD%AC%E5%8F%91/</guid>
      <description>&lt;p&gt;å‘å¯¹è±¡å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼Œå¦‚æœæ²¡æœ‰å¤„ç†å°±ä¼šå‘ç”Ÿé”™è¯¯ã€‚ä½†æ˜¯åœ¨äº§ç”Ÿé”™è¯¯ä¹‹å‰ï¼Œruntimeä¼šç»™æ¥å—å¯¹è±¡ç¬¬äºŒæ¬¡æœºä¼šæ¥å¤„ç†æ¶ˆæ¯ã€‚
&lt;/p&gt;

&lt;h3 id=&#34;forwarding&#34;&gt;Forwarding&lt;/h3&gt;

&lt;p&gt;å‘å¯¹è±¡å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼Œå¦‚æœæ²¡æœ‰å¤„ç†å°±ä¼šå‘ç”Ÿé”™è¯¯ã€‚ä½†æ˜¯åœ¨äº§ç”Ÿé”™è¯¯ä¹‹å‰ï¼Œruntimeä¼šå‘å¯¹è±¡å‘é€&lt;code&gt;forwardInvocation:&lt;/code&gt;æ¶ˆæ¯ï¼Œæ¶ˆæ¯æºå¸¦äº†ä¸€ä¸ª&lt;code&gt;NSInvocation&lt;/code&gt;å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡é‡Œé¢åŒ…è£¹äº†åŸå§‹æ¶ˆæ¯å’Œå‚æ•°ã€‚&lt;/p&gt;

&lt;p&gt;ä½ å¯ä»¥å®ç°&lt;code&gt;forwardInvocation:&lt;/code&gt;æ–¹æ³•æ¥å¤„ç†æ¶ˆæ¯ï¼Œæ¥é¿å…é”™è¯¯çš„å‘ç”Ÿã€‚æ­£å¦‚æ–¹æ³•åæ‰€æš—ç¤ºçš„&lt;code&gt;forwardInvocation:&lt;/code&gt;ä¸€èˆ¬ç”¨æ¥å‘å¦ä¸€ä¸ªå¯¹è±¡è½¬å‘æ¶ˆæ¯ã€‚&lt;/p&gt;

&lt;p&gt;ä¸ºäº†çœ‹åˆ°è½¬å‘çš„è¿‡ç¨‹å’Œç»“æœï¼Œæˆ‘ä»¬æƒ³è±¡ä¸‹é¢çš„åœºæ™¯ï¼šé¦–å…ˆï¼Œä½ è®¾è®¡äº†ä¸€ä¸ªå¯¹è±¡èƒ½å¤Ÿå“åº”&lt;code&gt;negotiate&lt;/code&gt;æ–¹æ³•ï¼Œä½ å¸Œæœ›å®ƒèƒ½å¤Ÿå“åº”å¦å¤–ä¸€ä¸ªå¯¹è±¡çš„æ¶ˆæ¯ã€‚æ— è®º&lt;code&gt;negotiate&lt;/code&gt;çš„æ–¹æ³•ä½“æ˜¯åœ¨å“ªé‡Œå®ç°çš„,ä½ å¯ä»¥é€šè¿‡ä¼ å…¥&lt;code&gt;negotiate&lt;/code&gt;æ¶ˆæ¯åˆ°å¦ä¸€ä¸ªå¯¹è±¡æ¥å®Œæˆã€‚ä¸‹ä¸€æ­¥ï¼Œå‡è®¾ä½ æƒ³è¦&lt;code&gt;negotiate&lt;/code&gt;æ¶ˆæ¯çš„å“åº”å¯ä»¥è¢«å¦å¤–ä¸€ä¸ªç±»æ˜ç¡®çš„æ¥å—ã€‚ä¸€ç§åŠæ³•æ˜¯é€šè¿‡ç»§æ‰¿çš„æ–¹å¼ï¼Œè®©ä½ çš„ç±»ä»çˆ¶ç±»ä¸­ç»§æ‰¿è¿™ä¸ªæ–¹æ³•ã€‚ä½†æ˜¯å¦‚æœåœ¨ä¸åŒçš„ç»§æ‰¿é“¾ä¸­ï¼Œè¿™ç§æ–¹æ³•æ˜¯ä¸å¯èƒ½å®ç°çš„ã€‚&lt;/p&gt;

&lt;p&gt;å³ä½¿ä½ çš„ç±»ä¸èƒ½é€šè¿‡ç»§æ‰¿çš„æ–¹å¼ä½¿ç”¨&lt;code&gt;negotiate&lt;/code&gt;æ–¹æ³•ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥å€Ÿç”¨ä¸‹é¢è¿™ç§æ–¹å¼ï¼Œå‘å¦ä¸€ä¸ªç±»å¯¹è±¡ä¼ é€’æ¶ˆæ¯ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;- (id)negotiate
{
    if ( [someOtherObject respondsTo:@selector(negotiate)] )
        return [someOtherObject negotiate];
    return self;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½†æ˜¯è¿™ç§æ–¹å¼æœ‰ç‚¹ç¬¨é‡ï¼Œç‰¹åˆ«æ˜¯å¦‚æœä½ æœ‰å¤§é‡çš„æ¶ˆæ¯éœ€è¦ä¼ é€’åˆ°å¦ä¸€ä¸ªç±»çš„æ—¶å€™ã€‚ä½ å¿…é¡»è¦åœ¨ä¸€ä¸ªæ–¹æ³•é‡Œé¢è¦†ç›–æ‰€æœ‰ä½ æƒ³è¦è°ƒç”¨çš„å…¶ä»–ç±»çš„æ–¹æ³•ã€‚è€Œä¸”ï¼Œå¯èƒ½æœ‰äº›æ–¹æ³•ä½ ä¸èƒ½è€ƒè™‘å‘¨å…¨ã€‚æ‰€æœ‰çš„æ–¹æ³•é›†åˆéƒ½ä¾èµ–äºè¿è¡Œæ—¶äº‹ä»¶ï¼Œåœ¨ä»¥åç±»çš„å®ç°ä¸­ä½œä¸ºæ–°çš„æ–¹æ³•å‘ç”Ÿæ”¹å˜ã€‚&lt;/p&gt;

&lt;p&gt;ç¬¬äºŒæ¬¡æœºä¼šè¢«&lt;code&gt;forwardInvocation:&lt;/code&gt;æ–¹æ³•æ‰€æä¾›ï¼Œè¿™æ˜¯ä¸€ç§æ¯”è¾ƒç‰¹æ®Šçš„è§£å†³æ–¹å¼ï¼Œå®ƒæ˜¯åŠ¨æ€çš„è€Œä¸æ˜¯é™æ€çš„ã€‚å®ƒå·¥ä½œèµ·æ¥å°±åƒæ˜¯ï¼šå½“ä¸€ä¸ªå¯¹è±¡ä¸èƒ½å“åº”ä¸€ä¸ªæ¶ˆæ¯ï¼Œå› ä¸ºåœ¨æ¶ˆæ¯ä¸­æ²¡æœ‰selectoråŒ¹é…è¿™ä¸ªæ–¹æ³•ã€‚runtimeä¼šç”¨&lt;code&gt;forwardInvocation:&lt;/code&gt;æ¶ˆæ¯æ¥é€šçŸ¥å¯¹è±¡ã€‚æ¯ä¸ªå¯¹è±¡éƒ½ä»NSObjecté‡Œç»§æ‰¿äº†&lt;code&gt;forwardInvocation:&lt;/code&gt;æ–¹æ³•ã€‚ä½†æ˜¯NSObjectåªæ˜¯ç®€å•çš„è°ƒç”¨&lt;code&gt;doesNotRecognizeSelector:&lt;/code&gt;ã€‚é€šè¿‡é‡å†™NSObjectç‰ˆæœ¬çš„å®ç°ï¼Œä½ å¯ä»¥åˆ©ç”¨è¿™æ¬¡æœºä¼šï¼Œé€šè¿‡&lt;code&gt;forwardInvocation:&lt;/code&gt;æ¶ˆæ¯æä¾›ä¸€ä¸ªæ–¹æ³•è½¬å‘åˆ°å¦ä¸€ä¸ªç±»ä¸­ã€‚
ä¸ºäº†è½¬å‘ä¸€ä¸ªæ¶ˆæ¯ï¼Œæ‰€æœ‰çš„&lt;code&gt;forwardInvocation:&lt;/code&gt;æ–¹æ³•å¿…é¡»åŒ…å«ä¸‹é¢çš„ä¸¤ä¸ªæ­¥éª¤:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ç¡®å®šæ¶ˆæ¯çš„å»å‘&lt;/li&gt;
&lt;li&gt;è½¬å‘çš„æ—¶å€™æºå¸¦åŸå§‹çš„å‚æ•°&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ¶ˆæ¯å¯ä»¥é€šè¿‡&lt;code&gt;invokeWithTarget:&lt;/code&gt;æ–¹æ³•è¢«å‘é€ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;- (void)forwardInvocation:(NSInvocation *)anInvocation
{
	if ([someOtherObject respondsToSelector:[anInvocation selector]])
		[aInvocation invokeWithTarget:someOtherObject];
	else
		[super forwardInvocation:anInvocation];
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¢«è½¬å‘çš„æ¶ˆæ¯çš„è¿”å›å€¼è¢«è¿”å›åˆ°åŸå§‹çš„senderã€‚æ‰€æœ‰è¿”å›å€¼çš„ç±»å‹åŒ…æ‹¬ï¼šidsã€structuresï¼ŒåŒç²¾åº¦æµ®ç‚¹æ•°ã€‚
å¯¹äºunrecognizedæ¶ˆæ¯ï¼Œ&lt;code&gt;forwardInvocation:&lt;/code&gt;æ–¹æ³•å°±åƒä¸€ä¸ªæ¶ˆæ¯è½¬å‘ä¸­å¿ƒï¼Œå°†messageåŒ…è£¹èµ·æ¥å‘é€åˆ°ä¸åŒçš„æ¥å—è€…ã€‚æˆ–è€…ä½œä¸ºä¸€ä¸ªä¸­è½¬ç«™ï¼Œå‘é€æ‰€æœ‰æ¶ˆæ¯åˆ°åŒæ ·çš„åœ°æ–¹ã€‚å®ƒå¯ä»¥è½¬å‘ä¸€ä¸ªæ¶ˆæ¯åˆ°å¦ä¸€ä¸ªã€‚&lt;code&gt;forwardInvocation:&lt;/code&gt;æ–¹æ³•å¯ä»¥å®šä½å‡ ä¸ªæ¶ˆæ¯æ¶ˆæ¯åˆ°å•ä¸€çš„responseã€‚&lt;code&gt;forwardInvocation:&lt;/code&gt;è¦åšçš„æ˜¯å‡†å¤‡å®ç°ã€‚ä½†æ˜¯ï¼Œè¿™æ¬¡æœºä¼šä¸ºè½¬å‘é“¾ä¸­çš„é“¾æ¥å¯¹è±¡æä¾›æ›´å¤šç¨‹åºè®¾è®¡çš„å¯èƒ½ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;&lt;code&gt;forwardInvocation:&lt;/code&gt;æ–¹æ³•å¼€å§‹å¤„ç†æ¶ˆæ¯ï¼Œåªæœ‰å®ƒä»¬ä¸èƒ½è°ƒç”¨åœ¨æ¥å—è€…ä¸­å·²ç»å­˜åœ¨çš„æ–¹æ³•æ—¶ã€‚æ¯”å¦‚ï¼Œä½ æƒ³è¦ä½ çš„å¯¹è±¡å»è½¬å‘&lt;code&gt;negotiate&lt;/code&gt;æ¶ˆæ¯åˆ°å¦ä¸€ä¸ªå¯¹è±¡ï¼Œä½†å¯¹è±¡å¹¶æ²¡æœ‰è‡ªå·±å¯¹è¯¥æ¶ˆæ¯çš„å®ç°ã€‚å¦‚æœæ˜¯è¿™æ ·ï¼Œæ¶ˆæ¯å°†æ°¸è¿œä¸ä¼šåˆ°è¾¾&lt;code&gt;forwardInvocation:&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&#34;forwarding-and-multiple-inheritance&#34;&gt;Forwarding and Multiple Inheritance&lt;/h3&gt;

&lt;p&gt;è½¬å‘å¯ä»¥æ¨¡ä»¿å¤šç»§æ‰¿ï¼Œå¯ä»¥å®ç°å¤šç»§æ‰¿çš„ä¸€äº›æ•ˆæœã€‚å¯¹è±¡é€šè¿‡è½¬å‘æ¥å“åº”æ¶ˆæ¯ï¼Œå°±åƒæ˜¯å€Ÿç”¨æˆ–è€…ç»§æ‰¿äº†å¦ä¸€ä¸ªç±»çš„æŸä¸ªæ–¹æ³•çš„å®ç°
&lt;img src=&#34;../../../forwarding.png&#34; alt=&#34;forwarding&#34; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒWarriorç±»çš„å®ä¾‹è½¬å‘ä¸€ä¸ª&lt;code&gt;negotiate&lt;/code&gt;æ¶ˆæ¯åˆ°Diplomatç±»çš„å®ä¾‹ã€‚Warriorå¯ä»¥åƒDiplomatä¸€æ ·è°ƒç”¨negotiateã€‚çœ‹èµ·æ¥å°±åƒå“åº”&lt;code&gt;negotiate&lt;/code&gt;æ–¹æ³•ã€‚
å¯¹è±¡è½¬å‘æ¶ˆæ¯ï¼Œè¿™æ ·â€œç»§æ‰¿â€çš„æ–¹æ³•æ¥è‡ªä¸¤ç§ç»§æ‰¿æ¶æ„é“¾ã€‚ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå®ƒå°±åƒWarriorçš„ç±»ç»§æ‰¿è‡ªDiplomat ï¼Œå°±åƒå­ç±»ç»§æ‰¿çˆ¶ç±»ä¸€æ ·ã€‚&lt;/p&gt;

&lt;p&gt;è½¬å‘æä¾›äº†å¾ˆå¤šç‰¹æ€§ï¼Œä¸€èˆ¬ä½ å¯ä»¥ç”¨å®ƒæ¥å®ç°å¤šç»§æ‰¿ã€‚ä½†æ˜¯ï¼Œè¿™å’Œå¤šç»§æ‰¿æœ‰ä¸¤ä¸ªå¾ˆå¤§ä¸åŒåœ°æ–¹ï¼šé¦–å…ˆï¼Œåœ¨ä¸€ä¸ªç±»ä¸­ï¼Œå¤šç»§æ‰¿ç»„åˆå‡ºä¸åŒçš„èƒ½åŠ›ã€‚å®ƒè¶‹å‘äºè¾ƒåºå¤§çš„å¤šæ¥å£å¯¹è±¡ã€‚å¦ä¸€æ–¹é¢ï¼Œç»§æ‰¿å¯ä»¥åŒºåˆ†ä¸åŒç§ç±»çš„æ–¹æ³•åˆ°ä¸åŒçš„å¯¹è±¡ã€‚&lt;/p&gt;

&lt;h3 id=&#34;forwarding-and-inheritance&#34;&gt;Forwarding and Inheritance&lt;/h3&gt;

&lt;p&gt;å°½ç®¡è½¬å‘å¯ä»¥æ¨¡ä»¿ç»§æ‰¿ï¼ŒNSObjectç±»ç»ä¸èƒ½æ··åˆè¿™ä¸¤ç§æ–¹å¼ã€‚åƒ&lt;code&gt;respondsToSelector:&lt;/code&gt;å’Œ&lt;code&gt;isKindOfClass:&lt;/code&gt;æ–¹æ³•ï¼Œåªèƒ½åœ¨ç»§æ‰¿é“¾ä¸­çœ‹åˆ°ï¼Œä¸èƒ½ç”¨äºæ¶ˆæ¯è½¬å‘é“¾ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªWarriorå¯¹è±¡è¢«æŸ¥è¯¢æ˜¯å¦å“åº”&lt;code&gt;negotiate&lt;/code&gt;æ¶ˆæ¯ï¼Œ&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;if([aWarrior respondsToSelector:@selector(negotiate)])
...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç­”æ¡ˆæ˜¯&lt;code&gt;NO&lt;/code&gt;ï¼Œåœ¨æŸç§æ„ä¹‰ä¸Šï¼Œå³ä½¿å®ƒèƒ½æ— é”™è¯¯çš„æ¥å—&lt;code&gt;negotiate&lt;/code&gt;æ¶ˆæ¯ï¼Œå¹¶ä¸”å“åº”å®ƒä»¬ï¼Œé€šè¿‡è½¬å‘å®ƒä»¬åˆ°Diplomatã€‚&lt;/p&gt;

&lt;p&gt;åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œ&lt;code&gt;NO&lt;/code&gt;æ˜¯æ­£ç¡®çš„ç­”æ¡ˆã€‚ä½†ä¹Ÿéœ€ä¸æ˜¯ã€‚å¦‚æœä½ ä½¿ç”¨è½¬å‘æ¥è®¾ç½®ä¸€ä¸ªæ›¿ä»£çš„objectæˆ–è€…æ‰©å±•ä¸€ä¸ªç±»çš„èƒ½åŠ›ï¼Œè½¬å‘æœºåˆ¶åº”è¯¥åƒç»§æ‰¿ä¸€æ ·é€æ˜ã€‚å¦‚æœä½ æƒ³è¦ä½ çš„å¯¹è±¡çš„è¡Œä¸ºå°±å¥½åƒçœŸæ­£æ˜¯é€šè¿‡ç»§æ‰¿æ¥å®ç°æ¶ˆæ¯è½¬å‘çš„ã€‚ä½ å°†éœ€è¦é‡æ–°å®ç°&lt;code&gt;respondsToSelector:&lt;/code&gt;å’Œ&lt;code&gt;isKindOfClass:&lt;/code&gt;åŒ…æ‹¬ä½ çš„è½¬å‘ç®—æ³•ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;- (BOOL)respondsToSelector:(SEL)aSelector
{
	if([super respondsToSelector:aSelector])
		return YESl
	else {
		/* Here,test whether the aSelector message can *
		 * be forwarded to another object and whether that *
		 * object can respond to it.Return YES if it can. */
	}
	return NO;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;é™¤äº†&lt;code&gt;respondsToSelector:&lt;/code&gt;å’Œ&lt;code&gt;isKindOfClass:&lt;/code&gt;,&lt;code&gt;instancesRespondToSelector:&lt;/code&gt;æ–¹æ³•åº”è¯¥åæ˜ è½¬å‘ç®—æ³•ã€‚å¦‚æœåè®®è¢«ä½¿ç”¨,&lt;code&gt;conformsToProtocol:&lt;/code&gt;æ–¹æ³•åº”è¯¥åŒæ ·è¢«æ·»åŠ åˆ°è¿™ä¸ªlistä¸­ã€‚ç±»ä¼¼çš„ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡è½¬å‘ä»»ä½•å®ƒæ¥å—çš„è¿œç¨‹æ¶ˆæ¯ï¼Œå®ƒåº”è¯¥æœ‰ä¸€ä¸ª&lt;code&gt;methodSignatureForSelector:&lt;/code&gt;æ–¹æ³•çš„å®ç°ï¼Œå®ƒèƒ½è¿”å›æ–¹æ³•ç²¾ç¡®çš„æè¿°ã€‚æœ€ç»ˆå“åº”è½¬å‘çš„æ¶ˆæ¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡èƒ½å¤Ÿè½¬å‘ä¸€ä¸ªæ¶ˆæ¯åˆ°å®ƒçš„æ›¿ä»£è€…ï¼Œä½ åº”è¯¥å‘ä¸‹é¢è¿™æ ·å®ç°&lt;code&gt;methodSignatureForSelector:&lt;/code&gt;æ–¹æ³•ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;- (NSMethodSignature *)methodSignatureForSelector:(SEL)selector
{
	NSMethodSignature *signature = [super methodSignatureForSelector:selector];
	if(!signature){
		signature = [surrogate methodSignatureForSelector:selector];
	}
	return signature;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½ å¯èƒ½è€ƒè™‘æŠŠè½¬å‘ç®—æ³•æ”¾åœ¨ç§æœ‰ä»£ç çš„æŸä¸ªåœ°æ–¹å¹¶ä¸”æ‹¥æœ‰æ‰€æœ‰è¿™äº›æ–¹æ³•,&lt;code&gt;forwardInvocation:&lt;/code&gt;åŒ…æ‹¬è°ƒç”¨å®ƒã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;è¿™æ˜¯ä¸€ä¸ªé«˜çº§æŠ€å·§ï¼Œä»…ä»…é€‚ç”¨äºæ²¡æœ‰å…¶ä»–è§£å†³æ–¹æ¡ˆçš„æ—¶å€™ã€‚è¿™ä¹Ÿä¸å°†ä½œä¸ºç»§æ‰¿çš„æ›¿ä»£ã€‚å¦‚æœä½ å¿…é¡»ä½¿ç”¨è¿™ä¸ªæŠ€æœ¯ï¼Œç¡®ä¿ä½ èƒ½å®Œå…¨ç†è§£åœ¨è¿›è¡Œè½¬å‘å’Œè¦è½¬å‘åˆ°çš„ç›®æ ‡ç±»çš„è¡Œä¸ºã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;åœ¨è¿™éƒ¨åˆ†æåˆ°çš„æ–¹æ³•è¢«æè¿°åœ¨&lt;code&gt;NSObject&lt;/code&gt;ç±»çš„è¯´æ˜ä¸­ã€‚æ›´å¤šçš„å…³äº&lt;code&gt;invokeWithTarget:&lt;/code&gt;è¯·çœ‹&lt;a href=&#34;https://developer.apple.com/documentation/foundation/nsinvocation&#34;&gt;NSInvocation&lt;/a&gt;ç±»çš„è¯´æ˜ã€‚&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>Runtime (äºŒ)  åŠ¨æ€æ–¹æ³•å®ç°</title>
      <link>https://linkrober.github.io/bookshelf/2017/10/runtime-%E4%BA%8C--%E5%8A%A8%E6%80%81%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0/</link>
      <pubDate>Mon, 09 Oct 2017 18:06:28 +0800</pubDate>
      
      <guid>https://linkrober.github.io/bookshelf/2017/10/runtime-%E4%BA%8C--%E5%8A%A8%E6%80%81%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0/</guid>
      <description>&lt;h3 id=&#34;dynamic-method-resolution&#34;&gt;Dynamic Method Resolution&lt;/h3&gt;

&lt;p&gt;æœ‰çš„æ—¶å€™ï¼Œä½ å¯èƒ½æƒ³è¦æä¾›æ–¹æ³•çš„åŠ¨æ€å®ç°ã€‚ä¾‹å¦‚ï¼ŒObject-C å±æ€§ç‰¹å¾åŒ…å«äº†&lt;code&gt;@dynamic&lt;/code&gt;
&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;@dynamic propertyName;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™é‡Œæ˜¯å‘Šè¯‰ç¼–è¯‘å™¨å±æ€§ç›¸å…³æ–¹æ³•çš„å®ç°ä¼šè¢«åŠ¨æ€çš„æä¾›ã€‚&lt;/p&gt;

&lt;p&gt;ä½ å¯ä»¥å®ç°&lt;code&gt;resolveInstanceMethod:&lt;/code&gt;å’Œ&lt;code&gt;resolveClassMethod:&lt;/code&gt;ä¸ºå„ä¸ªå®ä¾‹å’Œç±»åŠ¨æ€çš„æä¾›ä¸€ä¸ªselectorã€‚&lt;/p&gt;

&lt;p&gt;ä¸€ä¸ªObject-Cæ–¹æ³•æ˜¯ä¸€ä¸ªç®€å•çš„Cå‡½æ•°ï¼Œå®ƒæœ€å°‘æŒæœ‰ä¸¤ä¸ªå‚æ•°&amp;ndash;&lt;code&gt;self&lt;/code&gt;å’Œ&lt;code&gt;_cmd&lt;/code&gt;ã€‚ä½ å¯ä»¥ä½¿ç”¨&lt;code&gt;class_addMethod&lt;/code&gt;æ·»åŠ ä¸€ä¸ªå‡½æ•°åˆ°ç±»ä¸­ä½œä¸ºæ–¹æ³•ï¼Œå‡½æ•°å¤§æ¦‚åƒè¿™æ ·ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;void dynamicMethodIMP(id self,SEL _cmd) {
	//implementation...
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½ å¯ä»¥åŠ¨æ€çš„æŠŠå®ƒæ·»åŠ åˆ°ç±»ä¸­ä½œä¸ºä¸€ä¸ªæ–¹æ³•ï¼Œé€šè¿‡ä½¿ç”¨&lt;code&gt;resolveInstanceMethod:&lt;/code&gt;è°ƒç”¨&lt;code&gt;resolveThisMethodDynamically&lt;/code&gt;æ–¹æ³•ï¼Œåƒè¿™æ ·ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;@implementation MyClass
+ (BOOL)resolveInstanceMethod:(SEL)aSEL
{
	if(aSEL == @selector(resolveThisMethodDynamically)){
		class_addMethod([self class],aSEL,(IMP)dynamicMethodIMP,&amp;quot;v@:&amp;quot;);
		return YES;
	}
	return [super resolveInstanceMethod:aSEL];
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;@end
ä¸€ä¸ªç±»åœ¨æ¶ˆæ¯è½¬å‘æœºåˆ¶å¼€å§‹å‰æœ‰æœºä¼šåŠ¨æ€çš„æ·»åŠ ä¸€ä¸ªæ–¹æ³•ã€‚å¦‚æœ&lt;code&gt;respondsToSelector:&lt;/code&gt;æˆ–è€…&lt;code&gt;instancesRespondToSelector:&lt;/code&gt;æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼ŒåŠ¨æ€çš„æ–¹æ³•æ¥å—è€…é¦–å…ˆä¼šè¢«ç»™äºˆä¸€æ¬¡æœºä¼šï¼Œä¸ºselectoræä¾›ä¸€ä¸ª&lt;code&gt;IMP&lt;/code&gt;ã€‚å¦‚æœä½ å®ç°äº†&lt;code&gt;resolveInstanceMethod:&lt;/code&gt;æ–¹æ³•ï¼Œä½†æ˜¯æƒ³è¦æŒ‡å®šçš„selectorï¼Œé€šè¿‡è½¬å‘æœºåˆ¶è¢«è½¬å‘ï¼Œä½ è¦return &lt;code&gt;NO&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;h3 id=&#34;dynamic-loading&#34;&gt;Dynamic Loading&lt;/h3&gt;

&lt;p&gt;ä¸€ä¸ªObject-Cç¨‹åºå¯ä»¥åœ¨è¿è¡Œçš„æ—¶å€™åŠ è½½å’Œé“¾æ¥æ–°çš„ç±»ã€‚åŠ¨æ€åŠ è½½å¯ä»¥ç”¨æ¥åšå¾ˆå¤šä¸åŒçš„äº‹æƒ…ã€‚ä¾‹å¦‚ï¼Œç³»ç»Ÿåå¥½ä¸­çš„ä¸åŒæ¨¡å—æ˜¯é€šè¿‡åŠ¨æ€åŠ è½½çš„æ–¹å¼å®ç°çš„ã€‚
åœ¨Cocoaçš„ç¯å¢ƒä¸­ï¼ŒåŠ¨æ€åŠ è½½ä¸€èˆ¬è¢«ç”¨æ¥è®©åº”ç”¨æ›´å…·çµæ´»æ€§ã€‚åœ¨ç¼–å†™è‡ªå·±çš„æ¨¡å—çš„æ—¶å€™ï¼Œå¯ä»¥åœ¨runtimeçš„æ—¶å€™è¢«åŠ è½½ã€‚æ›´å¤šçš„æ˜¯ç”¨æ¥å£åŠ è½½è‡ªå®šä¹‰çš„æ¨¡ç‰ˆã€‚OS Xçš„ç³»ç»Ÿè®¾ç½®ä¸­åŠ è½½è‡ªå®šä¹‰çš„åå¥½æ¨¡å—ã€‚ä½ åº”ç”¨ç¨‹åºçš„æ¨¡å—æ‰©å±•ç­‰ã€‚
å› æ­¤åœ¨Mach-Oæ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªruntimeå‡½æ•°æ‰§è¡ŒObject-Cçš„åŠ¨æ€åŠ è½½(objc_loadModules,å®šä¹‰åœ¨objc/objc-load.hä¸­)ï¼ŒCocoaçš„&lt;code&gt;NSBundle&lt;/code&gt;ç±»ä¸ºåŠ¨æ€åŠ è½½æä¾›äº†ä¸€ä¸ªæ›´æ–¹ä¾¿çš„æ¥å£&amp;ndash;é¢å‘å¯¹è±¡çš„èšåˆç›¸å…³æœåŠ¡çš„æ¥å£ã€‚&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>Runtime (ä¸€) æ¶ˆæ¯</title>
      <link>https://linkrober.github.io/bookshelf/2017/09/runtime-%E4%B8%80-%E6%B6%88%E6%81%AF/</link>
      <pubDate>Fri, 29 Sep 2017 00:00:00 +0000</pubDate>
      
      <guid>https://linkrober.github.io/bookshelf/2017/09/runtime-%E4%B8%80-%E6%B6%88%E6%81%AF/</guid>
      <description>&lt;h3 id=&#34;message&#34;&gt;Message&lt;/h3&gt;

&lt;p&gt;è¿™ç¯‡æ–‡ç« æè¿°äº†æ¶ˆæ¯å¦‚ä½•é€šè¿‡ä½¿ç”¨&lt;code&gt;objc_msgSend&lt;/code&gt;å‘é€ï¼Œå¦‚ä½•é€šè¿‡æ–¹æ³•åç§°æ‰¾åˆ°å¯¹åº”æ–¹æ³•çš„reference&lt;/p&gt;

&lt;h4 id=&#34;the-objc-msgsend-function&#34;&gt;The objc_msgSend Function&lt;/h4&gt;

&lt;p&gt;åœ¨Object-Cä¸­ï¼Œå‘é€çš„æ¶ˆæ¯ç›´åˆ°è¿è¡Œæ—¶æ‰ç»‘å®šåˆ°æ­£çœŸçš„æ–¹å¼å®ç°ã€‚
&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[receiver message]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;objc_msgSend&lt;/code&gt;æ˜¯çœŸæ­£è°ƒç”¨æ¶ˆæ¯çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æŒæœ‰æ¶ˆæ¯çš„æ¥å—è€…å’Œæ–¹æ³•çš„åç§°ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;objc_msgSend(receiver,selector)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä»»ä½•å…¶ä»–çš„å‚æ•°ä¹Ÿæ˜¯é€šè¿‡è¿™ä¸ªæ–¹æ³•ä¼ å…¥ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;objc_msgSend(receiver,selector,arg1,arg2,...)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™ä¸ªæ–¹æ³•ä¼šåšä¸€äº›å¿…è¦çš„äº‹æƒ…æ¥è¿›è¡ŒåŠ¨æ€ç»‘å®šï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;é¦–å…ˆæ‰¾åˆ°æ–¹æ³•çš„å®ç°å³selectorçš„å¼•ç”¨ã€‚å› ä¸ºåœ¨ä¸åŒçš„ç±»ä¸­éƒ½å¯ä»¥å®ç°ç›¸åŒæ–¹æ³•åçš„æ–¹æ³•ï¼Œæ‰€ä»¥é€šè¿‡æ–¹æ³•çš„å®ç°æ‰¾åˆ°çœŸæ­£çš„receiverçš„classã€‚&lt;/li&gt;
&lt;li&gt;ç„¶åä¼ å…¥è¯¥æ–¹æ³•æŒ‡å®šçš„receiverå’Œå‚æ•°ã€‚&lt;/li&gt;
&lt;li&gt;æœ€åå°†å®ç°çš„è¿”å›å€¼ä½œä¸ºå®ƒè‡ªå·±çš„è¿”å›å€¼ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
&lt;p&gt;Note:ç¼–è¯‘å™¨ç”Ÿæˆè°ƒç”¨æ¶ˆæ¯çš„æ–¹æ³•ï¼Œåœ¨æ—¥å¸¸å¼€å‘ä¸­æ°¸è¿œä¸è¦åœ¨ä½ å†™çš„ä»£ç ä¸­ç›´æ¥è°ƒç”¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;åœ¨æ¶æ„ä¸­æ¶ˆæ¯ä¼ é€’çš„å…³é”®åœ¨äºç¼–è¯‘å™¨ç¼–è¯‘æ¯ä¸ªclasså’Œobjectã€‚æ¯ä¸ªclassçš„ç»“æ„ä¸­åŒ…å«ä¸¤ä¸ªé‡è¦å…ƒç´ ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æŒ‡å‘çˆ¶ç±»çš„æŒ‡é’ˆ&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªç±»çš„æ´¾å‘è¡¨ ï¼Œè¿™ä¸ªè¡¨è®°å½•äº†æ–¹æ³•çš„selectorå’Œå®šä¹‰è¯¥æ–¹æ³•çš„åœ°å€ã€‚&lt;code&gt;setOrigin::&lt;/code&gt;æ–¹æ³•å’Œå…¶å¯¹åº”çš„åœ°å€ï¼›&lt;code&gt;display&lt;/code&gt;å’Œå…¶å¯¹åº”çš„åœ°å€ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å½“ä¸€ä¸ªæ–°çš„å¯¹è±¡è¢«åˆ›å»ºï¼Œå†…å­˜è¢«åˆ†é…ï¼Œå®ä¾‹å˜é‡è¢«åˆå§‹åŒ–ã€‚ç¬¬ä¸€ä»¶äº‹å°±æ˜¯å¯¹è±¡å˜é‡æŒ‡é’ˆæŒ‡å‘å®ƒçš„ç±»ç»“æ„ã€‚è¿™ä¸ªæŒ‡é’ˆä¸€èˆ¬è¢«ç§°ä½œ&lt;code&gt;isa&lt;/code&gt;,ç»™äºˆå¯¹è±¡è®¿é—®ç±»çš„æƒåˆ©ã€‚æ‰€æœ‰çš„ç±»éƒ½æ˜¯ä»è¿™ä¸ªç±»ç»§æ‰¿è€Œæ¥ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Note:å°½ç®¡è¿™æ˜¯ocä¸å¤ªä¸¥è°¨çš„ä¸€éƒ¨åˆ†(å®¹æ˜“è¢«hook)ï¼Œä½†æ˜¯è¿™ä¹Ÿæ˜¯ocå¯¹è±¡åœ¨è¿è¡Œæ—¶ä¸å¯ç¼ºå°‘çš„ä¸€éƒ¨åˆ†ã€‚ä¸€ä¸ªå¯¹è±¡éœ€è¦ä¸€ä¸ªå’Œå®ƒç­‰æ•ˆçš„ç»“æ„ä½“æ¥ä»£è¡¨ï¼Œåœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥ç”¨å®ƒæ¥å®šä¹‰ã€‚å¦‚æœä½ æ›¾ç»éœ€è¦åˆ›å»ºä¸€ä¸ªæ ¹å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡è‡ªåŠ¨ç»§æ‰¿&lt;code&gt;NSObject&lt;/code&gt;æˆ–è€…&lt;code&gt;NSProxy&lt;/code&gt;éƒ½ä¼šæºå¸¦ä¸€ä¸ª&lt;code&gt;isa&lt;/code&gt;å˜é‡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ç±»çš„è¿™äº›å…ƒç´ å’Œå¯¹è±¡ç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;../../../messaging1.png&#34; alt=&#34;messaging1&#34; /&gt;&lt;/p&gt;

&lt;p&gt;å½“æ¶ˆæ¯è¢«å‘é€åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œæ¶ˆæ¯æ–¹æ³•è·Ÿéšå¯¹è±¡çš„&lt;code&gt;isa&lt;/code&gt;æŒ‡å‘ç±»ç»“æ„ï¼Œåœ¨æ´¾å‘è¡¨ä¸­ä¸€ç›´å‘ä¸Šå¯»æ‰¾å¯¹åº”çš„æ–¹æ³•ã€‚å¦‚æœä½ ä¸èƒ½åœ¨è¿™é‡Œæ‰¾åˆ°ä½ éœ€è¦çš„æ–¹æ³•ï¼Œ&lt;code&gt;objc_msgSend&lt;/code&gt;æ–¹æ³•ä¼šç»§ç»­å‘ä¸Šåœ¨çˆ¶ç±»çš„æ´¾å‘è¡¨é‡Œé¢å°è¯•å¯»æ‰¾è¯¥æ–¹æ³•ã€‚è¿˜æ˜¯å¤±è´¥å°±ä¼šä¸€ç›´å¯»æ‰¾ç›´åˆ°åˆ°è¾¾&lt;code&gt;NSObject&lt;/code&gt;ç±»ï¼Œä¸€æ—¦æ‰¾åˆ°selectorï¼Œå°±ä¼šä»è¡¨ä¸­çš„å…¥å£è°ƒç”¨è¯¥æ–¹æ³•ï¼ŒæŠŠå®ƒä¼ é€’åˆ°å¯¹è±¡çš„æ•°æ®ç»“æ„ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;è¿™ç§æ–¹å¼çš„æ–¹æ³•è°ƒç”¨æ˜¯åœ¨è¿è¡Œæ—¶è¿›è¡Œçš„ã€‚åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸“ä¸šæœ¯è¯­ä¸­ï¼Œæˆ‘ä»¬ç§°å®ƒä¸ºâ€”&lt;strong&gt;åŠ¨æ€æ¶ˆæ¯ç»‘å®š&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä¸ºäº†åŠ é€Ÿæ¶ˆæ¯å¤„ç†çš„è¿‡ç¨‹ï¼Œè¿è¡Œæ—¶ç³»ç»Ÿä¼šç¼“å­˜æ›¾ç»ä½¿ç”¨è¿‡çš„selectorså’Œå¯¹åº”çš„æ–¹æ³•åœ°å€ã€‚æ¯ä¸ªç±»æ˜¯è¢«åˆ†å¼€ç¼“å­˜çš„ã€‚å’Œåœ¨ç±»ä¸­å®šä¹‰çš„æ–¹æ³•ä¸€æ ·ï¼Œå®ƒä¹ŸåŒ…å«ç»§æ‰¿æ–¹æ³•çš„selectorã€‚åœ¨æŸ¥æ‰¾æ´¾å‘è¡¨ä¹‹å‰ï¼Œæ¶ˆæ¯è·¯å¾„ä¼šç¬¬ä¸€ä¸ªä¼šæ£€æŸ¥æ¥å—è€…ç±»çš„ç¼“å­˜.å¦‚æœæ–¹æ³•çš„selectoråœ¨ç¼“å­˜ä¸­ï¼Œæ¶ˆæ¯åªæ¯”æ–¹æ³•è°ƒç”¨æ…¢ä¸€ç‚¹ç‚¹ã€‚ä¸€æ—¦ç¨‹åºè¿è¡Œäº†è¶³å¤Ÿé•¿çš„æ—¶é—´å”¤é†’ç¼“å­˜ï¼Œå‡ ä¹å‘é€çš„æ‰€æœ‰æ¶ˆæ¯éƒ½èƒ½åœ¨ç¼“å­˜ä¸­æ‰¾åˆ°ã€‚åœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œç¼“å­˜åŠ¨æ€çš„å¢åŠ æ¥å®¹çº³æ–°çš„æ–¹æ³•ã€‚&lt;/p&gt;

&lt;h4 id=&#34;using-hidden-arguments&#34;&gt;Using Hidden Arguments&lt;/h4&gt;

&lt;p&gt;å½“&lt;code&gt;objc_msgSend&lt;/code&gt;å¯»æ‰¾å®ç°æ–¹æ³•çš„è¿‡ç¨‹ï¼Œå®ƒè°ƒç”¨æ–¹æ³•å¹¶ä¼ é€’æ‰€æœ‰çš„å‚æ•°ã€‚åŒæ—¶å®ƒä¹Ÿä¸ºè¿™ä¸ªç¨‹åºä¼ é€’äº†ä¸¤ä¸ªéšè—çš„å‚æ•°ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æ¥å—è€…å¯¹è±¡&lt;/li&gt;
&lt;li&gt;æ–¹æ³•çš„selector&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è¿™äº›å‚æ•°ç»™äºˆæ¯ä¸ªæ–¹æ³•çš„å®ç°æ˜ç¡®çš„ä¿¡æ¯ã€‚å› ä¸ºè¿™ä¸¤ä¸ªå‚æ•°çš„éšè—ä¸èƒ½è¡¨ç°åœ¨ç¼–ç ä¸­ï¼Œä¸€èˆ¬æ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™è¢«æ’å…¥åˆ°å…·ä½“çš„å®ç°ã€‚&lt;/p&gt;

&lt;p&gt;å°½ç®¡è¿™äº›å‚æ•°æ²¡æœ‰è¢«æ˜ç¡®çš„å£°æ˜ï¼Œæºç ä»ç„¶å¯ä»¥å¼•ç”¨åˆ°å®ƒä»¬(å°±åƒå¯ä»¥å¼•ç”¨å¯¹è±¡çš„å®ä¾‹å˜é‡)ã€‚æ–¹æ³•é€šè¿‡&lt;code&gt;self&lt;/code&gt;å¼•ç”¨æ¥å—è€…å¯¹è±¡ï¼Œé€šè¿‡&lt;code&gt;_cmd&lt;/code&gt;ä»£è¡¨selectorã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œ&lt;code&gt;_cmd&lt;/code&gt;æŒ‡å‘&lt;code&gt;strange&lt;/code&gt;æ–¹æ³•çš„selectorï¼Œè¿™ä¸ªå¯¹è±¡çš„&lt;code&gt;self&lt;/code&gt;æ¥å—&lt;code&gt;strange&lt;/code&gt;æ¶ˆæ¯ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;- strange
{
	id target = getTheReceiver();
	SEL method = getTheMethod();

	if(target == self || method == _cmd)
		return nil;
	return [target performSelector:method];
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;getting-a-method-address&#34;&gt;Getting a Method Address&lt;/h4&gt;

&lt;p&gt;é¿å…åŠ¨æ€ç»‘å®šçš„å”¯ä¸€åŠæ³•ï¼Œå°±æ˜¯æ‹¿åˆ°æ–¹æ³•çš„åœ°å€ç›´æ¥è°ƒç”¨ï¼Œå°±åƒè°ƒç”¨ä¸€ä¸ªæ–¹æ³•ä¸€æ ·ã€‚è¿™åªé€‚åˆåœ¨ä¸€äº›å°‘æœ‰æƒ…å†µä¸‹ï¼šå½“ä¸€ä¸ªå…·ä½“çš„æ–¹æ³•éœ€è¦è¢«å¤šæ¬¡æˆåŠŸçš„æ‰§è¡Œï¼Œä½ æƒ³è¦åœ¨æ¯æ¬¡æ–¹æ³•æ‰§è¡Œçš„æ—¶å€™é¿å…æ¶ˆæ¯å¸¦æ¥çš„å¼€é”€ã€‚&lt;/p&gt;

&lt;p&gt;å®šä¹‰åœ¨&lt;code&gt;NSObject&lt;/code&gt;ç±»ä¸­çš„æ–¹æ³•&lt;code&gt;methodForSelector:&lt;/code&gt;ä½ å¯ä»¥è·å¾—ä¸€ä¸ªæŒ‡å‘æ–¹æ³•å…·ä½“å®ç°çš„æŒ‡é’ˆï¼Œç„¶åä½¿ç”¨æŒ‡é’ˆè°ƒç”¨ç¨‹åºã€‚&lt;code&gt;methodForSelector:&lt;/code&gt;æ–¹æ³•è¿”å›çš„æŒ‡é’ˆä¸€å®šè¦å°å¿ƒçš„åŒ…è£¹æ¥æŒ‡å‘ä¸€ä¸ªé€‚å½“çš„å‡½æ•°ç±»å‹ã€‚è¿”å›å€¼å’Œè¾“å…¥å‚æ•°éƒ½éœ€è¦åŒ…å«åœ¨é‡Œé¢ã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†&lt;code&gt;setFilled:&lt;/code&gt;æ–¹æ³•è°ƒç”¨çš„å®ç°è¿‡ç¨‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;void (*setter)(id,SEL,BOOL);
int i;
setter = (void (*)(id,SEL,BOOL))[target methodForSelector:@selector(setFilled:)];
for(i = 0;i &amp;lt; 100;i++){
	setter(targetList[i],@selector(setFilled:),YES);
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;é¦–å…ˆ&lt;code&gt;self&lt;/code&gt;å’Œ&lt;code&gt;_cmd&lt;/code&gt;è¢«ä¼ é€’åˆ°å…·ä½“çš„å®ç°ï¼Œåœ¨ä¸¤ä¸ªå‚æ•°åœ¨æ–¹æ³•ä¸­é€šè¿‡è¯­æ³•çš„æ–¹å¼è¢«éšè—ï¼Œä½†æ˜¯å½“è¿™äº›å‚æ•°åœ¨è¢«ä½œä¸ºä¸€ä¸ªfuncationè¢«è°ƒç”¨çš„æ—¶å€™å¿…é¡»è¦æ˜ç¡®ã€‚
ä½¿ç”¨&lt;code&gt;methodForSelector:&lt;/code&gt;æ¥é¿å…åŠ¨æ€ç»‘å®šå¯ä»¥èŠ‚çœå¤§éƒ¨åˆ†æ—¶é—´ã€‚ä½†æ˜¯å¦‚æœåŒä¸€ä¸ªæ¶ˆæ¯è¢«å¤šæ¬¡è°ƒç”¨ï¼ŒåŠ¨æ€ç»‘å®šçš„ç¼“å­˜æœºåˆ¶å¯èƒ½æ›´ä¼˜é›…ç‚¹ï¼Œå› ä¸ºä¸Šé¢çš„&lt;code&gt;for&lt;/code&gt;å¾ªç¯ä¼šéå†æ‰€æœ‰tartetã€‚
è®°ä½ï¼Œ&lt;code&gt;methodForSelector:&lt;/code&gt;æ˜¯Cocoaçš„è¿è¡Œæ—¶ç³»ç»Ÿæä¾›çš„ï¼Œå®ƒä¸æ˜¯OCè¯­è¨€è‡ªå·±çš„ç‰¹æ€§ã€‚&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>Run Loops (äºŒ)</title>
      <link>https://linkrober.github.io/bookshelf/2017/09/run-loops-%E4%BA%8C/</link>
      <pubDate>Tue, 26 Sep 2017 00:00:00 +0000</pubDate>
      
      <guid>https://linkrober.github.io/bookshelf/2017/09/run-loops-%E4%BA%8C/</guid>
      <description>&lt;h3 id=&#34;when-would-you-use-a-run-loop&#34;&gt;When Would You Use a Run Loop?&lt;/h3&gt;

&lt;p&gt;ä½ å”¯ä¸€è¦ä½¿ç”¨run loopï¼Œå°±æ˜¯å½“ä½ è¦åœ¨applicationä¸­åˆ›å»ºçº¿ç¨‹çš„æ—¶å€™ã€‚ä½ Applicationçš„ä¸»çº¿ç¨‹æ˜¯æ¶æ„å¾ˆé‡è¦çš„ä¸€éƒ¨åˆ†ã€‚æ‰€ä»¥ï¼ŒiOSç³»ç»Ÿä¸ºappçš„æä¾›äº†&lt;i&gt;runloop&lt;/i&gt;ä»£ç ï¼Œå¹¶è‡ªåŠ¨å¼€å§‹ã€‚åœ¨iOSä¸­è¿è¡ŒMain loopä½œä¸ºappå¯åŠ¨æ­¥éª¤çš„ä¸€éƒ¨åˆ†ã€‚
&lt;/p&gt;

&lt;p&gt;å¯¹äºå…¶ä»–çš„çº¿ç¨‹ï¼Œä½ éœ€è¦è€ƒè™‘æ˜¯å¦å¿…é¡»è¦ä½¿ç”¨&lt;i&gt;run loop&lt;/i&gt;ã€‚å¦‚æœæœ‰éœ€è¦ï¼Œé…ç½®å¹¶è‡ªå·±å¯åŠ¨å®ƒã€‚ä½ ä¸éœ€è¦åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­éƒ½å¯ç”¨run loopã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œä¸€äº›å¾ˆé•¿æ—¶é—´çš„è¿è¡Œå’Œå·²ç»å‡†å¤‡å¥½çš„ä»»åŠ¡ï¼Œä½ å¯èƒ½è¦é¿å…ä½¿ç”¨å®ƒã€‚Run loopçš„ç›®çš„ä¸»è¦æ˜¯ç”¨æ¥è§£å†³çº¿ç¨‹é—´çš„é€šä¿¡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æ‰“ç®—åšä¸‹é¢çš„äº‹æƒ…ï¼Œä½ éœ€è¦å¼€å¯ä¸€ä¸ªrun loopã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨portæˆ–è€…è‡ªå®šä¹‰input sourceæ¥å’Œå…¶ä»–çº¿ç¨‹é€šè®¯&lt;/li&gt;
&lt;li&gt;åœ¨çº¿ç¨‹ä¸­ä½¿ç”¨timer&lt;/li&gt;
&lt;li&gt;åœ¨Cocoa applicationä½¿ç”¨&lt;code&gt;performSelectorâ€¦&lt;/code&gt;æ–¹æ³•&lt;/li&gt;
&lt;li&gt;ç»´æŒçº¿ç¨‹æ¥æ‰§è¡Œå‘¨æœŸæ€§çš„ä»»åŠ¡&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å¦‚æœä½ é€‰æ‹©ä½¿ç”¨run loopï¼Œé…ç½®å’Œè®¾ç½®å°±æ˜¯æ¥ä¸‹æ¥è¦åšçš„ã€‚çºµè§‚æ•´ä¸ªçº¿ç¨‹ç¼–ç è¿‡ç¨‹ï¼Œä½ åº”è¯¥æœ‰ä¸€ä¸ªæ˜ç¡®çš„è®¤è¯†åœ¨ä»€ä¹ˆæ—¶å€™é€€å‡ºçº¿ç¨‹ï¼Œè¿™æ¯”å¼ºåˆ¶é€€å‡ºå¥½å¾ˆå¤šã€‚å…³äºå¦‚ä½•é…ç½®å’Œé€€å‡ºrun loopçš„ä¿¡æ¯åœ¨è¿™&lt;a href=&#34;https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-SW5&#34;&gt;Using Run Loop Objects&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h3 id=&#34;using-run-loop-objects&#34;&gt;Using Run Loop Objects&lt;/h3&gt;

&lt;p&gt;&lt;i&gt;run loop&lt;/i&gt;å¯¹è±¡æä¾›äº†ä¸»è¦çš„æ¥å£æ¥æ·»åŠ input sourcesï¼Œtimersï¼Œrun-loop observersåˆ°&lt;i&gt;run loop&lt;/i&gt;ä¸­å†è¿è¡Œå®ƒã€‚æ¯ä¸ªçº¿ç¨‹æœ‰ä¸€ä¸ªå’Œå®ƒç›¸å…³çš„run loop objectã€‚åœ¨Cocoaä¸­ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯&lt;a href=&#34;https://developer.apple.com/documentation/foundation/runloop&#34;&gt;NSRunLoop&lt;/a&gt;çš„å®ä¾‹ã€‚åœ¨åº”ç”¨çš„åº•å±‚ï¼Œå®ƒæ˜¯&lt;a href=&#34;https://developer.apple.com/documentation/corefoundation/cfrunloop&#34;&gt;CFRunLoopRef&lt;/a&gt;ç±»çš„æŒ‡é’ˆã€‚&lt;/p&gt;

&lt;h3 id=&#34;getting-a-run-loop-object&#34;&gt;Getting a Run Loop Object&lt;/h3&gt;

&lt;p&gt;è·å–å½“å‰çº¿ç¨‹çš„runloopå¯¹è±¡ï¼Œä½ ä½¿ç”¨ä¸‹é¢çš„ä¸€ç§æ–¹å¼ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;åœ¨Cocoa Applicationä¸­ï¼Œä½¿ç”¨&lt;a href=&#34;https://developer.apple.com/documentation/foundation/runloop/1412291-current&#34;&gt;NSRunLoop&lt;/a&gt;çš„ç±»æ–¹æ³•&lt;a href=&#34;https://developer.apple.com/documentation/foundation/runloop&#34;&gt;currentRunLoop&lt;/a&gt;ï¼Œæ¥è·å–&lt;code&gt;NSRunLoop&lt;/code&gt;å¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨&lt;a href=&#34;https://developer.apple.com/documentation/corefoundation/1542428-cfrunloopgetcurrent&#34;&gt;CFRunLoopGetCurrent&lt;/a&gt;æ–¹æ³•ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å°½ç®¡å®ƒä»¬ä¸æ˜¯æ— ç¼æ¡¥æ¥çš„ç±»ï¼Œå½“éœ€è¦çš„æ—¶å€™ä½ å¯ä»¥ä»&lt;code&gt;NSRunLoop&lt;/code&gt;å¯¹è±¡è·å¾—ä¸€ä¸ª&lt;code&gt;CFRunLoopRef&lt;/code&gt;æŒ‡é’ˆã€‚&lt;code&gt;NSRunLoop&lt;/code&gt;ç±»å®šä¹‰äº†ä¸€ä¸ª&lt;a href=&#34;https://developer.apple.com/documentation/foundation/nsrunloop/1410140-getcfrunloop&#34;&gt;getCFRunLoop&lt;/a&gt;æ–¹æ³•ï¼Œå®ƒè¿”å›äº†ä¸€ä¸ª&lt;code&gt;CFRunLoopRef&lt;/code&gt;ç±»å‹ï¼Œè¿™ä½ å¯ä»¥ä¼ å…¥åˆ°Core Foundationä¸­ã€‚å› ä¸ºä¸¤ä¸ªå¯¹è±¡æŒ‡å‘åŒä¸€ä¸ªrun loopï¼Œéœ€è¦çš„æ—¶å€™ä½ å¯ä»¥æ··åˆä½¿ç”¨ã€‚&lt;/p&gt;

&lt;h3 id=&#34;configuring-the-run-loop&#34;&gt;Configuring the Run Loop&lt;/h3&gt;

&lt;p&gt;å½“ä½ åœ¨è‡ªå®šä¹‰çº¿ç¨‹ä¸­è·‘run loopçš„æ—¶å€™ï¼Œä½ è‡³å°‘æ·»åŠ ä¸€ä¸ªinput sourceæˆ–timeråˆ°run loopä¸­ï¼Œå¦‚æœä¸€ä¸ª*run loop*æ²¡æœ‰ä»»ä½•sourceæ¥ç›‘å¬ï¼Œå½“ä½ å°è¯•è¿è¡Œå®ƒçš„æ—¶å€™ï¼Œå®ƒä¼šç«‹å³é€€å‡ºã€‚å¦‚ä½•å‘run loopä¸­æ·»åŠ ä¸€ä¸ªsourceï¼Œè¯·çœ‹è¿™é‡Œ&lt;a href=&#34;https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-SW7&#34;&gt;Configuring Run Loop Sources&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;é™¤äº†è£…è½½sourcesï¼Œä½ ä¹Ÿå¯ä»¥è£…è½½run loop observersï¼Œä½¿ç”¨å®ƒä»¬æ¥ç›‘å¬run loopçš„æ‰§è¡Œæ­¥éª¤ã€‚ä¸ºäº†è£…è½½run loop observerï¼Œä½ åˆ›å»ºäº†ä¸€ä¸ª&lt;a href=&#34;https://developer.apple.com/documentation/corefoundation/cfrunloopobserver&#34;&gt;CFRunLoopObserverRef&lt;/a&gt;æŒ‡é’ˆï¼Œå¹¶ä¸”ä½¿ç”¨&lt;a href=&#34;https://developer.apple.com/documentation/corefoundation/1542504-cfrunloopaddobserver&#34;&gt;CFRunLoopAddObserver&lt;/a&gt;æ–¹æ³•å¹¶æŠŠå®ƒæ·»åŠ åˆ°ä½ çš„run loopä¸­ã€‚Run loop observerå¿…é¡»è¦ä½¿ç”¨Core Foundationæ¥åˆ›å»ºã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹é¢å±•ç¤ºäº†åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªrun loop observeråˆ°run loopä¸­çš„ä¸»è¦çš„ä»£ç éƒ¨åˆ†ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;- (void)threadMain
{
	//The application use garbage collection,so no autorelease pool is needed.
	NSRunLoop *myRunLoop = [NSRunLoop currentRunLoop];	
	//Create a run loop observer and attach it to the run loop.
	CFRunLoopObserverContent context = {0,self,NULL,NULL,NULL};
	CFRunLoopObserverRef observer = CFRunLoopObserverCreate(kCFAllocatorDefault,kCFRunLoopAllActivities,YES,0,&amp;amp;myRunLoopObserver,&amp;amp;context);
	if(observer)
	{
		CFRunLoopRef cfLoop = [myRunLoop getCFRunLoop];
		CFRunLoopAddObserver(cfLoop,observer,kCFRunLoopDefaultMode);		
	}	
	//Create and schedule the timer.
		[NSTimer scheduledTimerWithTimeInterval:0.1 target:self selector:@selector(doFireTimer:) userInfo:nil repeats:YES];
		NSInteger loopCount = 10;
	do 
	{
		//Run the run loop 10 times to let the timer fire
		[myRunLoop runUntilDate:[NSDate dateWithTimeIntervalSinceNow:1]];
		loopCount--;
	}
	while(loopCount);
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å½“ä¸ºä¸€ä¸ªæ´»è·ƒçš„çº¿ç¨‹é…ç½®run loopçš„æ—¶å€™ï¼Œè‡³å°‘æ·»åŠ ä¸€ä¸ªinput sourceåˆ°æ¥å—çš„æ¶ˆæ¯ã€‚å°½ç®¡ä½ èƒ½å¤Ÿåªéœ€è¦é€šè¿‡ä¸€ä¸ªtimeræ¥å¯åŠ¨run loopä¸­ï¼Œä½†æ˜¯ï¼Œä¸€æ—¦timerè§¦å‘ä¹‹åï¼Œå®ƒå°±ä¼šæ— æ•ˆçš„ï¼Œè¿™ä¼šå¼•èµ·run loopçš„é€€å‡ºã€‚ä¼ å…¥ä¸€ä¸ªrepeatçš„timerå¯ä»¥ä¿æŒrun loopè¿è¡Œå¾ˆé•¿ä¸€æ®µæ—¶é—´ã€‚ä½†æ˜¯å°†ä¼šå‘¨æœŸæ€§çš„è°ƒç”¨è§¦å‘çš„timeræ¥å”¤é†’ä½ çš„çº¿ç¨‹ã€‚è¿™æ˜¯ç»´æŒçº¿ç¨‹ä¸­&lt;i&gt;run loop&lt;/i&gt;çš„å¦ä¸€ç§æ–¹å¼ï¼Œä¸€ä¸ªinput sourceç­‰å¾…äº‹ä»¶çš„åˆ°è¾¾ï¼Œè®©ä½ çš„çº¿ç¨‹å¤„äºç¡çœ ä¸­ï¼Œç›´åˆ°å®ƒè¢«å”¤é†’ã€‚&lt;/p&gt;

&lt;h3 id=&#34;starting-the-run-loop&#34;&gt;Starting the Run Loop&lt;/h3&gt;

&lt;p&gt;ä¸€ä¸ªrun loopå¿…é¡»è£…è½½è‡³å°‘ä¸€ä¸ªinput sourceæˆ–è€…timeræ¥ã€‚å¦‚æœæ²¡æœ‰ï¼Œrun loopç«‹å³é€€å‡ºã€‚
ä¸‹é¢æœ‰å‡ ç§åŠæ³•å¼€å¯ä¸€ä¸ªrun loopã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æ— æ¡ä»¶çš„å¯åŠ¨run loop&lt;/li&gt;
&lt;li&gt;è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´å¯åŠ¨run loop&lt;/li&gt;
&lt;li&gt;é€šè¿‡ä¸€ç§ç‰¹æ®Šçš„æ¨¡å¼å¯åŠ¨run loop&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ— æ¡ä»¶çš„å¯åŠ¨&lt;i&gt;runloop&lt;/i&gt;æ˜¯æœ€ç®€å•çš„ï¼Œä½†æ˜¯è¿™ä¹Ÿæ˜¯æœ€ä¸æ¨èçš„ä¸€ç§æ–¹å¼ã€‚æ— æ¡ä»¶çš„å¯åŠ¨ä½ çš„runloopï¼ŒæŠŠçº¿ç¨‹ä½œä¸º&lt;i&gt;runloop&lt;/i&gt;çš„ä¸€ä¸ªå‚æ•°ã€‚è¿™ç§æ–¹å¼å¯¹runloopçš„æ§åˆ¶æƒå¾ˆå°ã€‚ä½ å¯ä»¥æ·»åŠ æˆ–ç§»é™¤input sourceå’Œtimersï¼Œå”¯ä¸€åœæ­¢&lt;i&gt;runloop&lt;/i&gt;çš„æ–¹å¼å°±æ˜¯killã€‚è¿™ç§å¯åŠ¨æ–¹å¼æ²¡æœ‰åŠæ³•åœ¨è‡ªå®šä¹‰modeã€‚&lt;/p&gt;

&lt;p&gt;é™¤äº†æ— æ¡ä»¶çš„å¯åŠ¨ä¸€ä¸ªrunloopï¼Œä½¿ç”¨time out valueæ¥å¼€å§‹ä¸€ä¸ª&lt;i&gt;runloop&lt;/i&gt;æ›´å¥½ã€‚å½“ä½ ä½¿ç”¨time out valueï¼Œrunloopè¿è¡Œç›´åˆ°äº‹ä»¶åˆ°è¾¾æˆ–è€…è¶…æ—¶ã€‚å¦‚æœäº‹ä»¶æŠµè¾¾ï¼Œäº‹ä»¶ä¼šè¢«æ´¾å‘åˆ°ä¸€ä¸ªhandleræ¥å¤„ç†ï¼Œç„¶årun loopé€€å‡ºã€‚ä½ çš„codeåˆèƒ½å¤Ÿé‡æ–°å¼€å§‹runloopå»å¤„ç†ä¸‹ä¸€ä¸ªäº‹ä»¶ã€‚å¦‚æœè¶…æ—¶ï¼Œä½ å¯ä»¥ç®€å•çš„é‡å¯runloopï¼Œæˆ–è€…åˆ©ç”¨è¿™æ®µæ—¶é—´åšä»»ä½•éœ€è¦çš„äº‹ã€‚&lt;/p&gt;

&lt;p&gt;é™¤äº†time out valueï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªæŒ‡å®šçš„modeæ¥è¿è¡Œrunloopã€‚Modeså’Œtimeout valueå¹¶ä¸æ˜¯äº’æ–¥çš„ã€‚å½“è¿è¡Œrunloopçš„æ—¶å€™ä¹Ÿå¯ä»¥åŒæ—¶ä½¿ç”¨å®ƒä»¬ã€‚Modesé™åˆ¶äº†sourceçš„typeã€‚è¯¦ç»†è¢«æè¿°åœ¨&lt;a href=&#34;https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-SW12&#34;&gt;Run Loop Modes&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹é¢çš„codeä¸»è¦éƒ¨åˆ†å±•ç¤ºäº†runloopçš„åŸºæœ¬ç»“æ„ã€‚æœ¬è´¨ä¸Šï¼Œä½ æ·»åŠ ä½ çš„input sourceå’Œtimeråˆ°runloopã€‚é‡å¤è°ƒç”¨å…¶ä¸­ä¸€ä¸ªroutineæ¥å¼€å§‹ä¸€ä¸ª&lt;i&gt;run loop&lt;/i&gt;ã€‚æ¯æ¬¡run loop routine è¿”å›çš„æ—¶ï¼Œä½ æ£€æŸ¥&lt;i&gt;run lop&lt;/i&gt;æ˜¯å¦æ»¡è¶³æŸäº›æ¡ä»¶å¯¼è‡´é€€å‡ºthreadã€‚ä¾‹å­ä¸­ä½¿ç”¨Core Foundationçš„run loop routinesï¼Œä»¥è‡³äºå®ƒèƒ½æ£€æŸ¥è¿”å›çš„ç»“æœå¹¶æ£€æµ‹run loopä¸ºä»€ä¹ˆé€€å‡ºã€‚ä½ ä¹Ÿèƒ½ä½¿ç”¨&lt;a href=&#34;https://developer.apple.com/documentation/foundation/runloop&#34;&gt;NSRunLoop&lt;/a&gt;çš„æ–¹æ³•ä»¥ä¸€ç§ç›¸ä¼¼çš„æ–¹å¼æ¥è¿è¡Œrunloopï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨Cocoaæ¡†æ¶ä¸­çš„NSRunLoopï¼Œå®ƒæ˜¯ä¸éœ€è¦æ£€æŸ¥return valueçš„ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;- (void)skeletonThreadMain {
	//Set up an autorelease pool here if not using garbage collection.
	BOOL done = NO;
	//Add your sources or timer to the run loop and do any other setup
	do
	{
		//Start the run loop but return after earch source is handled
		SInt32 result = CFRunLoopRunInMode(kCFRunLoopDefaultMode,10,YES)
		
		//If a source explicitly stopped the run loop,or if there no sources or timers,go head and exit.
		if ((result == kCFRunLoopRunStopped) || (result == kCFRunLoopRunFinished))
		done = YES;
		
		//Check for any other exit conditions here and set the done variable as needed
	}
	while(!done);
	//Clean up code here. Be sure to release any allocated autorelease pools.
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;é€’å½’è¿è¡Œrun loopä¹Ÿæ˜¯å¯èƒ½çš„ã€‚æ¢å¥è¯è¯´ï¼Œä½ èƒ½å¤Ÿè°ƒç”¨&lt;a href=&#34;https://developer.apple.com/documentation/corefoundation/1542011-cfrunlooprun&#34;&gt;CFRunLoopRun&lt;/a&gt;ã€&lt;a href=&#34;https://developer.apple.com/documentation/corefoundation/1541988-cfrunloopruninmode&#34;&gt;CFRunLoopRunInMode&lt;/a&gt;,ä»»ä½•&lt;code&gt;NSRunLoop&lt;/code&gt;çš„æ–¹æ³•ï¼Œä»input source æˆ–è€… timerçš„handler routineå¼€å§‹runloopã€‚å½“è¿™æ ·åšçš„æ—¶å€™ï¼Œä½ å¯ä»¥ä½¿ç”¨ä½ æƒ³è¦çš„modeæ¥è¿è¡Œå†…åµŒçš„runloopã€‚åŒ…æ‹¬è¢«outer run loopæ­£åœ¨ä½¿ç”¨çš„modeã€‚&lt;/p&gt;

&lt;h3 id=&#34;exiting-the-run-loop&#34;&gt;Exiting the Run Loop&lt;/h3&gt;

&lt;p&gt;æœ‰ä¸¤ç§åŠæ³•ä½¿runloopåœ¨å¤„ç†äº‹ä»¶ä¹‹å‰é€€å‡ºã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ä¸º&lt;i&gt;Runloop&lt;/i&gt;é…ç½®ä¸€ä¸ªtime outæ—¶é—´&lt;/li&gt;
&lt;li&gt;ä¸»åŠ¨å‘Šè¯‰&lt;i&gt;Runloop&lt;/i&gt;åœæ­¢&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä½¿ç”¨time outæ—¶é—´æ˜¯ä¸€ç§æ¯”è¾ƒå¥½çš„é€‰æ‹©ã€‚åœ¨é€€å‡ºä¹‹å‰ï¼ŒæŒ‡å®šä¸€ä¸ªtime outæ—¶é—´è®©runloopå®Œæˆæ‰€æœ‰çš„ä»»åŠ¡ï¼ŒåŒ…æ‹¬å‘&lt;i&gt;runloop observer&lt;/i&gt;å‘é€é€šçŸ¥ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨&lt;a href=&#34;https://developer.apple.com/documentation/corefoundation/1541796-cfrunloopstop&#34;&gt;CFRunLoopStop&lt;/a&gt;æ–¹æ³•åœæ­¢ä¸€ä¸ª&lt;i&gt;runloop&lt;/i&gt;ï¼Œäº§ç”Ÿä¸€ä¸ªç±»ä¼¼äºè¶…æ—¶çš„ç»“æœã€‚ä½¿ç”¨runloopå‘é€å®Œå‰©ä¸‹çš„runloopé€šçŸ¥ç„¶åé€€å‡ºã€‚å”¯ä¸€ä¸åŒçš„å°±æ˜¯åªæœ‰å½“ä½ æ— æ¡ä»¶çš„å¯åŠ¨&lt;i&gt;Runloop&lt;/i&gt;çš„æ—¶å€™æ‰èƒ½ä½¿ç”¨è¿™ç§æ–¹å¼é€€å‡ºã€‚&lt;/p&gt;

&lt;p&gt;å°½ç®¡ç§»é™¤runloopçš„input sourceå’Œtimerså¯ä»¥å¼•èµ·runloopçš„é€€å‡ºï¼Œä½†æ˜¯è¿™ä¸æ˜¯ä¸€ç§ç¨³å®šçš„æ–¹å¼ã€‚ä¸€äº›ç³»ç»Ÿä¸€èˆ¬æ·»åŠ input sourceåˆ°run loopæ¥å¤„ç†éœ€è¦çš„äº‹ä»¶ã€‚å› ä¸ºä½ çš„codeä¸éœ€è¦å…³å¿ƒè¿™äº›input sourceã€‚æ‰€ä»¥ä½ ä¸èƒ½ç§»é™¤input sourcesï¼Œè®©&lt;i&gt;run loop&lt;/i&gt;é€€å‡ºã€‚&lt;/p&gt;

&lt;h3 id=&#34;thread-safety-and-run-loop-objects&#34;&gt;Thread Safety and Run Loop Objects&lt;/h3&gt;

&lt;p&gt;çº¿ç¨‹å®‰å…¨å–å†³äºä½ ä½¿ç”¨æ“ä½œ&lt;i&gt;runloop&lt;/i&gt;çš„APIã€‚åœ¨Core Foundationä¸­çš„æ–¹æ³•ä¸€èˆ¬æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥è¢«ä»»ä½•å…¶ä»–çº¿ç¨‹è°ƒç”¨ã€‚å¦‚æœä½ æ­£åœ¨æ‰§è¡Œæ“ä½œï¼Œè¿™äº›æ“ä½œæ”¹å˜äº†runloopçš„é…ç½®ã€‚æ— è®ºä»€ä¹ˆæ—¶å€™ï¼Œè¿™æ ·åšä»»ç„¶æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å®è·µã€‚&lt;/p&gt;

&lt;p&gt;Cocoaçš„&lt;a href=&#34;https://developer.apple.com/documentation/foundation/runloop&#34;&gt;NSRunLoop&lt;/a&gt;ç±»ã€‚Cocoaçš„NSRunLoopå’ŒCore Foundationä¸ä¸€æ ·ï¼Œä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¦‚æœä½ ä½¿ç”¨&lt;code&gt;NSRunLoop&lt;/code&gt;ç±»æ¥ä¿®æ”¹ä½ çš„runloopï¼Œä½ åº”è¯¥åœ¨åŸæ¥çš„çº¿ç¨‹ä¸­åšè¿™äº›æ“ä½œã€‚åœ¨å…¶ä»–çº¿ç¨‹æ·»åŠ ä¸€ä¸ªinput sourceæˆ–è€…timeråˆ°åŸæ¥runloopå¯èƒ½å¼•èµ·crashï¼Œæˆ–è€…ä¸€ä¸ªæ„æƒ³ä¸åˆ°çš„è¡Œä¸ºã€‚&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>Run Loops (ä¸€)</title>
      <link>https://linkrober.github.io/bookshelf/2017/09/run-loops-%E4%B8%80/</link>
      <pubDate>Mon, 25 Sep 2017 00:00:00 +0000</pubDate>
      
      <guid>https://linkrober.github.io/bookshelf/2017/09/run-loops-%E4%B8%80/</guid>
      <description>&lt;p&gt;
&amp;gt;ä¸‹é¢ä¼šç”¨ä¸€äº›é™Œç”Ÿçš„æˆ–è€…å®¹æ˜“è®©äººæ··æ·†çš„å­—ç¬¦ï¼Œæˆ‘ä»¬å…ˆæ¥ç»Ÿä¸€æ¦‚å¿µå†ç»§ç»­ï¼Œè¿™æ ·èƒ½å¤Ÿè®©ä½ æ›´åŠ æ„‰å¿«çš„é˜…è¯»ï¼š&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;runloop:&lt;/strong&gt;iOSä¸€ä¸ªåº•å±‚æœºåˆ¶çš„ä¸“ä¸šæœ¯è¯­ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;run loop:&lt;/strong&gt;ä¸€ç§è¿è¡Œçš„å¾ªç¯ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Handler:&lt;/strong&gt;æŒ‡&lt;code&gt;handlePort:&lt;/code&gt;ã€&lt;code&gt;customSrc:&lt;/code&gt;ã€&lt;code&gt;mySelector:&lt;/code&gt;ã€&lt;code&gt;timerFired:&lt;/code&gt;ï¼ŒæŒ‡å¼€å‘è€…å¸Œæœ›å½“è¿›å…¥run loopçš„æ—¶å€™è¦æ‰§è¡Œçš„æ“ä½œ&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;run-loop observerï¼š&lt;/strong&gt;è§‚å¯Ÿrunloopè¡Œä¸ºçš„è§‚å¯Ÿè€…&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;run-loop modeï¼š&lt;/strong&gt;æ¯ä¸ªrunloopéƒ½è¦æŒ‡å®šä¸€ç§modeï¼Œä¸€ç§modeå¯ä»¥å¯¹åº”å¤šä¸ªinput source&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;runloop objectï¼š&lt;/strong&gt;runloopç›¸å…³çš„å¯¹è±¡ï¼Œè¿™é‡Œåˆ†Cocoaå’ŒCoreFoundationä¸­çš„&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;i&gt;Runloop&lt;/i&gt;æ˜¯çº¿ç¨‹æ¶æ„ç›¸å…³çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯äº‹ä»¶å¤„ç†çš„å¾ªç¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥å®‰æ’å¾ªç¯æ‰§è¡Œä»»åŠ¡ï¼Œåè°ƒç›¸å…³çš„äº‹ä»¶ï¼ˆkCFRunLoopEntryã€kCFRunLoopExitç­‰ï¼‰ã€‚
ç”¨å‡ è¡Œç¤ºæ„ä»£ç æ¥å±•ç¤ºï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;function loop() {
    initialize();
    do {
        var message = get_next_message();
        process_message(message);
    } while (message != quit);
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;i&gt;Runloop&lt;/i&gt;å®é™…ä¸Šæ˜¯ä¸€ä¸ªç®¡ç†è¦å¤„ç†çš„äº‹ä»¶å’Œæ¶ˆæ¯çš„å¯¹è±¡ï¼Œå¹¶ä¸ºå¼€å‘è€…æä¾›äº†ä¸€ä¸ªå…¥å£æ¥æ‰§è¡Œrun loopçš„é€»è¾‘éƒ¨åˆ†ã€‚ä¸€ç›´å¤„äºç±»ä¼¼äºâ€œæ¥å—æ¶ˆæ¯&amp;ndash;&amp;gt;ç­‰å¾…&amp;ndash;&amp;gt;å¤„ç†â€è¿™æ ·çš„ä¸€ä¸ªå¾ªç¯æ±‡æ€»&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;i&gt;Runloop&lt;/i&gt;çš„ç›®çš„ï¼šä¸€èˆ¬æˆ‘ä»¬è‡ªå·±å†™çš„çº¿ç¨‹åœ¨æ‰§è¡Œå®Œç›¸åº”çš„ä»»åŠ¡å°±ä¼šé€€å‡ºï¼Œè€Œrunloop&lt;strong&gt;è®©ä½ çš„çº¿ç¨‹åœ¨æœ‰äº‹å¹²çš„æ—¶å€™å¹²æ´»ï¼Œæ²¡äº‹å¹²çš„æ—¶å€™ä¼‘æ¯ï¼ŒèŠ‚çœç³»ç»Ÿèµ„æº&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;i&gt;Runloop&lt;/i&gt;çš„ç®¡ç†ä¸å…¨æ˜¯è‡ªåŠ¨çš„ï¼Œ&lt;strong&gt;å¯¹äºè‡ªå·±çš„çº¿ç¨‹ï¼Œå¿…é¡»è¦è‡ªå·±æ·»åŠ ä»£ç ï¼Œå¹¶åœ¨é€‚å½“çš„æ—¶å€™å¯åŠ¨Run loop&lt;/strong&gt;æ¥å“åº”æ¥å—çš„äº‹ä»¶ã€‚
Cocoaå’ŒCore Foundationæä¾›äº†&lt;strong&gt;runloop objects&lt;/strong&gt;æ¥å¸®åŠ©ä½ é…ç½®å’Œç®¡ç†çº¿ç¨‹çš„run loopã€‚ä½ çš„Applicationä¸éœ€è¦è‡ªå·±åˆ›å»ºè¿™äº›å¯¹è±¡(åƒallocã€initè¿™äº›æ–¹æ³•)ã€‚æ¯ä¸ªthreadï¼ŒåŒ…æ‹¬Applicationçš„ä¸»çº¿ç¨‹ï¼Œéƒ½å·²ç»æœ‰runloop objectï¼Œæœ‰æ–¹æ³•å¯ä»¥ç›´æ¥è·å–è¿™è¿™äº›å¯¹è±¡ï¼Œç±»ä¼¼äºè¿™æ ·çš„&lt;code&gt;[NSRunLoop currentRunLoop]&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;/// å…¨å±€çš„Dictionaryï¼Œkey æ˜¯ pthread_tï¼Œ value æ˜¯ CFRunLoopRef
static CFMutableDictionaryRef loopsDic;
/// è®¿é—® loopsDic æ—¶çš„é”
static CFSpinLock_t loopsLock;
 
/// è·å–ä¸€ä¸ª pthread å¯¹åº”çš„ RunLoopã€‚
CFRunLoopRef _CFRunLoopGet(pthread_t thread) {
    OSSpinLockLock(&amp;amp;loopsLock);
    
    if (!loopsDic) {
        // ç¬¬ä¸€æ¬¡è¿›å…¥æ—¶ï¼Œåˆå§‹åŒ–å…¨å±€Dicï¼Œå¹¶å…ˆä¸ºä¸»çº¿ç¨‹åˆ›å»ºä¸€ä¸ª RunLoopã€‚
        loopsDic = CFDictionaryCreateMutable();
        CFRunLoopRef mainLoop = _CFRunLoopCreate();
        CFDictionarySetValue(loopsDic, pthread_main_thread_np(), mainLoop);
    }
    
    /// ç›´æ¥ä» Dictionary é‡Œè·å–ã€‚
    CFRunLoopRef loop = CFDictionaryGetValue(loopsDic, thread));
    
    if (!loop) {
        /// å–ä¸åˆ°æ—¶ï¼Œåˆ›å»ºä¸€ä¸ª
        loop = _CFRunLoopCreate();
        CFDictionarySetValue(loopsDic, thread, loop);
        /// æ³¨å†Œä¸€ä¸ªå›è°ƒï¼Œå½“çº¿ç¨‹é”€æ¯æ—¶ï¼Œé¡ºä¾¿ä¹Ÿé”€æ¯å…¶å¯¹åº”çš„ RunLoopã€‚
        _CFSetTSD(..., thread, loop, __CFFinalizeRunLoop);
    }
    
    OSSpinLockUnLock(&amp;amp;loopsLock);
    return loop;
}
 
CFRunLoopRef CFRunLoopGetMain() {
    return _CFRunLoopGet(pthread_main_thread_np());
}
 
CFRunLoopRef CFRunLoopGetCurrent() {
    return _CFRunLoopGet(pthread_self());
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è‹¹æœæä¾›äº†&lt;code&gt;CFRunLoopGetMain&lt;/code&gt; ã€&lt;code&gt;CFRunLoopGetMain&lt;/code&gt;è¿™ä¸¤ä¸ªæ–¹æ³•æ¥åˆ›å»º&lt;i&gt;runloop&lt;/i&gt;ï¼Œå¦‚æœå®ƒä¸è¢«è°ƒç”¨ï¼Œçº¿ç¨‹ä¸­å°±ä¸ä¼šæœ‰runloopã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Cocoaä¸­çš„&lt;code&gt;NSRunLoop&lt;/code&gt;,å’ŒCore Foundationä¸­çš„&lt;code&gt;CFRunLoopRef&lt;/code&gt;ç­‰Run loopç›¸å…³çš„ç±»ã€‚å®ƒä»¬çš„æ–¹æ³•ä¸€èˆ¬ä¹Ÿæ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;å”¯ä¸€ä¸åŒçš„æ˜¯ï¼šä½ è‡ªå·±åˆ›å»ºçš„çº¿ç¨‹éœ€è¦æ˜ç¡®çš„ä»£ç æ¥è®©runloopè·‘èµ·æ¥ï¼Œæ¯”å¦‚&lt;code&gt;[runLoop run]&lt;/code&gt;è¿™æ ·çš„æ–¹æ³•ã€‚ä½†æ˜¯å¯¹äºä¸»çº¿ç¨‹çš„&lt;i&gt;runloop&lt;/i&gt;ï¼Œç³»ç»Ÿä¼šåœ¨Appèµ·æ¥çš„æ—¶å€™è‡ªåŠ¨è®¾ç½®å¹¶è·‘ä¸»çº¿ç¨‹é‡Œé¢çš„&lt;i&gt;runloop&lt;/i&gt;ï¼Œè¿™æ˜¯Applicationè¿è¡Œèµ·æ¥çš„ä¸€éƒ¨åˆ†ã€‚&lt;/p&gt;

&lt;h3 id=&#34;anatomy-of-run-loop-å‰–ærunloop&#34;&gt;Anatomy of Run Loopï¼ˆå‰–ærunloopï¼‰&lt;/h3&gt;

&lt;p&gt;â€œä¸€ä¸ªè¿è¡Œçš„å¾ªç¯â€ï¼Œçœ‹å®ƒåå­—çš„æ„æ€å°±èƒ½çŒœå¾—åˆ°ã€‚å®ƒä¼šå¾ªç¯ä¸æ–­çš„è¿›å…¥çº¿ç¨‹ï¼Œåœ¨&lt;i&gt;runloop&lt;/i&gt;è¿›å…¥ä¹‹ååšä¸€äº›è‡ªå·±çš„äº‹æƒ…ã€‚ä½ çš„codeæä¾›äº†çŠ¶æ€çš„æ§åˆ¶ç”¨æ¥å®ç°&lt;i&gt;runloop&lt;/i&gt;çœŸæ­£çš„å¾ªç¯éƒ¨åˆ†ã€‚â€”â€” æ¢å¥è¯è¯´ï¼Œä½ çš„codeæä¾›&lt;code&gt;while&lt;/code&gt;æˆ–&lt;code&gt;for&lt;/code&gt;å¾ªç¯æ¥é©±åŠ¨run loopã€‚åœ¨ä½ çš„å¾ªç¯ä¸­ï¼Œä½ ä½¿ç”¨ä¸€ä¸ª&lt;i&gt;runloop object&lt;/i&gt;æ¥è¿è¡Œäº‹ä»¶å¤„ç†çš„codeï¼Œ&lt;i&gt;runloop&lt;/i&gt;æ¥å—äº‹ä»¶å¹¶è°ƒç”¨ä½ å·²ç»å‡†å¤‡å¥½çš„æ–¹æ³•ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;/*
 è¿™é‡ŒdoFireTimeræ–¹æ³•å°±æ˜¯ä½ è¦å¤„ç†çš„äº‹ä»¶çš„codeï¼Œ&amp;lt;i&amp;gt;runloop&amp;lt;/i&amp;gt;åœ¨ä»sleepçŠ¶æ€è¢«wakeupä¹‹åä¼šæ‰§è¡Œæ”¹æ–¹æ³•ã€‚
*/
[NSTimer scheduledTimerWithTimeInterval:0.016
                                     target:self
                                   selector:@selector(doFireTimer:)
                                   userInfo:nil
                                    repeats:YES];
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¸Šé¢æˆ‘ä»¬æåˆ°&lt;strong&gt;â€œä½ ä½¿ç”¨ä¸€ä¸ªrunloop objectæ¥è¿è¡Œäº‹ä»¶å¤„ç†çš„codeâ€&lt;/strong&gt;ï¼Œè¿™é‡Œçš„äº‹ä»¶æ˜¯ä»å“ªé‡Œæ¥å‘¢ï¼Ÿå³äº‹ä»¶æºæ˜¯ä»€ä¹ˆï¼Ÿ&lt;/p&gt;

&lt;p&gt;äº‹ä»¶æºåˆ†ä¸¤ç±»ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;i&gt;Input source&lt;/i&gt;æ‰€é©±åŠ¨çš„å¼‚æ­¥äº‹ä»¶ï¼Œä¸€èˆ¬å®ƒç”¨æ¥ä»ä¸€ä¸ªçº¿ç¨‹å‘å¦ä¸€ä¸ªçº¿ç¨‹å‘é€äº‹ä»¶æˆ–è€…ä»ä¸€ä¸ªApplicationå‘å¦ä¸€ä¸ªApplicationã€‚&lt;/li&gt;
&lt;li&gt;&lt;i&gt;Timer sources&lt;/i&gt;æ‰€é©±åŠ¨çš„åŒæ­¥äº‹ä»¶ï¼Œäº‹ä»¶å‘ç”Ÿåœ¨ä¸€ä¸ªå·²ç»é¢„å…ˆè®¾å®šå¥½çš„æ—¶é—´ï¼Œæˆ–è€…åœ¨é‡å¤çš„äº‹ä»¶é—´éš”å‘ç”Ÿã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å½“äº‹ä»¶åˆ°è¾¾çš„æ—¶å€™ï¼Œè¿™ä¸¤ç§sourceä¼šæŒ‰ç…§ç³»ç»ŸæŒ‡å®šçš„æ­¥éª¤æ¥å¤„ç†äº‹ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹å›¾å±•ç¤ºäº†ä¸€ä¸ª&lt;i&gt;runloop&lt;/i&gt;çš„æ¦‚å¿µç»“æ„å’Œå„ç§ä¸åŒçš„sourcesã€‚Input sourceså‘é€ä¸€ä¸ªå¼‚æ­¥çš„äº‹ä»¶æ¥æ‰§è¡Œç›¸å¯¹åº”çš„handlerï¼ˆä¾‹å¦‚ï¼Œå›¾ä¸­çš„&lt;code&gt;hanlePort&lt;/code&gt;ã€&lt;code&gt;mySelector&lt;/code&gt;ç­‰ï¼‰ï¼Œå¹¶é€šè¿‡&lt;code&gt;runUntilDate:&lt;/code&gt;æ–¹æ³•ï¼ˆè°ƒç”¨threadç›¸å…³çš„&lt;a href=&#34;https://developer.apple.com/documentation/foundation/runloop&#34;&gt;NSRunLoop&lt;/a&gt;å¯¹è±¡ï¼‰æ¥é€€å‡ºã€‚Timer sourceså‘é€äº‹ä»¶åˆ°runloopçš„handlerï¼Œä½†ä¸ä¼šå¼•èµ·runloopçš„é€€å‡ºã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://upload-images.jianshu.io/upload_images/1086250-2f8e40f8ce0f82c0.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&#34; alt=&#34;runloop-1.jpg&#34; /&gt;&lt;/p&gt;

&lt;p&gt;é™¤äº†å¤„ç†è¾“å…¥æºå¯¹åº”çš„handlerï¼Œ&lt;i&gt;Runloop&lt;/i&gt;ç”Ÿæˆå…³äºrun loopè¡Œä¸ºçš„é€šçŸ¥ã€‚æ³¨å†Œ&lt;i&gt;run-loop&lt;/i&gt; çš„observeræ¥å—è¿™äº›é€šçŸ¥ã€‚ä½¿ç”¨å®ƒä»¬åœ¨threadä¸Šåšä¸€äº›å…¶ä»–çš„æ“ä½œã€‚ä½ å¯ä»¥åœ¨ä½ çš„çº¿ç¨‹ä¸­ä½¿ç”¨Core Foundationé‡Œé¢çš„ç±»æ¥åˆ›å»º&lt;i&gt;run-loop observer&lt;/i&gt;ã€‚&lt;/p&gt;

&lt;h3 id=&#34;run-loop-modes&#34;&gt;Run Loop Modes&lt;/h3&gt;

&lt;p&gt;&lt;i&gt;run-loop mode&lt;/i&gt;æ˜¯è¢«ç›‘å¬çš„&lt;i&gt;Input sources&lt;/i&gt;å’Œ&lt;i&gt;Timers&lt;/i&gt;çš„é›†åˆï¼ŒåŒæ—¶è¿˜æ˜¯è¢«é€šçŸ¥çš„&lt;i&gt;run-loop observer&lt;/i&gt;çš„é›†åˆï¼Œå¤§å®¶å¯èƒ½æ¯”è¾ƒç–‘æƒ‘æ€ä¹ˆæ˜¯ä¸¤ç§ä¸œè¥¿çš„é›†åˆï¼ˆsourceå’Œobaserverï¼‰ï¼Œä¸‹é¢æ˜¯æˆ‘çš„ç†è§£ï¼Œä»ä»£ç å‡ºå‘ï¼š
&lt;code&gt;[runLoop addPort:[NSMachPort port] forMode:NSDefaultRunLoopMode];&lt;/code&gt;
&lt;strong&gt;çº¿ç¨‹çš„æ¯ä¸ªSourceéƒ½è¦æŒ‡å®šä¸€ä¸ªModeï¼Œè¿™é‡Œæ˜¯NSDefaultRunLoopMode&lt;/strong&gt;
&lt;code&gt;CFRunLoopAddObserver(cfLoop, observer, kCFRunLoopCommonModes);&lt;/code&gt;
&lt;strong&gt;è§‚å¯Ÿè€…æ˜¯è§‚å¯Ÿè¯¥Runloopçš„æŸäº›Modesï¼ŒkCFRunLoopCommonModesæ˜¯modeçš„é›†åˆï¼Œæ¯ç§modeéƒ½å¯ä»¥æ·»åŠ åˆ°Commonä¸­&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æ¯æ¬¡ä½ è¿è¡Œä½ çš„&lt;i&gt;runloop&lt;/i&gt;çš„æ—¶å€™ï¼Œè¦æŒ‡å®šä¸€ä¸ªå…·ä½“çš„modeåœ¨&lt;i&gt;runloop&lt;/i&gt;é‡Œé¢è·‘ã€‚åœ¨è¿›å…¥&lt;i&gt;runloop&lt;/i&gt;çš„æ—¶å€™ï¼Œåªæœ‰å’Œè¿™ä¸ªmodeç›¸å…³è”çš„sourceèƒ½è¢«å¯¹åº”çš„&lt;i&gt;run-loop observer&lt;/i&gt;ç›‘å¬åˆ°ï¼Œè¢«å…è®¸å‘å®ƒä»¬ä¼ é€’äº‹ä»¶ã€‚è€Œå…¶ä»–modeç›¸å…³çš„sourceä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°&lt;i&gt;run-loop mode&lt;/i&gt;å’ŒsourceæŒ‡å®šçš„modeç›¸å¯¹åº”çš„æ—¶å€™æ‰å¼€å§‹ä¼ é€’äº‹ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ä½ çš„ä»£ç ä¸­ï¼Œä½ é€šè¿‡å…·ä½“çš„åç§°æ¥å®šä¹‰mode(&lt;code&gt;kCFRunLoopDefaultMode&lt;/code&gt;ã€&lt;code&gt;kCFRunLoopCommonModes&lt;/code&gt;ç­‰)ã€‚Cocoaå’ŒCore Foundationéƒ½å®šä¹‰äº†é»˜è®¤çš„modeå’Œä¸€äº›ç»å¸¸ä½¿ç”¨çš„modeã€‚&lt;/p&gt;

&lt;p&gt;ä½ ä¹Ÿèƒ½é€šè¿‡ç®€å•çš„å­—ç¬¦ä¸²æ¥è‡ªå®šä¹‰è‡ªå·±çš„modeã€‚å°½ç®¡custom modeå®šä¹‰èµ·æ¥å¥½åƒå¾ˆéšæ„ï¼Œä½†ä½¿ç”¨èµ·æ¥å¯ä¸èƒ½éšæ„å•Šã€‚å¯¹äºä»»ä½•modeï¼Œä½ å¿…é¡»è¦ç¡®ä¿æ·»åŠ ä¸€ä¸ªæˆ–è€…æ›´å¤šçš„&lt;i&gt;sources&lt;/i&gt;ï¼Œ&lt;i&gt;timers&lt;/i&gt;æˆ–è€…&lt;i&gt;run-loop observer&lt;/i&gt;ï¼Œå¦‚æœä½ æ²¡æœ‰åšåˆ°ï¼Œ&lt;i&gt;run loop&lt;/i&gt;å°±ä¼šç›´æ¥é€€å‡ºã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;//å¦‚æœæ²¡æœ‰ç¬¬äºŒè¡Œä»£ç ï¼Œrunloopä¼šè‡ªåŠ¨é€€å‡º
NSRunLoop *runLoop = [NSRunLoop currentRunLoop];
[runLoop addPort:[NSMachPort port] forMode:NSDefaultRunLoopMode];
[runLoop run];

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½ å¯ä»¥ä½¿ç”¨modeè¿‡æ»¤æ‰ä¸æƒ³è¦çš„sourceã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ åªéœ€è¦ç”¨ç³»ç»Ÿå®šä¹‰çš„â€œdefaultâ€modeæ¥è¿è¡Œä½ çš„runloopã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Note:Modeæ˜¯æ ¹æ®äº‹ä»¶sourceæ¥åŒ¹é…çš„è€Œä¸æ˜¯æ ¹æ®äº‹ä»¶çš„typeã€‚ä¾‹å¦‚ï¼Œä½ ä¸å¯ä»¥ä½¿ç”¨é¼ æ ‡çš„æŒ‰ä¸‹äº‹ä»¶æˆ–è€…é”®ç›˜æŒ‰ä¸‹äº‹ä»¶æ¥åŒ¹é…modeã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ä¸‹é¢æ˜¯ä¸€äº›ç³»ç»Ÿå®šä¹‰å¥½çš„Modes&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Mode&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Name&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Default&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;a href=&#34;https://developer.apple.com/documentation/foundation/nsdefaultrunloopmode&#34;&gt;NSDefaultRunLoopMode&lt;/a&gt;(Cocoa)&lt;a href=&#34;https://developer.apple.com/documentation/corefoundation/kcfrunloopdefaultmode&#34;&gt;kCFRunLoopDefaultMode&lt;/a&gt;(Core Foundation)&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Connection&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;a href=&#34;https://developer.apple.com/documentation/foundation/nsconnectionreplymode&#34;&gt;NSConnectionReplyMode&lt;/a&gt;(Cocoa)&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Modal&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;a href=&#34;https://developer.apple.com/documentation/appkit/nsmodalpanelrunloopmode&#34;&gt;NSModalPanelRunLoopMode&lt;/a&gt;(Cocoa)&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Event tracking&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;a href=&#34;https://developer.apple.com/documentation/foundation/runloopmode/1428765-eventtrackingrunloopmode&#34;&gt;NSEventTrackingRunLoopMode&lt;/a&gt;(Cocoa)&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Common modes&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;&lt;a href=&#34;https://developer.apple.com/documentation/foundation/runloopmode/1408609-commonmodes&#34;&gt;NSRunLoopCommonModes&lt;/a&gt;(Cocoa)&lt;a href=&#34;https://developer.apple.com/documentation/corefoundation/kcfrunloopcommonmodes&#34;&gt;kCFRunLoopCommonModes&lt;/a&gt;(Core Foundation)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&#34;input-sources&#34;&gt;Input Sources&lt;/h3&gt;

&lt;p&gt;&lt;i&gt;Input source&lt;/i&gt;é€šè¿‡å¼‚æ­¥çš„æ–¹å¼å‘ä½ çš„çº¿ç¨‹ä¼ é€’äº‹ä»¶ã€‚äº‹ä»¶çš„æºå–å†³äº&lt;i&gt;input source&lt;/i&gt;çš„ç±»å‹ã€‚&lt;i&gt;input source&lt;/i&gt;å¤§æ¦‚åˆ†ä¸ºä¸¤ç±»ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Port-based port&lt;/strong&gt;
&lt;i&gt;Port-based port&lt;/i&gt;ç›‘æ§ä½ applicationçš„Mach portã€‚&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;strong&gt;Custom input source&lt;/strong&gt;
&lt;i&gt;Custom input source&lt;/i&gt;ç›‘æ§è‡ªå®šä¹‰çš„äº‹ä»¶sourceã€‚&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;i&gt;runloop&lt;/i&gt;ä¸å…³å¿ƒæ˜¯å“ªç§&lt;i&gt;input source&lt;/i&gt;ï¼Œè¿™ä¸¤ç§*input sources*ç³»ç»Ÿéƒ½æœ‰å®ç°ã€‚è¿™ä¸¤ä¸ª&lt;i&gt;input source&lt;/i&gt;å”¯ä¸€çš„ä¸åŒå°±æ˜¯å®ƒä»¬å¦‚ä½•å‘é€ä¿¡å·ã€‚&lt;i&gt;Port-based port&lt;/i&gt;é€šè¿‡å†…æ ¸è‡ªåŠ¨å‘é€ä¿¡å·ã€‚&lt;i&gt;Custom input source&lt;/i&gt;åªèƒ½ä»å…¶ä»–çº¿ç¨‹æ¥å—æ‰‹åŠ¨å‘é€çš„ä¿¡å·ã€‚&lt;/p&gt;

&lt;p&gt;å½“ä½ åˆ›å»ºä¸€ä¸ª&lt;i&gt;input source&lt;/i&gt;ï¼Œä½ æŠŠå®ƒèµ‹å€¼åˆ°&lt;i&gt;runloop&lt;/i&gt;çš„modeã€‚modeä¼šå½±å“è¢«ç›‘æ§çš„input sourceã€‚å¤§å¤šæ•°æƒ…å†µï¼Œä½ åœ¨&lt;code&gt;NSDefaultRunLoopMode&lt;/code&gt;ä¸‹è¿è¡Œ&lt;i&gt;runloop&lt;/i&gt;ï¼Œä½†æ˜¯ä½ ä¹Ÿå¯ä»¥æŒ‡å®šè‡ªå®šä¹‰çš„modeã€‚å¦‚æœä¸€ä¸ª&lt;i&gt;input source&lt;/i&gt;ä¸åœ¨å½“å‰è¢«ç›‘æ§çš„modeä¸­ï¼Œå®ƒäº§ç”Ÿçš„ä¸€äº›äº‹ä»¶å°†ä¼šè¢«æš‚æ—¶çš„æ”¾åœ¨ä¸€è¾¹ï¼Œç›´åˆ°ä¸‹ä¸€ä¸ªrun loopçš„modeå’Œinput sourceçš„modeç›¸åŒæ‰å¼€å§‹å¤„ç†è¿™ä¸ªinput sourceäº§ç”Ÿçš„äº‹ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;æ¥ä¸‹å»çš„éƒ¨åˆ†æè¿°äº†ä¸€äº›input source&lt;/p&gt;

&lt;h5 id=&#34;port-based-sources&#34;&gt;Port-Based Sources&lt;/h5&gt;

&lt;p&gt;Cocoaå’ŒCore Foundationé€šè¿‡æä¾›ç«¯å£ç›¸å…³çš„å¯¹è±¡å’Œæ–¹æ³•æ¥åˆ›å»º&lt;i&gt;Port-Based Source&lt;/i&gt;ã€‚ä¾‹å¦‚ï¼Œåœ¨Cocoaä¸­ï¼Œä½ æ²¡å¿…è¦ç›´æ¥åˆ›å»ºinput sourceã€‚ä½ ä½¿ç”¨&lt;code&gt;NSPort&lt;/code&gt;çš„æ–¹æ³•&lt;code&gt;[NSPort port]&lt;/code&gt;ï¼Œæ·»åŠ portåˆ°run loopä¸­ã€‚Port objectä¼šä¸ºä½ åˆ›å»ºå’Œé…ç½®æ‰€éœ€çš„&lt;i&gt;Port-Based Sources&lt;/i&gt;ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ Core Foundationä¸­ï¼Œä½ å¿…é¡»è¦è‡ªå·±åˆ›å»ºportå’Œå®ƒçš„run loop sourceã€‚ç”¨Â &lt;a href=&#34;https://developer.apple.com/documentation/corefoundation/cfmachport&#34;&gt;CFMachPortRef&lt;/a&gt;,Â &lt;a href=&#34;https://developer.apple.com/documentation/corefoundation/cfmessageportref&#34;&gt;CFMessagePortRef&lt;/a&gt;, Â &lt;a href=&#34;https://developer.apple.com/documentation/corefoundation/cfsockeref&#34;&gt;CFSocketRef&lt;/a&gt;è¿™äº›ä¸é€æ˜æŒ‡é’ˆåˆ›å»ºç›¸åº”çš„å¯¹è±¡ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚ä½•é…ç½®å’Œè®¾ç½®è‡ªå®šä¹‰çš„&lt;i&gt;Port-Based Sources&lt;/i&gt;ï¼Œè¯·çœ‹&lt;a href=&#34;https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-131281&#34;&gt; Configuring a Port-Based Input Source&lt;/a&gt;&lt;/p&gt;

&lt;h5 id=&#34;custom-input-sources-core-foundation&#34;&gt;Custom Input Sourcesï¼ˆCore Foundationï¼‰&lt;/h5&gt;

&lt;p&gt;ä¸ºäº†åˆ›å»ºè‡ªå®šä¹‰çš„input sourceï¼Œä½ å¿…é¡»ä½¿ç”¨Core Foundationä¸­çš„&lt;a href=&#34;https://developer.apple.com/documentation/corefoundation/cfrunloopsource&#34;&gt;CFRunLoopSourceRef&lt;/a&gt;ä¸é€æ˜ç±»ç›¸å…³çš„æ–¹æ³•ã€‚ä½ éœ€è¦åœ¨å›è°ƒæ–¹æ³•ä¸­é…ç½®è¿™ä¸ªCustom Input Sourcesã€‚Core Foundationä¼šåœ¨é…ç½®Custom Input Sourcesã€å¤„ç†è¾“å…¥äº‹ä»¶å’Œå½“sourceè¦ä»runloopä¸­ç§»é™¤çš„æ—¶å€™è°ƒç”¨è¿™å‡ ä¸ªå›è°ƒã€‚&lt;/p&gt;

&lt;p&gt;å¯¹äºå¦‚ä½•åˆ›å»ºä¸€ä¸ªcustom input sourceè¯·çœ‹è¿™é‡Œ&lt;a href=&#34;https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-SW3&#34;&gt;Defining a Custom Input Source&lt;/a&gt;&lt;/p&gt;

&lt;h5 id=&#34;cocoa-perform-selector-sources-cocoa&#34;&gt;Cocoa Perform Selector Sourcesï¼ˆCocoaï¼‰&lt;/h5&gt;

&lt;p&gt;é™¤äº†&lt;i&gt;Port-Based Sources&lt;/i&gt;ï¼ŒCocoaå®šä¹‰äº†ä¸€ä¸ª&lt;i&gt;custom input source&lt;/i&gt;ï¼Œè¿™å…è®¸ä½ å‘ä»»ä½•çº¿ç¨‹ä¸­å‘é€é€‰æ‹©å­ã€‚å’Œ&lt;i&gt;Port-Based Sources&lt;/i&gt;ä¸€æ ·ï¼Œæ‰§è¡Œé€‰æ‹©å­selectorçš„è¯·æ±‚åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸Šæ˜¯è¿ç»­çš„ï¼Œå½“å¤šä¸ªæ–¹æ³•åŒæ—¶å‘çº¿ç¨‹å‘é€è¯·æ±‚çš„æ—¶å€™å¯èƒ½ä¼šå¯¼è‡´åŒæ­¥çš„é—®é¢˜ã€‚å’Œ&lt;i&gt;Port-Based Sources&lt;/i&gt;ä¸åŒçš„æ˜¯ï¼šä¸€ä¸ª&lt;i&gt;perform selector source&lt;/i&gt;æ‰§è¡Œå®Œå®ƒçš„selectorï¼Œå®ƒè‡ªå·±ä¼šä»runloopä¸­ç§»é™¤ã€‚&lt;/p&gt;

&lt;p&gt;å½“å‘å¦ä¸€ä¸ªçº¿ç¨‹å‘é€selectorè¯·æ±‚æ—¶ï¼Œç›®æ ‡çº¿ç¨‹å¿…é¡»æœ‰ä¸€ä¸ªactiveçš„&lt;i&gt;runloop&lt;/i&gt;ã€‚è¿™æ„å‘³ç€ä½ å¿…é¡»ç­‰å¾…ï¼Œç›´åˆ°è¯¥çº¿ç¨‹ä¸­runloopçš„çŠ¶æ€å˜æˆ activeã€‚å› ä¸ºä¸»çº¿ç¨‹ä¼šè‡ªå·±å¼€å§‹ä¸€ä¸ª&lt;i&gt;runloop&lt;/i&gt;ï¼Œåªè¦ç³»ç»Ÿä¸€è°ƒç”¨Application delegateçš„&lt;code&gt;applicationDidFinishLaunching:&lt;/code&gt;ï¼ˆè¿™æ—¶å€™ç³»ç»Ÿçš„runloopå°±åˆ›å»ºå‡ºæ¥äº†ï¼‰ï¼Œä½ å°±å¯ä»¥å‘ä¸»çº¿ç¨‹å‘é€selectorè¯·æ±‚ã€‚æ¯æ¬¡&lt;i&gt;Runloop&lt;/i&gt;ä¼šå¤„ç†æ‰€æœ‰é˜Ÿåˆ—çš„selectorè¯·æ±‚ï¼Œè€Œä¸æ˜¯åªå¤„ç†ä¸€ä¸ªé˜Ÿåˆ—çš„è¯·æ±‚ã€‚ä¸‹é¢åˆ—å‡ºäº†ä¸€äº›performæ–¹æ³•&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Methods&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;&lt;a href=&#34;https://developer.apple.com/documentation/objectivec/nsobject/1414900-performselector&#34;&gt;performSelectorOnMainThread:withObject:waitUntilDone:&lt;/a&gt;ã€&lt;a href=&#34;https://developer.apple.com/documentation/objectivec/nsobject/1411637-performselector&#34;&gt;performSelectorOnMainThread:withObject:waitUntilDone:modes:&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;&lt;a href=&#34;https://developer.apple.com/documentation/objectivec/nsobject/1414476-perform&#34;&gt;performSelector:onThread:withObject:waitUntilDone:&lt;/a&gt;ã€&lt;a href=&#34;https://developer.apple.com/documentation/objectivec/nsobject/1417922-perform&#34;&gt;performSelector:onThread:withObject:waitUntilDone:modes:&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;&lt;a href=&#34;https://developer.apple.com/documentation/objectivec/nsobject/1416176-perform&#34;&gt;performSelector:withObject:afterDelay:&lt;/a&gt;ã€&lt;a href=&#34;https://developer.apple.com/documentation/objectivec/nsobject/1415652-perform&#34;&gt;performSelector:withObject:afterDelay:inModes:&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;&lt;a href=&#34;https://developer.apple.com/documentation/objectivec/nsobject/1417611-cancelpreviousperformrequests&#34;&gt;cancelPreviousPerformRequestsWithTarget:&lt;/a&gt;ã€&lt;a href=&#34;https://developer.apple.com/documentation/objectivec/nsobject/1410849-cancelpreviousperformrequests&#34;&gt;cancelPreviousPerformRequestsWithTarget:selector:object:&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h5 id=&#34;timer-sources&#34;&gt;Timer Sources&lt;/h5&gt;

&lt;p&gt;&lt;i&gt;Timer sources&lt;/i&gt;ä¼šåœ¨å°†æ¥çš„æŸä¸ªæ—¶é—´ï¼Œå‘é€åŒæ­¥äº‹ä»¶åˆ°ä½ çš„å½“å‰çš„çº¿ç¨‹ã€‚Timeræ˜¯çº¿ç¨‹ç”¨æ¥é€šçŸ¥å®ƒè‡ªå·±çš„ä¸€ç§æ–¹å¼ã€‚
å°½ç®¡å®ƒæ˜¯åŸºäºæ—¶é—´çš„é€šçŸ¥ï¼Œä¸€ä¸ªtimerå¹¶ä¸èƒ½ä¿è¯åœ¨å‡†ç¡®çš„æ—¶é—´ç‚¹æ‰§è¡Œäº‹ä»¶ã€‚å’Œå…¶ä»–çš„&lt;i&gt;Input source&lt;/i&gt;ä¸€æ ·ï¼ŒTimerå’Œä½ &lt;i&gt;run loop&lt;/i&gt;æŒ‡å®šçš„modeæœ‰å…³ç³»ã€‚å¦‚æœTimerçš„modeä¸æ˜¯ä½ å½“å‰runloopæ­£åœ¨è·‘çš„modeï¼Œå®ƒæ˜¯ä¸ä¼šè¢«è§¦å‘çš„ï¼Œç›´åˆ°ä½ çš„&lt;i&gt;runloop&lt;/i&gt;è¿è¡Œçš„çš„modeæ˜¯ä½ çš„Timeræ‰€æ”¯æŒçš„ã€‚ç±»ä¼¼çš„ï¼Œå¦‚æœä¸€ä¸ªTimerè¢«è§¦å‘ï¼Œä½†æ˜¯å½“runloopåœ¨æ‰§è¡ŒHandlerï¼ŒTimerå°†ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°ä¸‹æ¬¡å†æ¬¡è¿›å…¥runloopçš„æ—¶å€™æ‰ä¼šæ‰§è¡Œã€‚å¦‚æœè¿™ä¸ª&lt;i&gt;runloop&lt;/i&gt;ä¸å†è·‘äº†ï¼Œè¿™ä¸ªTimerå°†æ°¸è¿œä¸ä¼šè¢«è§¦å‘ã€‚&lt;/p&gt;

&lt;p&gt;ä½ å¯ä»¥é…ç½®Timeræ¥è¿è¡Œäº‹ä»¶ï¼Œä¸€æ¬¡æˆ–è€…ä¸åœé‡å¤ã€‚ä¸€ä¸ªé‡å¤çš„Timerä¼šåŸºäºè®¾å®šå¥½çš„è§¦å‘æ—¶é—´ï¼Œè‡ªåŠ¨é‡æ–°å®‰æ’å®ƒè‡ªå·±åˆ°run loopä¸­ï¼Œä½†è¿™ä¸ªæ—¶é—´é—´éš”å¹¶ä¸ä¸€å®šå‡†ç¡®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªTimeråœ¨ä¸€ä¸ªç‰¹å®šæ—¶é—´è¢«è§¦å‘ï¼Œæ¯5ç§’é‡å¤ä¸€æ¬¡ã€‚å³ä½¿å®é™…çš„è§¦å‘æ—¶é—´è¢«å»¶è¿Ÿäº†ï¼Œè¢«å®‰æ’çš„è§¦å‘æ—¶é—´æ€»è½åœ¨5ç§’çš„å»¶è¿Ÿæ—¶é—´é—´éš”ä¹‹å†…ã€‚å¦‚æœè§¦å‘æ—¶é—´è¢«å»¶è¿Ÿå¤ªå¤šï¼Œä¼šå¯¼è‡´å®ƒé”™è¿‡äº†ä¸€æ¬¡æˆ–è€…æ›´å¤šè¢«å®‰æ’åˆ°run loopçš„æœºä¼šã€‚åœ¨ä¸€ä¸ªä¸æ°å½“çš„æ—¶æœºè¢«è§¦å‘ä¹‹åï¼ŒTimeråˆ™ä¼šè¢«å®‰æ’åˆ°ä¸‹ä¸€æ¬¡run loopã€‚
å…³äºé…ç½®timer sourcesçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·çœ‹&lt;a href=&#34;https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-SW6&#34;&gt;Configuring Timer Sources&lt;/a&gt;ã€‚æ›´å¤šç›¸å…³ä¿¡æ¯&lt;a href=&#34;https://developer.apple.com/documentation/foundation/timer&#34;&gt;NSTimer Class Reference&lt;/a&gt;æˆ–&lt;a href=&#34;https://developer.apple.com/documentation/corefoundation/cfrunlooptimer-rhk&#34;&gt;CFRunLoopTimer Reference&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h5 id=&#34;run-loop-observers&#34;&gt;Run Loop Observers&lt;/h5&gt;

&lt;p&gt;ä¸€èˆ¬çš„sourceæ˜¯åœ¨ä¸€ä¸ªå¼‚æ­¥æˆ–è€…åŒæ­¥çš„äº‹ä»¶å‘ç”Ÿçš„æ—¶å€™è¢«è§¦å‘çš„ï¼Œè€Œ&lt;i&gt;run-loop observer&lt;/i&gt;æ˜¯åœ¨&lt;i&gt;runloop&lt;/i&gt;å®ƒæ‰§è¡Œçš„æ—¶å€™è§¦å‘çš„ã€‚ä½ å¯ä»¥é€šè¿‡&lt;i&gt;run-loop observer&lt;/i&gt;æ¥å‡†å¤‡ä¸€äº›çº¿ç¨‹å¾…å¤„ç†çš„äº‹ä»¶ï¼Œæˆ–è€…åœ¨çº¿ç¨‹sleepä¹‹å‰ï¼Œåœ¨çº¿ç¨‹ä¸­åšä¸€äº›äº‹ã€‚&lt;i&gt;run-loop observers&lt;/i&gt;å¯ä»¥è§‚å¯Ÿåˆ°ä¸‹é¢çš„ä¸€äº›äº‹ä»¶ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;è¿›å…¥&lt;i&gt;runloop&lt;/i&gt;çš„æ—¶å€™&lt;/li&gt;
&lt;li&gt;å½“&lt;i&gt;runloop&lt;/i&gt;å°†è¦å¤„ç†timerçš„æ—¶å€™&lt;/li&gt;
&lt;li&gt;å½“&lt;i&gt;runloop&lt;/i&gt;å°†è¦å¤„ç†input sourceçš„æ—¶å€™&lt;/li&gt;
&lt;li&gt;å½“&lt;i&gt;runloop&lt;/i&gt;å°†è¦sleepçš„æ—¶å€™&lt;/li&gt;
&lt;li&gt;å½“&lt;i&gt;runloop&lt;/i&gt;å·²ç»é†’æ¥ï¼Œè¿˜æ²¡æœ‰å¼€å§‹å¤„ç†eventçš„æ—¶å€™&lt;/li&gt;
&lt;li&gt;å½“&lt;i&gt;runloop&lt;/i&gt;é€€å‡ºçš„æ—¶å€™&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä½ å¯ä»¥ä½¿ç”¨Core Foundationå‘Applicationæ·»åŠ &lt;i&gt;run-loop observer&lt;/i&gt;ã€‚ä¸ºäº†åˆ›å»ºä¸€ä¸ª&lt;i&gt;run_loop observer&lt;/i&gt;ï¼Œä½ éœ€è¦ä½¿ç”¨&lt;a href=&#34;https://developer.apple.com/documentation/corefoundation/cfrunloopobserver&#34;&gt;CFRunLoopObserverRef&lt;/a&gt;ç±»ã€‚è¿™ä¸ªç±»ä¼šè¿½è¸ªä½ è‡ªå®šä¹‰callbackå‡½æ•°ã€ä½ æ„Ÿå…´è¶£çš„&lt;code&gt;CFRunLoopActivity&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;å’ŒTimerç›¸ä¼¼ï¼Œ&lt;i&gt;run-loop observer&lt;/i&gt;å¯ä»¥åªè¿è¡Œä¸€æ¬¡ï¼Œæˆ–è€…ä¸åœé‡å¤ã€‚åªè¿è¡Œä¸€æ¬¡çš„&lt;i&gt;run-loop observer&lt;/i&gt;åœ¨ä¸€æ¬¡run loopä¹‹åå°±ä¼šä»&lt;i&gt;runloop&lt;/i&gt;ä¸­ç§»é™¤ã€‚å½“ä½ åˆ›å»º&lt;i&gt;run-loop observer&lt;/i&gt;çš„æ—¶å€™ï¼Œä½ è¦å†³å®šræ˜¯ä¸€æ¬¡è¿˜æ˜¯ä¸åœé‡å¤ã€‚&lt;/p&gt;

&lt;p&gt;å¯¹äºå¦‚ä½•åˆ›å»ºä¸€ä¸ª&lt;i&gt;run-loop observer&lt;/i&gt;çš„ä¾‹å­ï¼Œçœ‹&lt;a href=&#34;https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-SW18&#34;&gt; Configuring the Run Loop&lt;/a&gt;,æ›´å¤šç›¸å…³ä¿¡æ¯&lt;a href=&#34;https://developer.apple.com/documentation/corefoundation/cfrunloopobserver-ri3&#34;&gt;CFRunLoopObserver Reference&lt;/a&gt;&lt;/p&gt;

&lt;h5 id=&#34;the-run-loop-sequence-of-events&#34;&gt;The Run Loop Sequence of Events&lt;/h5&gt;

&lt;p&gt;æ¯æ¬¡ä½ è¿è¡Œ&lt;i&gt;runloop&lt;/i&gt;ï¼Œä½ çº¿ç¨‹çš„&lt;i&gt;runloop&lt;/i&gt;ä¼šå¤„ç†ä¹‹å‰æŒ‚èµ·çš„äº‹ä»¶ï¼Œå¹¶ä¸”å‘*run-loop observer*å‘é€é€šçŸ¥ã€‚&lt;i&gt;runloop&lt;/i&gt;æ‰§è¡Œçš„é¡ºåºå¦‚ä¸‹é¢æ‰€åˆ—å‡ºçš„ï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;é€šçŸ¥&lt;i&gt;run-loop observer&lt;/i&gt;ï¼Œè¿›å…¥&lt;i&gt;runloop&lt;/i&gt;&lt;/li&gt;
&lt;li&gt;é€šçŸ¥&lt;i&gt;run-loop observer&lt;/i&gt;ï¼Œå·²ç»å‡†å¤‡å¥½çš„Timerå°†è¦è§¦å‘&lt;/li&gt;
&lt;li&gt;é€šçŸ¥&lt;i&gt;run-loop observer&lt;/i&gt;ï¼Œä»¥åŠå‡†å¤‡å¥½çš„*no-port-based input source*å°†è¦è¢«è§¦å‘&lt;/li&gt;
&lt;li&gt;è§¦å‘&lt;i&gt;no-port-based input source&lt;/i&gt;&lt;/li&gt;
&lt;li&gt;å¦‚æœä¸€ä¸ª&lt;i&gt;port-based input source&lt;/i&gt;å‡†å¤‡å¥½ç­‰å¾…è§¦å‘ï¼Œç«‹å³å¤„ç†è¯¥äº‹ä»¶ï¼Œå†ä»ç¬¬ä¹æ­¥å¼€å§‹æ‰§è¡Œ&lt;/li&gt;
&lt;li&gt;é€šçŸ¥&lt;i&gt;run-loop observer&lt;/i&gt;ï¼Œçº¿ç¨‹å°†è¦sleep&lt;/li&gt;
&lt;li&gt;çº¿ç¨‹sleepç›´åˆ°ä¸‹é¢çš„äº‹ä»¶å‘ç”Ÿï¼š

&lt;ul&gt;
&lt;li&gt;&lt;i&gt;port-based input source&lt;/i&gt;äº‹ä»¶åˆ°è¾¾&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªTimerè§¦å‘äº†&lt;/li&gt;
&lt;li&gt;&lt;i&gt;runloop&lt;/i&gt;è¶…æ—¶äº†&lt;/li&gt;
&lt;li&gt;&lt;i&gt;runloop&lt;/i&gt;è¢«æ‰‹åŠ¨å”¤é†’&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;é€šçŸ¥&lt;i&gt;run-loop observer&lt;/i&gt;ï¼Œçº¿ç¨‹å°†è¦è¢«å”¤é†’&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å¤„ç†æŒ‚èµ·çš„äº‹ä»¶&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å¦‚æœä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„timerè§¦å‘äº†ï¼Œå¤„ç†ç›¸å…³äº‹ä»¶ï¼Œé‡æ–°å¼€å§‹å¾ªç¯ï¼Œå›åˆ°ç¬¬äºŒæ­¥ç»§ç»­æ‰§è¡Œ&lt;/li&gt;
&lt;li&gt;å¦‚æœ&lt;i&gt;input source&lt;/i&gt;è§¦å‘ï¼Œä¼ é€’ç›¸åº”çš„äº‹ä»¶&lt;/li&gt;
&lt;li&gt;å¦‚æœ&lt;i&gt;runloop*&lt;/i&gt;æ˜ç¡®çš„è¢«å”¤é†’ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰è¶…æ—¶ï¼Œé‡æ–°å¼€å§‹å¾ªç¯ï¼Œå›åˆ°ç¬¬äºŒæ­¥ç»§ç»­æ‰§è¡Œ&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;é€šçŸ¥&lt;i&gt;run_loop observer&lt;/i&gt;ï¼Œ&lt;i&gt;runloop&lt;/i&gt;å·²ç»é€€å‡º&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Tip:&lt;/strong&gt;no-port-based input sourceå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„&lt;strong&gt;source0&lt;/strong&gt;ï¼Œport-based input sourceå°±æ˜¯&lt;strong&gt;source1&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;å› ä¸ºTimerå’Œinput sourceçš„é€šçŸ¥æ˜¯åœ¨äº‹ä»¶è¢«è§¦å‘ä¹‹å‰ï¼Œæ‰€ä»¥è¿™ä¹‹é—´æœ‰ä¸€ä¸ªè¿‡æ¸¡æ—¶é—´ã€‚å¦‚æœä½ è¦åœ¨è¿™ä¸ªæ—¶é—´åšä¸€äº›äº‹æƒ…ï¼Œä½ å¯ä»¥ä½¿ç”¨&lt;strong&gt;sleep&lt;/strong&gt;å’Œ &lt;strong&gt;awake-from-sleep&lt;/strong&gt; é€šçŸ¥æ¥å¸®åŠ©ä½ è·å¾—è¿™æ®µæ—¶é—´çš„æ§åˆ¶æƒã€‚&lt;/p&gt;

&lt;p&gt;ä¸€ä¸ª&lt;i&gt;runloop&lt;em&gt;&lt;/i&gt;å¯ä»¥é€šè¿‡ä½¿ç”¨&lt;i&gt;run loop object&lt;/i&gt;è¢«å”¤é†’ã€‚å…¶ä»–çš„äº‹ä»¶ä¹Ÿå¯èƒ½å¼•èµ·&lt;i&gt;runloop&lt;/em&gt;&lt;/i&gt;è¢«å”¤é†’ã€‚ä¾‹å¦‚ï¼Œæ·»åŠ &lt;i&gt;no-port-based input source&lt;/i&gt;æ¥å”¤é†’&lt;i&gt;runloop*&lt;/i&gt;ä»¥è‡³äºinput sourceå¯ä»¥è¢«ç«‹å³å¤„ç†ï¼Œè€Œä¸æ˜¯ç­‰å¾…å…¶ä»–çš„äº‹ä»¶å‘ç”Ÿã€‚&lt;/p&gt;

&lt;hr /&gt;

&lt;blockquote&gt;
&lt;p&gt;iOSç³»ç»Ÿä¸­æœ‰å¾ˆå¤šç”¨åˆ°äº†RunLoopçš„åœ°æ–¹ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;AutoreleasePoolï¼šç›‘å¬&lt;code&gt;kCFRunLoopEntry&lt;/code&gt;äº‹ä»¶ï¼Œä¿è¯åœ¨æ‰€ä»¥å›è°ƒä¹‹å‰åˆ›å»ºè‡ªåŠ¨é‡Šæ”¾æ± ï¼›ç›‘å¬&lt;code&gt;BeforeWaiting&lt;/code&gt;äº‹ä»¶ï¼Œé‡Šæ”¾æ—§çš„çº¿ç¨‹æ± ï¼Œåˆ›å»ºæ–°çš„çº¿ç¨‹æ± ï¼›ç›‘å¬&lt;code&gt;kCFRunLoopExit&lt;/code&gt;äº‹ä»¶ï¼Œä¿è¯çº¿ç¨‹æ± æœ€åè¢«é‡Šæ”¾ã€‚&lt;/li&gt;
&lt;li&gt;äº‹ä»¶å“åº”ï¼šé€šè¿‡port-based input sourceç›‘å¬ç”¨æˆ·çš„äº‹ä»¶ï¼Œå¹¶è½¬å‘ç»™Appè¿›ç¨‹ï¼Œå¦‚ç”¨UIControlçš„äº‹ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;æ‰‹åŠ¿è¯†åˆ«ï¼šç›‘å¬&lt;code&gt;kCFRunLoopBeforeWaiting&lt;/code&gt;äº‹ä»¶åœ¨äº‹ä»¶çš„å›è°ƒå‡½æ•°ä¸­æ ‡è®°å¾…å¤„ç†çš„æ‰‹åŠ¿ï¼Œå¹¶å¤„ç†æ‰‹åŠ¿ã€‚&lt;/li&gt;
&lt;li&gt;ç•Œé¢æ›´æ–°ï¼š&lt;code&gt;setNeedsLayout&lt;/code&gt;ã€&lt;code&gt;setNeedsDisplay&lt;/code&gt;éƒ½ä¼šå°†è¯¥viewæ ‡è®°ä¸ºå¾…å¤„ç†ï¼Œç­‰åˆ°ä¸‹ä¸€ä¸ªrunloopçš„æ—¶å€™ä¼šå¸ƒå±€UIã€‚&lt;/li&gt;
&lt;li&gt;å®šæ—¶å™¨ï¼šå°±æ˜¯ä¸€ä¸ªCFRunLoopTimerRef&lt;/li&gt;
&lt;li&gt;PerformSelecterï¼šå°†æ–¹æ³•æ‰”åˆ°æŸä¸ªçº¿ç¨‹ä¸­ï¼Œåœ¨ä¸‹ä¸€ä¸ªrun loopçš„æ—¶å€™æ‰§è¡Œã€‚&lt;/li&gt;
&lt;li&gt;å…³äºGCDï¼šdispatch_async(dispatch_get_main_queue(), block)å‘ä¸»çº¿ç¨‹çš„run loopå‘é€æ¶ˆæ¯ï¼Œå”¤é†’run loopã€‚å¹¶æ‰§è¡Œblockä¸­çš„å†…å®¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;PPTæ€»ç»“ä¸€ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://upload-images.jianshu.io/upload_images/1086250-cb2c4b4a6d0973e7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&#34; alt=&#34;Screen Shot 2017-09-05 at 10.12.16 AM.png&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://upload-images.jianshu.io/upload_images/1086250-fb6430f46efe4735.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&#34; alt=&#34;Screen Shot 2017-09-05 at 10.12.37 AM.png&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://upload-images.jianshu.io/upload_images/1086250-7118fdeabb5ffe76.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&#34; alt=&#34;Screen Shot 2017-09-05 at 10.12.53 AM.png&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://upload-images.jianshu.io/upload_images/1086250-e7ae08b4d61ec9e6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&#34; alt=&#34;Screen Shot 2017-09-05 at 10.13.01 AM.png&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://upload-images.jianshu.io/upload_images/1086250-073579ed39612c1d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&#34; alt=&#34;Screen Shot 2017-09-05 at 10.12.47 AM.png&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://upload-images.jianshu.io/upload_images/1086250-cae92bc60b877b48.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&#34; alt=&#34;Screen Shot 2017-09-05 at 10.13.12 AM.png&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://upload-images.jianshu.io/upload_images/1086250-fae8de2bdb8232aa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&#34; alt=&#34;Screen Shot 2017-09-05 at 10.13.21 AM.png&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://upload-images.jianshu.io/upload_images/1086250-ac972598a07a90bc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&#34; alt=&#34;Screen Shot 2017-09-05 at 10.13.27 AM.png&#34; /&gt;&lt;/p&gt;</description>
    </item>
    
  </channel>
</rss>